const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/secp256k1-DzZtQd5f.js","assets/index-BXxLH8De.js","assets/index-C1ZvL4cu.css","assets/format-CPlBv4Ik.js"])))=>i.map(i=>d[i]);
import{g as Vh,_ as od}from"./index-BXxLH8De.js";import{r as Ls,f as Ct,g as ei,c as ad,a as $o,p as cd,b as Es,d as Bt}from"./format-CPlBv4Ik.js";var Oo={exports:{}},Li=typeof Reflect=="object"?Reflect:null,ba=Li&&typeof Li.apply=="function"?Li.apply:function(e,i,r){return Function.prototype.apply.call(e,i,r)},ls;Li&&typeof Li.ownKeys=="function"?ls=Li.ownKeys:Object.getOwnPropertySymbols?ls=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ls=function(e){return Object.getOwnPropertyNames(e)};function hd(t){console&&console.warn&&console.warn(t)}var Hh=Number.isNaN||function(e){return e!==e};function ne(){ne.init.call(this)}Oo.exports=ne;Oo.exports.once=dd;ne.EventEmitter=ne;ne.prototype._events=void 0;ne.prototype._eventsCount=0;ne.prototype._maxListeners=void 0;var ma=10;function Ms(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ne,"defaultMaxListeners",{enumerable:!0,get:function(){return ma},set:function(t){if(typeof t!="number"||t<0||Hh(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ma=t}});ne.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ne.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Hh(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Wh(t){return t._maxListeners===void 0?ne.defaultMaxListeners:t._maxListeners}ne.prototype.getMaxListeners=function(){return Wh(this)};ne.prototype.emit=function(e){for(var i=[],r=1;r<arguments.length;r++)i.push(arguments[r]);var s=e==="error",n=this._events;if(n!==void 0)s=s&&n.error===void 0;else if(!s)return!1;if(s){var o;if(i.length>0&&(o=i[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=n[e];if(c===void 0)return!1;if(typeof c=="function")ba(c,this,i);else for(var h=c.length,l=Xh(c,h),r=0;r<h;++r)ba(l[r],this,i);return!0};function Gh(t,e,i,r){var s,n,o;if(Ms(i),n=t._events,n===void 0?(n=t._events=Object.create(null),t._eventsCount=0):(n.newListener!==void 0&&(t.emit("newListener",e,i.listener?i.listener:i),n=t._events),o=n[e]),o===void 0)o=n[e]=i,++t._eventsCount;else if(typeof o=="function"?o=n[e]=r?[i,o]:[o,i]:r?o.unshift(i):o.push(i),s=Wh(t),s>0&&o.length>s&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=o.length,hd(a)}return t}ne.prototype.addListener=function(e,i){return Gh(this,e,i,!1)};ne.prototype.on=ne.prototype.addListener;ne.prototype.prependListener=function(e,i){return Gh(this,e,i,!0)};function ld(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Yh(t,e,i){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=ld.bind(r);return s.listener=i,r.wrapFn=s,s}ne.prototype.once=function(e,i){return Ms(i),this.on(e,Yh(this,e,i)),this};ne.prototype.prependOnceListener=function(e,i){return Ms(i),this.prependListener(e,Yh(this,e,i)),this};ne.prototype.removeListener=function(e,i){var r,s,n,o,a;if(Ms(i),s=this._events,s===void 0)return this;if(r=s[e],r===void 0)return this;if(r===i||r.listener===i)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,r.listener||i));else if(typeof r!="function"){for(n=-1,o=r.length-1;o>=0;o--)if(r[o]===i||r[o].listener===i){a=r[o].listener,n=o;break}if(n<0)return this;n===0?r.shift():ud(r,n),r.length===1&&(s[e]=r[0]),s.removeListener!==void 0&&this.emit("removeListener",e,a||i)}return this};ne.prototype.off=ne.prototype.removeListener;ne.prototype.removeAllListeners=function(e){var i,r,s;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var n=Object.keys(r),o;for(s=0;s<n.length;++s)o=n[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(i=r[e],typeof i=="function")this.removeListener(e,i);else if(i!==void 0)for(s=i.length-1;s>=0;s--)this.removeListener(e,i[s]);return this};function Jh(t,e,i){var r=t._events;if(r===void 0)return[];var s=r[e];return s===void 0?[]:typeof s=="function"?i?[s.listener||s]:[s]:i?fd(s):Xh(s,s.length)}ne.prototype.listeners=function(e){return Jh(this,e,!0)};ne.prototype.rawListeners=function(e){return Jh(this,e,!1)};ne.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Zh.call(t,e)};ne.prototype.listenerCount=Zh;function Zh(t){var e=this._events;if(e!==void 0){var i=e[t];if(typeof i=="function")return 1;if(i!==void 0)return i.length}return 0}ne.prototype.eventNames=function(){return this._eventsCount>0?ls(this._events):[]};function Xh(t,e){for(var i=new Array(e),r=0;r<e;++r)i[r]=t[r];return i}function ud(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function fd(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}function dd(t,e){return new Promise(function(i,r){function s(o){t.removeListener(e,n),r(o)}function n(){typeof t.removeListener=="function"&&t.removeListener("error",s),i([].slice.call(arguments))}Qh(t,e,n,{once:!0}),e!=="error"&&pd(t,s,{once:!0})})}function pd(t,e,i){typeof t.on=="function"&&Qh(t,"error",e,i)}function Qh(t,e,i,r){if(typeof t.on=="function")r.once?t.once(e,i):t.on(e,i);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(n){r.once&&t.removeEventListener(e,s),i(n)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var wt=Oo.exports;const el=Vh(wt);var M={},on={},Ji={},va;function gd(){if(va)return Ji;va=1,Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.delay=void 0;function t(e){return new Promise(i=>{setTimeout(()=>{i(!0)},e)})}return Ji.delay=t,Ji}var ni={},an={},oi={},Ea;function yd(){return Ea||(Ea=1,Object.defineProperty(oi,"__esModule",{value:!0}),oi.ONE_THOUSAND=oi.ONE_HUNDRED=void 0,oi.ONE_HUNDRED=100,oi.ONE_THOUSAND=1e3),oi}var cn={},_a;function wd(){return _a||(_a=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(cn)),cn}var xa;function tl(){return xa||(xa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ls;e.__exportStar(yd(),t),e.__exportStar(wd(),t)}(an)),an}var Ia;function bd(){if(Ia)return ni;Ia=1,Object.defineProperty(ni,"__esModule",{value:!0}),ni.fromMiliseconds=ni.toMiliseconds=void 0;const t=tl();function e(r){return r*t.ONE_THOUSAND}ni.toMiliseconds=e;function i(r){return Math.floor(r/t.ONE_THOUSAND)}return ni.fromMiliseconds=i,ni}var Sa;function md(){return Sa||(Sa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ls;e.__exportStar(gd(),t),e.__exportStar(bd(),t)}(on)),on}var $i={},Da;function vd(){if(Da)return $i;Da=1,Object.defineProperty($i,"__esModule",{value:!0}),$i.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(i){if(this.timestamps.has(i))throw new Error(`Watch already started for label: ${i}`);this.timestamps.set(i,{started:Date.now()})}stop(i){const r=this.get(i);if(typeof r.elapsed<"u")throw new Error(`Watch already stopped for label: ${i}`);const s=Date.now()-r.started;this.timestamps.set(i,{started:r.started,elapsed:s})}get(i){const r=this.timestamps.get(i);if(typeof r>"u")throw new Error(`No timestamp found for label: ${i}`);return r}elapsed(i){const r=this.get(i);return r.elapsed||Date.now()-r.started}}return $i.Watch=t,$i.default=t,$i}var hn={},Zi={},$a;function Ed(){if($a)return Zi;$a=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.IWatch=void 0;class t{}return Zi.IWatch=t,Zi}var Oa;function _d(){return Oa||(Oa=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ls.__exportStar(Ed(),t)}(hn)),hn}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ls;e.__exportStar(md(),t),e.__exportStar(vd(),t),e.__exportStar(_d(),t),e.__exportStar(tl(),t)})(M);class Ei{}let xd=class extends Ei{constructor(e){super()}};const Aa=M.FIVE_SECONDS,_i={pulse:"heartbeat_pulse"};let Id=class il extends xd{constructor(e){super(e),this.events=new wt.EventEmitter,this.interval=Aa,this.interval=(e==null?void 0:e.interval)||Aa}static async init(e){const i=new il(e);return await i.init(),i}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),M.toMiliseconds(this.interval))}pulse(){this.events.emit(_i.pulse)}};const Sd=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Dd=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,$d=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Od(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Ad(t);return}return e}function Ad(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Wr(t,e={}){if(typeof t!="string")return t;if(t[0]==='"'&&t[t.length-1]==='"'&&t.indexOf("\\")===-1)return t.slice(1,-1);const i=t.trim();if(i.length<=9)switch(i.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!$d.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Sd.test(t)||Dd.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Od)}return JSON.parse(t)}catch(r){if(e.strict)throw r;return t}}function Td(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function ve(t,...e){try{return Td(t(...e))}catch(i){return Promise.reject(i)}}function Pd(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Cd(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function us(t){if(Pd(t))return String(t);if(Cd(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return us(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Mn="base64:";function Ud(t){return typeof t=="string"?t:Mn+Bd(t)}function Nd(t){return typeof t!="string"||!t.startsWith(Mn)?t:Rd(t.slice(Mn.length))}function Rd(t){return globalThis.Buffer?Buffer.from(t,"base64"):Uint8Array.from(globalThis.atob(t),e=>e.codePointAt(0))}function Bd(t){return globalThis.Buffer?Buffer.from(t).toString("base64"):globalThis.btoa(String.fromCodePoint(...t))}function Ke(t){var e;return t&&((e=t.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function kd(...t){return Ke(t.join(":"))}function Gr(t){return t=Ke(t),t?t+":":""}function Ld(t,e){if(e===void 0)return!0;let i=0,r=t.indexOf(":");for(;r>-1;)i++,r=t.indexOf(":",r+1);return i<=e}function Md(t,e){return e?t.startsWith(e)&&t[t.length-1]!=="$":t[t.length-1]!=="$"}const zd="memory",qd=()=>{const t=new Map;return{name:zd,getInstance:()=>t,hasItem(e){return t.has(e)},getItem(e){return t.get(e)??null},getItemRaw(e){return t.get(e)??null},setItem(e,i){t.set(e,i)},setItemRaw(e,i){t.set(e,i)},removeItem(e){t.delete(e)},getKeys(){return[...t.keys()]},clear(){t.clear()},dispose(){t.clear()}}};function jd(t={}){const e={mounts:{"":t.driver||qd()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},i=h=>{for(const l of e.mountpoints)if(h.startsWith(l))return{base:l,relativeKey:h.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:h,driver:e.mounts[""]}},r=(h,l)=>e.mountpoints.filter(u=>u.startsWith(h)||l&&h.startsWith(u)).map(u=>({relativeBase:h.length>u.length?h.slice(u.length):void 0,mountpoint:u,driver:e.mounts[u]})),s=(h,l)=>{if(e.watching){l=Ke(l);for(const u of e.watchListeners)u(h,l)}},n=async()=>{if(!e.watching){e.watching=!0;for(const h in e.mounts)e.unwatch[h]=await Ta(e.mounts[h],s,h)}},o=async()=>{if(e.watching){for(const h in e.unwatch)await e.unwatch[h]();e.unwatch={},e.watching=!1}},a=(h,l,u)=>{const f=new Map,p=d=>{let g=f.get(d.base);return g||(g={driver:d.driver,base:d.base,items:[]},f.set(d.base,g)),g};for(const d of h){const g=typeof d=="string",y=Ke(g?d:d.key),v=g?void 0:d.value,E=g||!d.options?l:{...l,...d.options},b=i(y);p(b).items.push({key:y,value:v,relativeKey:b.relativeKey,options:E})}return Promise.all([...f.values()].map(d=>u(d))).then(d=>d.flat())},c={hasItem(h,l={}){h=Ke(h);const{relativeKey:u,driver:f}=i(h);return ve(f.hasItem,u,l)},getItem(h,l={}){h=Ke(h);const{relativeKey:u,driver:f}=i(h);return ve(f.getItem,u,l).then(p=>Wr(p))},getItems(h,l={}){return a(h,l,u=>u.driver.getItems?ve(u.driver.getItems,u.items.map(f=>({key:f.relativeKey,options:f.options})),l).then(f=>f.map(p=>({key:kd(u.base,p.key),value:Wr(p.value)}))):Promise.all(u.items.map(f=>ve(u.driver.getItem,f.relativeKey,f.options).then(p=>({key:f.key,value:Wr(p)})))))},getItemRaw(h,l={}){h=Ke(h);const{relativeKey:u,driver:f}=i(h);return f.getItemRaw?ve(f.getItemRaw,u,l):ve(f.getItem,u,l).then(p=>Nd(p))},async setItem(h,l,u={}){if(l===void 0)return c.removeItem(h);h=Ke(h);const{relativeKey:f,driver:p}=i(h);p.setItem&&(await ve(p.setItem,f,us(l),u),p.watch||s("update",h))},async setItems(h,l){await a(h,l,async u=>{if(u.driver.setItems)return ve(u.driver.setItems,u.items.map(f=>({key:f.relativeKey,value:us(f.value),options:f.options})),l);u.driver.setItem&&await Promise.all(u.items.map(f=>ve(u.driver.setItem,f.relativeKey,us(f.value),f.options)))})},async setItemRaw(h,l,u={}){if(l===void 0)return c.removeItem(h,u);h=Ke(h);const{relativeKey:f,driver:p}=i(h);if(p.setItemRaw)await ve(p.setItemRaw,f,l,u);else if(p.setItem)await ve(p.setItem,f,Ud(l),u);else return;p.watch||s("update",h)},async removeItem(h,l={}){typeof l=="boolean"&&(l={removeMeta:l}),h=Ke(h);const{relativeKey:u,driver:f}=i(h);f.removeItem&&(await ve(f.removeItem,u,l),(l.removeMeta||l.removeMata)&&await ve(f.removeItem,u+"$",l),f.watch||s("remove",h))},async getMeta(h,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),h=Ke(h);const{relativeKey:u,driver:f}=i(h),p=Object.create(null);if(f.getMeta&&Object.assign(p,await ve(f.getMeta,u,l)),!l.nativeOnly){const d=await ve(f.getItem,u+"$",l).then(g=>Wr(g));d&&typeof d=="object"&&(typeof d.atime=="string"&&(d.atime=new Date(d.atime)),typeof d.mtime=="string"&&(d.mtime=new Date(d.mtime)),Object.assign(p,d))}return p},setMeta(h,l,u={}){return this.setItem(h+"$",l,u)},removeMeta(h,l={}){return this.removeItem(h+"$",l)},async getKeys(h,l={}){var y;h=Gr(h);const u=r(h,!0);let f=[];const p=[];let d=!0;for(const v of u){(y=v.driver.flags)!=null&&y.maxDepth||(d=!1);const E=await ve(v.driver.getKeys,v.relativeBase,l);for(const b of E){const O=v.mountpoint+Ke(b);f.some(I=>O.startsWith(I))||p.push(O)}f=[v.mountpoint,...f.filter(b=>!b.startsWith(v.mountpoint))]}const g=l.maxDepth!==void 0&&!d;return p.filter(v=>(!g||Ld(v,l.maxDepth))&&Md(v,h))},async clear(h,l={}){h=Gr(h),await Promise.all(r(h,!1).map(async u=>{if(u.driver.clear)return ve(u.driver.clear,u.relativeBase,l);if(u.driver.removeItem){const f=await u.driver.getKeys(u.relativeBase||"",l);return Promise.all(f.map(p=>u.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(h=>Pa(h)))},async watch(h){return await n(),e.watchListeners.push(h),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==h),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(h,l){if(h=Gr(h),h&&e.mounts[h])throw new Error(`already mounted at ${h}`);return h&&(e.mountpoints.push(h),e.mountpoints.sort((u,f)=>f.length-u.length)),e.mounts[h]=l,e.watching&&Promise.resolve(Ta(l,s,h)).then(u=>{e.unwatch[h]=u}).catch(console.error),c},async unmount(h,l=!0){var u,f;h=Gr(h),!(!h||!e.mounts[h])&&(e.watching&&h in e.unwatch&&((f=(u=e.unwatch)[h])==null||f.call(u),delete e.unwatch[h]),l&&await Pa(e.mounts[h]),e.mountpoints=e.mountpoints.filter(p=>p!==h),delete e.mounts[h])},getMount(h=""){h=Ke(h)+":";const l=i(h);return{driver:l.driver,base:l.base}},getMounts(h="",l={}){return h=Ke(h),r(h,l.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(h,l={})=>c.getKeys(h,l),get:(h,l={})=>c.getItem(h,l),set:(h,l,u={})=>c.setItem(h,l,u),has:(h,l={})=>c.hasItem(h,l),del:(h,l={})=>c.removeItem(h,l),remove:(h,l={})=>c.removeItem(h,l)};return c}function Ta(t,e,i){return t.watch?t.watch((r,s)=>e(r,i+s)):()=>{}}async function Pa(t){typeof t.dispose=="function"&&await ve(t.dispose)}function xi(t){return new Promise((e,i)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>i(t.error)})}function rl(t,e){let i;const r=()=>{if(i)return i;const s=indexedDB.open(t);return s.onupgradeneeded=()=>s.result.createObjectStore(e),i=xi(s),i.then(n=>{n.onclose=()=>i=void 0},()=>{}),i};return(s,n)=>r().then(o=>n(o.transaction(e,s).objectStore(e)))}let ln;function Rr(){return ln||(ln=rl("keyval-store","keyval")),ln}function Ca(t,e=Rr()){return e("readonly",i=>xi(i.get(t)))}function Fd(t,e,i=Rr()){return i("readwrite",r=>(r.put(e,t),xi(r.transaction)))}function Kd(t,e=Rr()){return e("readwrite",i=>(i.delete(t),xi(i.transaction)))}function Vd(t=Rr()){return t("readwrite",e=>(e.clear(),xi(e.transaction)))}function Hd(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},xi(t.transaction)}function Wd(t=Rr()){return t("readonly",e=>{if(e.getAllKeys)return xi(e.getAllKeys());const i=[];return Hd(e,r=>i.push(r.key)).then(()=>i)})}const Gd=t=>JSON.stringify(t,(e,i)=>typeof i=="bigint"?i.toString()+"n":i),Yd=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=t.replace(e,'$1"$2n"$3');return JSON.parse(i,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function sl(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return Yd(t)}catch{return t}}function nl(t){return typeof t=="string"?t:Gd(t)||""}const Jd="idb-keyval";var Zd=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",i=s=>e+s;let r;return t.dbName&&t.storeName&&(r=rl(t.dbName,t.storeName)),{name:Jd,options:t,async hasItem(s){return!(typeof await Ca(i(s),r)>"u")},async getItem(s){return await Ca(i(s),r)??null},setItem(s,n){return Fd(i(s),n,r)},removeItem(s){return Kd(i(s),r)},getKeys(){return Wd(r)},clear(){return Vd(r)}}};const Xd="WALLET_CONNECT_V2_INDEXED_DB",Qd="keyvaluestorage";let ep=class{constructor(){this.indexedDb=jd({driver:Zd({dbName:Xd,storeName:Qd})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const i=await this.indexedDb.getItem(e);if(i!==null)return i}async setItem(e,i){await this.indexedDb.setItem(e,nl(i))}async removeItem(e){await this.indexedDb.removeItem(e)}};var un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},fs={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(i){return this.hasOwnProperty(i)?String(this[i]):null},t.prototype.setItem=function(i,r){this[i]=String(r)},t.prototype.removeItem=function(i){delete this[i]},t.prototype.clear=function(){const i=this;Object.keys(i).forEach(function(r){i[r]=void 0,delete i[r]})},t.prototype.key=function(i){return i=i||0,Object.keys(this)[i]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof un<"u"&&un.localStorage?fs.exports=un.localStorage:typeof window<"u"&&window.localStorage?fs.exports=window.localStorage:fs.exports=new e})();function tp(t){var e;return[t[0],sl((e=t[1])!=null?e:"")]}let ip=class{constructor(){this.localStorage=fs.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(tp)}async getItem(e){const i=this.localStorage.getItem(e);if(i!==null)return sl(i)}async setItem(e,i){this.localStorage.setItem(e,nl(i))}async removeItem(e){this.localStorage.removeItem(e)}};const rp="wc_storage_version",Ua=1,sp=async(t,e,i)=>{const r=rp,s=await e.getItem(r);if(s&&s>=Ua){i(e);return}const n=await t.getKeys();if(!n.length){i(e);return}const o=[];for(;n.length;){const a=n.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const h=await t.getItem(a);await e.setItem(a,h),o.push(a)}}await e.setItem(r,Ua),i(e),np(t,o)},np=async(t,e)=>{e.length&&e.forEach(async i=>{await t.removeItem(i)})};let op=class{constructor(){this.initialized=!1,this.setInitialized=i=>{this.storage=i,this.initialized=!0};const e=new ip;this.storage=e;try{const i=new ep;sp(e,i,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,i){return await this.initialize(),this.storage.setItem(e,i)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const i=setInterval(()=>{this.initialized&&(clearInterval(i),e())},20)})}};function ap(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}var cp=hp;function hp(t,e,i){var r=i&&i.stringify||ap,s=1;if(typeof t=="object"&&t!==null){var n=e.length+s;if(n===1)return t;var o=new Array(n);o[0]=r(t);for(var a=1;a<n;a++)o[a]=r(e[a]);return o.join(" ")}if(typeof t!="string")return t;var c=e.length;if(c===0)return t;for(var h="",l=1-s,u=-1,f=t&&t.length||0,p=0;p<f;){if(t.charCodeAt(p)===37&&p+1<f){switch(u=u>-1?u:0,t.charCodeAt(p+1)){case 100:case 102:if(l>=c||e[l]==null)break;u<p&&(h+=t.slice(u,p)),h+=Number(e[l]),u=p+2,p++;break;case 105:if(l>=c||e[l]==null)break;u<p&&(h+=t.slice(u,p)),h+=Math.floor(Number(e[l])),u=p+2,p++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;u<p&&(h+=t.slice(u,p));var d=typeof e[l];if(d==="string"){h+="'"+e[l]+"'",u=p+2,p++;break}if(d==="function"){h+=e[l].name||"<anonymous>",u=p+2,p++;break}h+=r(e[l]),u=p+2,p++;break;case 115:if(l>=c)break;u<p&&(h+=t.slice(u,p)),h+=String(e[l]),u=p+2,p++;break;case 37:u<p&&(h+=t.slice(u,p)),h+="%",u=p+2,p++,l--;break}++l}++p}return u===-1?t:(u<f&&(h+=t.slice(u)),h)}const Na=cp;var Bi=It;const Dr=mp().console||{},lp={mapHttpRequest:Yr,mapHttpResponse:Yr,wrapRequestSerializer:fn,wrapResponseSerializer:fn,wrapErrorSerializer:fn,req:Yr,res:Yr,err:gp};function up(t,e){return Array.isArray(t)?t.filter(function(r){return r!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function It(t){t=t||{},t.browser=t.browser||{};const e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");const i=t.browser.write||Dr;t.browser.write&&(t.browser.asObject=!0);const r=t.serializers||{},s=up(t.browser.serialize,r);let n=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(n=!1);const o=["error","fatal","warn","info","debug","trace"];typeof i=="function"&&(i.error=i.fatal=i.warn=i.info=i.debug=i.trace=i),t.enabled===!1&&(t.level="silent");const a=t.level||"info",c=Object.create(i);c.log||(c.log=$r),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:u,set:f});const h={transmit:e,serialize:s,asObject:t.browser.asObject,levels:o,timestamp:yp(t)};c.levels=It.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=$r,c.serializers=r,c._serialize=s,c._stdErrSerialize=n,c.child=p,e&&(c._logEvent=zn());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function u(){return this._level}function f(d){if(d!=="silent"&&!this.levels.values[d])throw Error("unknown level "+d);this._level=d,Oi(h,c,"error","log"),Oi(h,c,"fatal","error"),Oi(h,c,"warn","error"),Oi(h,c,"info","log"),Oi(h,c,"debug","log"),Oi(h,c,"trace","log")}function p(d,g){if(!d)throw new Error("missing bindings for child Pino");g=g||{},s&&d.serializers&&(g.serializers=d.serializers);const y=g.serializers;if(s&&y){var v=Object.assign({},r,y),E=t.browser.serialize===!0?Object.keys(v):s;delete d.serializers,zs([d],E,v,this._stdErrSerialize)}function b(O){this._childLevel=(O._childLevel|0)+1,this.error=Ai(O,d,"error"),this.fatal=Ai(O,d,"fatal"),this.warn=Ai(O,d,"warn"),this.info=Ai(O,d,"info"),this.debug=Ai(O,d,"debug"),this.trace=Ai(O,d,"trace"),v&&(this.serializers=v,this._serialize=E),e&&(this._logEvent=zn([].concat(O._logEvent.bindings,d)))}return b.prototype=this,new b(this)}return c}It.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};It.stdSerializers=lp;It.stdTimeFunctions=Object.assign({},{nullTime:ol,epochTime:al,unixTime:wp,isoTime:bp});function Oi(t,e,i,r){const s=Object.getPrototypeOf(e);e[i]=e.levelVal>e.levels.values[i]?$r:s[i]?s[i]:Dr[i]||Dr[r]||$r,fp(t,e,i)}function fp(t,e,i){!t.transmit&&e[i]===$r||(e[i]=function(r){return function(){const n=t.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===Dr?Dr:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(t.serialize&&!t.asObject&&zs(o,this._serialize,this.serializers,this._stdErrSerialize),t.asObject?r.call(a,dp(this,i,o,n)):r.apply(a,o),t.transmit){const h=t.transmit.level||e.level,l=It.levels.values[h],u=It.levels.values[i];if(u<l)return;pp(this,{ts:n,methodLevel:i,methodValue:u,transmitLevel:h,transmitValue:It.levels.values[t.transmit.level||e.level],send:t.transmit.send,val:e.levelVal},o)}}}(e[i]))}function dp(t,e,i,r){t._serialize&&zs(i,t._serialize,t.serializers,t._stdErrSerialize);const s=i.slice();let n=s[0];const o={};r&&(o.time=r),o.level=It.levels.values[e];let a=(t._childLevel|0)+1;if(a<1&&(a=1),n!==null&&typeof n=="object"){for(;a--&&typeof s[0]=="object";)Object.assign(o,s.shift());n=s.length?Na(s.shift(),s):void 0}else typeof n=="string"&&(n=Na(s.shift(),s));return n!==void 0&&(o.msg=n),o}function zs(t,e,i,r){for(const s in t)if(r&&t[s]instanceof Error)t[s]=It.stdSerializers.err(t[s]);else if(typeof t[s]=="object"&&!Array.isArray(t[s]))for(const n in t[s])e&&e.indexOf(n)>-1&&n in i&&(t[s][n]=i[n](t[s][n]))}function Ai(t,e,i){return function(){const r=new Array(1+arguments.length);r[0]=e;for(var s=1;s<r.length;s++)r[s]=arguments[s-1];return t[i].apply(this,r)}}function pp(t,e,i){const r=e.send,s=e.ts,n=e.methodLevel,o=e.methodValue,a=e.val,c=t._logEvent.bindings;zs(i,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=i.filter(function(h){return c.indexOf(h)===-1}),t._logEvent.level.label=n,t._logEvent.level.value=o,r(n,t._logEvent,a),t._logEvent=zn(c)}function zn(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function gp(t){const e={type:t.constructor.name,msg:t.message,stack:t.stack};for(const i in t)e[i]===void 0&&(e[i]=t[i]);return e}function yp(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?ol:al}function Yr(){return{}}function fn(t){return t}function $r(){}function ol(){return!1}function al(){return Date.now()}function wp(){return Math.round(Date.now()/1e3)}function bp(){return new Date(Date.now()).toISOString()}function mp(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(window)||t(this)||{}}}const qs=Vh(Bi),vp=t=>JSON.stringify(t,(e,i)=>typeof i=="bigint"?i.toString()+"n":i);function Ra(t){return typeof t=="string"?t:vp(t)||""}const Ep={level:"info"},Br="custom_context",Ao=1e3*1024;let _p=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},Ba=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const i=new _p(e);if(i.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${i.size}`);for(;this.size+i.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=i),this.tail=i):(this.head=i,this.tail=i),this.lengthInNodes++,this.sizeInBytes+=i.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let i=this.head;for(;i!==null;)e.push(i.value),i=i.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const i=e.value;return e=e.next,{done:!1,value:i}}}}};class cl{constructor(e,i=Ao){this.level=e??"error",this.levelValue=Bi.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=i,this.logs=new Ba(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,i){i===Bi.levels.values.error?console.error(e):i===Bi.levels.values.warn?console.warn(e):i===Bi.levels.values.debug?console.debug(e):i===Bi.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(Ra({timestamp:new Date().toISOString(),log:e}));const i=typeof e=="string"?JSON.parse(e).level:e.level;i>=this.levelValue&&this.forwardToConsole(e,i)}getLogs(){return this.logs}clearLogs(){this.logs=new Ba(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const i=this.getLogArray();return i.push(Ra({extraMetadata:e})),new Blob(i,{type:"application/json"})}}let xp=class{constructor(e,i=Ao){this.baseChunkLogger=new cl(e,i)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const i=URL.createObjectURL(this.logsToBlob(e)),r=document.createElement("a");r.href=i,r.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}},Ip=class{constructor(e,i=Ao){this.baseChunkLogger=new cl(e,i)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var Sp=Object.defineProperty,Dp=Object.defineProperties,$p=Object.getOwnPropertyDescriptors,ka=Object.getOwnPropertySymbols,Op=Object.prototype.hasOwnProperty,Ap=Object.prototype.propertyIsEnumerable,La=(t,e,i)=>e in t?Sp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,_s=(t,e)=>{for(var i in e||(e={}))Op.call(e,i)&&La(t,i,e[i]);if(ka)for(var i of ka(e))Ap.call(e,i)&&La(t,i,e[i]);return t},xs=(t,e)=>Dp(t,$p(e));function To(t){return xs(_s({},t),{level:(t==null?void 0:t.level)||Ep.level})}function Tp(t,e=Br){return t[e]||""}function Pp(t,e,i=Br){return t[i]=e,t}function Ze(t,e=Br){let i="";return typeof t.bindings>"u"?i=Tp(t,e):i=t.bindings().context||"",i}function Cp(t,e,i=Br){const r=Ze(t,i);return r.trim()?`${r}/${e}`:e}function qe(t,e,i=Br){const r=Cp(t,e,i),s=t.child({context:r});return Pp(s,r,i)}function Up(t){var e,i;const r=new xp((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:qs(xs(_s({},t.opts),{level:"trace",browser:xs(_s({},(i=t.opts)==null?void 0:i.browser),{write:s=>r.write(s)})})),chunkLoggerController:r}}function Np(t){var e;const i=new Ip((e=t.opts)==null?void 0:e.level,t.maxSizeInBytes);return{logger:qs(xs(_s({},t.opts),{level:"trace"}),i),chunkLoggerController:i}}function Rp(t){return typeof t.loggerOverride<"u"&&typeof t.loggerOverride!="string"?{logger:t.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Up(t):Np(t)}var Bp=Object.defineProperty,kp=(t,e,i)=>e in t?Bp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ma=(t,e,i)=>kp(t,typeof e!="symbol"?e+"":e,i);let Lp=class extends Ei{constructor(e){super(),this.opts=e,Ma(this,"protocol","wc"),Ma(this,"version",2)}};var Mp=Object.defineProperty,zp=(t,e,i)=>e in t?Mp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,qp=(t,e,i)=>zp(t,e+"",i);class jp extends Ei{constructor(e,i){super(),this.core=e,this.logger=i,qp(this,"records",new Map)}}class Fp{constructor(e,i){this.logger=e,this.core=i}}let Kp=class extends Ei{constructor(e,i){super(),this.relayer=e,this.logger=i}},Vp=class extends Ei{constructor(e){super()}},Hp=class{constructor(e,i,r,s){this.core=e,this.logger=i,this.name=r}},Wp=class extends Ei{constructor(e,i){super(),this.relayer=e,this.logger=i}};class Gp extends Ei{constructor(e,i){super(),this.core=e,this.logger=i}}let Yp=class{constructor(e,i,r){this.core=e,this.logger=i,this.store=r}},Jp=class{constructor(e,i){this.projectId=e,this.logger=i}},Zp=class{constructor(e,i,r){this.core=e,this.logger=i,this.telemetryEnabled=r}};var Xp=Object.defineProperty,Qp=(t,e,i)=>e in t?Xp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,za=(t,e,i)=>Qp(t,typeof e!="symbol"?e+"":e,i);let eg=class{constructor(e){this.opts=e,za(this,"protocol","wc"),za(this,"version",2)}},tg=class{constructor(e){this.client=e}};const ig=t=>JSON.stringify(t,(e,i)=>typeof i=="bigint"?i.toString()+"n":i),rg=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=t.replace(e,'$1"$2n"$3');return JSON.parse(i,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function qa(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return rg(t)}catch{return t}}function sg(t){return typeof t=="string"?t:ig(t)||""}const ng=t=>JSON.stringify(t,(e,i)=>typeof i=="bigint"?i.toString()+"n":i),og=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=t.replace(e,'$1"$2n"$3');return JSON.parse(i,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function ag(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return og(t)}catch{return t}}function cg(t){return typeof t=="string"?t:ng(t)||""}function hg(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function hl(t,...e){if(!hg(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function ja(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function lg(t,e){hl(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}const Ti=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);function ug(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function ll(t){return typeof t=="string"&&(t=ug(t)),hl(t),t}let fg=class{clone(){return this._cloneInto()}};function dg(t){const e=r=>t().update(ll(r)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function ul(t=32){if(Ti&&typeof Ti.getRandomValues=="function")return Ti.getRandomValues(new Uint8Array(t));if(Ti&&typeof Ti.randomBytes=="function")return Ti.randomBytes(t);throw new Error("crypto.getRandomValues must be defined")}function pg(t,e,i,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(i>>s&n),a=Number(i&n),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}let gg=class extends fg{constructor(e,i,r,s){super(),this.blockLen=e,this.outputLen=i,this.padOffset=r,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=dn(this.buffer)}update(e){ja(this);const{view:i,buffer:r,blockLen:s}=this;e=ll(e);const n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=dn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(i,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ja(this),lg(e,this),this.finished=!0;const{buffer:i,view:r,blockLen:s,isLE:n}=this;let{pos:o}=this;i[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(r,0),o=0);for(let u=o;u<s;u++)i[u]=0;pg(r,s-8,BigInt(this.length*8),n),this.process(r,0);const a=dn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,l=this.get();if(h>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<h;u++)a.setUint32(4*u,l[u],n)}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:i,buffer:r,length:s,finished:n,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=n,e.destroyed=o,s%i&&e.buffer.set(r),e}};const Jr=BigInt(2**32-1),qn=BigInt(32);function fl(t,e=!1){return e?{h:Number(t&Jr),l:Number(t>>qn&Jr)}:{h:Number(t>>qn&Jr)|0,l:Number(t&Jr)|0}}function yg(t,e=!1){let i=new Uint32Array(t.length),r=new Uint32Array(t.length);for(let s=0;s<t.length;s++){const{h:n,l:o}=fl(t[s],e);[i[s],r[s]]=[n,o]}return[i,r]}const wg=(t,e)=>BigInt(t>>>0)<<qn|BigInt(e>>>0),bg=(t,e,i)=>t>>>i,mg=(t,e,i)=>t<<32-i|e>>>i,vg=(t,e,i)=>t>>>i|e<<32-i,Eg=(t,e,i)=>t<<32-i|e>>>i,_g=(t,e,i)=>t<<64-i|e>>>i-32,xg=(t,e,i)=>t>>>i-32|e<<64-i,Ig=(t,e)=>e,Sg=(t,e)=>t,Dg=(t,e,i)=>t<<i|e>>>32-i,$g=(t,e,i)=>e<<i|t>>>32-i,Og=(t,e,i)=>e<<i-32|t>>>64-i,Ag=(t,e,i)=>t<<i-32|e>>>64-i;function Tg(t,e,i,r){const s=(e>>>0)+(r>>>0);return{h:t+i+(s/2**32|0)|0,l:s|0}}const Pg=(t,e,i)=>(t>>>0)+(e>>>0)+(i>>>0),Cg=(t,e,i,r)=>e+i+r+(t/2**32|0)|0,Ug=(t,e,i,r)=>(t>>>0)+(e>>>0)+(i>>>0)+(r>>>0),Ng=(t,e,i,r,s)=>e+i+r+s+(t/2**32|0)|0,Rg=(t,e,i,r,s)=>(t>>>0)+(e>>>0)+(i>>>0)+(r>>>0)+(s>>>0),Bg=(t,e,i,r,s,n)=>e+i+r+s+n+(t/2**32|0)|0,G={fromBig:fl,split:yg,toBig:wg,shrSH:bg,shrSL:mg,rotrSH:vg,rotrSL:Eg,rotrBH:_g,rotrBL:xg,rotr32H:Ig,rotr32L:Sg,rotlSH:Dg,rotlSL:$g,rotlBH:Og,rotlBL:Ag,add:Tg,add3L:Pg,add3H:Cg,add4L:Ug,add4H:Ng,add5H:Bg,add5L:Rg},[kg,Lg]=G.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),kt=new Uint32Array(80),Lt=new Uint32Array(80);let Mg=class extends gg{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:i,Bh:r,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:h,El:l,Fh:u,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,i,r,s,n,o,a,c,h,l,u,f,p,d,g,y]}set(e,i,r,s,n,o,a,c,h,l,u,f,p,d,g,y){this.Ah=e|0,this.Al=i|0,this.Bh=r|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=h|0,this.El=l|0,this.Fh=u|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,i){for(let b=0;b<16;b++,i+=4)kt[b]=e.getUint32(i),Lt[b]=e.getUint32(i+=4);for(let b=16;b<80;b++){const O=kt[b-15]|0,I=Lt[b-15]|0,U=G.rotrSH(O,I,1)^G.rotrSH(O,I,8)^G.shrSH(O,I,7),B=G.rotrSL(O,I,1)^G.rotrSL(O,I,8)^G.shrSL(O,I,7),P=kt[b-2]|0,w=Lt[b-2]|0,A=G.rotrSH(P,w,19)^G.rotrBH(P,w,61)^G.shrSH(P,w,6),_=G.rotrSL(P,w,19)^G.rotrBL(P,w,61)^G.shrSL(P,w,6),D=G.add4L(B,_,Lt[b-7],Lt[b-16]),C=G.add4H(D,U,A,kt[b-7],kt[b-16]);kt[b]=C|0,Lt[b]=D|0}let{Ah:r,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:h,Dl:l,Eh:u,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:v,Hl:E}=this;for(let b=0;b<80;b++){const O=G.rotrSH(u,f,14)^G.rotrSH(u,f,18)^G.rotrBH(u,f,41),I=G.rotrSL(u,f,14)^G.rotrSL(u,f,18)^G.rotrBL(u,f,41),U=u&p^~u&g,B=f&d^~f&y,P=G.add5L(E,I,B,Lg[b],Lt[b]),w=G.add5H(P,v,O,U,kg[b],kt[b]),A=P|0,_=G.rotrSH(r,s,28)^G.rotrBH(r,s,34)^G.rotrBH(r,s,39),D=G.rotrSL(r,s,28)^G.rotrBL(r,s,34)^G.rotrBL(r,s,39),C=r&n^r&a^n&a,L=s&o^s&c^o&c;v=g|0,E=y|0,g=p|0,y=d|0,p=u|0,d=f|0,{h:u,l:f}=G.add(h|0,l|0,w|0,A|0),h=a|0,l=c|0,a=n|0,c=o|0,n=r|0,o=s|0;const x=G.add3L(A,D,L);r=G.add3H(x,w,_,C),s=x|0}({h:r,l:s}=G.add(this.Ah|0,this.Al|0,r|0,s|0)),{h:n,l:o}=G.add(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=G.add(this.Ch|0,this.Cl|0,a|0,c|0),{h,l}=G.add(this.Dh|0,this.Dl|0,h|0,l|0),{h:u,l:f}=G.add(this.Eh|0,this.El|0,u|0,f|0),{h:p,l:d}=G.add(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=G.add(this.Gh|0,this.Gl|0,g|0,y|0),{h:v,l:E}=G.add(this.Hh|0,this.Hl|0,v|0,E|0),this.set(r,s,n,o,a,c,h,l,u,f,p,d,g,y,v,E)}roundClean(){kt.fill(0),Lt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const zg=dg(()=>new Mg);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Po=BigInt(0),dl=BigInt(1),qg=BigInt(2);function Co(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Uo(t){if(!Co(t))throw new Error("Uint8Array expected")}function pn(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}const jg=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function No(t){Uo(t);let e="";for(let i=0;i<t.length;i++)e+=jg[t[i]];return e}function pl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Po:BigInt("0x"+t)}const Dt={_0:48,_9:57,A:65,F:70,a:97,f:102};function Fa(t){if(t>=Dt._0&&t<=Dt._9)return t-Dt._0;if(t>=Dt.A&&t<=Dt.F)return t-(Dt.A-10);if(t>=Dt.a&&t<=Dt.f)return t-(Dt.a-10)}function gl(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length,i=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(i);for(let s=0,n=0;s<i;s++,n+=2){const o=Fa(t.charCodeAt(n)),a=Fa(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[s]=o*16+a}return r}function Fg(t){return pl(No(t))}function ds(t){return Uo(t),pl(No(Uint8Array.from(t).reverse()))}function yl(t,e){return gl(t.toString(16).padStart(e*2,"0"))}function jn(t,e){return yl(t,e).reverse()}function $t(t,e,i){let r;if(typeof e=="string")try{r=gl(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Co(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=r.length;if(typeof i=="number"&&s!==i)throw new Error(t+" of length "+i+" expected, got "+s);return r}function Ka(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];Uo(s),e+=s.length}const i=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const n=t[r];i.set(n,s),s+=n.length}return i}const gn=t=>typeof t=="bigint"&&Po<=t;function Kg(t,e,i){return gn(t)&&gn(e)&&gn(i)&&e<=t&&t<i}function Xi(t,e,i,r){if(!Kg(e,i,r))throw new Error("expected valid "+t+": "+i+" <= n < "+r+", got "+e)}function Vg(t){let e;for(e=0;t>Po;t>>=dl,e+=1);return e}const Hg=t=>(qg<<BigInt(t-1))-dl,Wg={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Co(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function Ro(t,e,i={}){const r=(s,n,o)=>{const a=Wg[n];if(typeof a!="function")throw new Error("invalid validator function");const c=t[s];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(s)+" is invalid. Expected "+n+", got "+c)};for(const[s,n]of Object.entries(e))r(s,n,!1);for(const[s,n]of Object.entries(i))r(s,n,!0);return t}function Va(t){const e=new WeakMap;return(i,...r)=>{const s=e.get(i);if(s!==void 0)return s;const n=t(i,...r);return e.set(i,n),n}}const xe=BigInt(0),de=BigInt(1),li=BigInt(2),Gg=BigInt(3),Fn=BigInt(4),Ha=BigInt(5),Wa=BigInt(8);function be(t,e){const i=t%e;return i>=xe?i:e+i}function Yg(t,e,i){if(e<xe)throw new Error("invalid exponent, negatives unsupported");if(i<=xe)throw new Error("invalid modulus");if(i===de)return xe;let r=de;for(;e>xe;)e&de&&(r=r*t%i),t=t*t%i,e>>=de;return r}function bt(t,e,i){let r=t;for(;e-- >xe;)r*=r,r%=i;return r}function Ga(t,e){if(t===xe)throw new Error("invert: expected non-zero number");if(e<=xe)throw new Error("invert: expected positive modulus, got "+e);let i=be(t,e),r=e,s=xe,n=de;for(;i!==xe;){const o=r/i,a=r%i,c=s-n*o;r=i,i=a,s=n,n=c}if(r!==de)throw new Error("invert: does not exist");return be(s,e)}function Jg(t){const e=(t-de)/li;let i,r,s;for(i=t-de,r=0;i%li===xe;i/=li,r++);for(s=li;s<t&&Yg(s,e,t)!==t-de;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(t+de)/Fn;return function(a,c){const h=a.pow(c,o);if(!a.eql(a.sqr(h),c))throw new Error("Cannot find square root");return h}}const n=(i+de)/li;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=r,h=o.pow(o.mul(o.ONE,s),i),l=o.pow(a,n),u=o.pow(a,i);for(;!o.eql(u,o.ONE);){if(o.eql(u,o.ZERO))return o.ZERO;let f=1;for(let d=o.sqr(u);f<c&&!o.eql(d,o.ONE);f++)d=o.sqr(d);const p=o.pow(h,de<<BigInt(c-f-1));h=o.sqr(p),l=o.mul(l,p),u=o.mul(u,h),c=f}return l}}function Zg(t){if(t%Fn===Gg){const e=(t+de)/Fn;return function(i,r){const s=i.pow(r,e);if(!i.eql(i.sqr(s),r))throw new Error("Cannot find square root");return s}}if(t%Wa===Ha){const e=(t-Ha)/Wa;return function(i,r){const s=i.mul(r,li),n=i.pow(s,e),o=i.mul(r,n),a=i.mul(i.mul(o,li),n),c=i.mul(o,i.sub(a,i.ONE));if(!i.eql(i.sqr(c),r))throw new Error("Cannot find square root");return c}}return Jg(t)}const Xg=(t,e)=>(be(t,e)&de)===de,Qg=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ey(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},i=Qg.reduce((r,s)=>(r[s]="function",r),e);return Ro(t,i)}function ty(t,e,i){if(i<xe)throw new Error("invalid exponent, negatives unsupported");if(i===xe)return t.ONE;if(i===de)return e;let r=t.ONE,s=e;for(;i>xe;)i&de&&(r=t.mul(r,s)),s=t.sqr(s),i>>=de;return r}function iy(t,e){const i=new Array(e.length),r=e.reduce((n,o,a)=>t.is0(o)?n:(i[a]=n,t.mul(n,o)),t.ONE),s=t.inv(r);return e.reduceRight((n,o,a)=>t.is0(o)?n:(i[a]=t.mul(n,i[a]),t.mul(n,o)),s),i}function wl(t,e){const i=e!==void 0?e:t.toString(2).length,r=Math.ceil(i/8);return{nBitLength:i,nByteLength:r}}function bl(t,e,i=!1,r={}){if(t<=xe)throw new Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:s,nByteLength:n}=wl(t,e);if(n>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:i,BITS:s,BYTES:n,MASK:Hg(s),ZERO:xe,ONE:de,create:c=>be(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return xe<=c&&c<t},is0:c=>c===xe,isOdd:c=>(c&de)===de,neg:c=>be(-c,t),eql:(c,h)=>c===h,sqr:c=>be(c*c,t),add:(c,h)=>be(c+h,t),sub:(c,h)=>be(c-h,t),mul:(c,h)=>be(c*h,t),pow:(c,h)=>ty(a,c,h),div:(c,h)=>be(c*Ga(h,t),t),sqrN:c=>c*c,addN:(c,h)=>c+h,subN:(c,h)=>c-h,mulN:(c,h)=>c*h,inv:c=>Ga(c,t),sqrt:r.sqrt||(c=>(o||(o=Zg(t)),o(a,c))),invertBatch:c=>iy(a,c),cmov:(c,h,l)=>l?h:c,toBytes:c=>i?jn(c,n):yl(c,n),fromBytes:c=>{if(c.length!==n)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+c.length);return i?ds(c):Fg(c)}});return Object.freeze(a)}const Ya=BigInt(0),Zr=BigInt(1);function yn(t,e){const i=e.negate();return t?i:e}function ml(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function wn(t,e){ml(t,e);const i=Math.ceil(e/t)+1,r=2**(t-1);return{windows:i,windowSize:r}}function ry(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((i,r)=>{if(!(i instanceof e))throw new Error("invalid point at index "+r)})}function sy(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((i,r)=>{if(!e.isValid(i))throw new Error("invalid scalar at index "+r)})}const bn=new WeakMap,vl=new WeakMap;function mn(t){return vl.get(t)||1}function ny(t,e){return{constTimeNegate:yn,hasPrecomputes(i){return mn(i)!==1},unsafeLadder(i,r,s=t.ZERO){let n=i;for(;r>Ya;)r&Zr&&(s=s.add(n)),n=n.double(),r>>=Zr;return s},precomputeWindow(i,r){const{windows:s,windowSize:n}=wn(r,e),o=[];let a=i,c=a;for(let h=0;h<s;h++){c=a,o.push(c);for(let l=1;l<n;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(i,r,s){const{windows:n,windowSize:o}=wn(i,e);let a=t.ZERO,c=t.BASE;const h=BigInt(2**i-1),l=2**i,u=BigInt(i);for(let f=0;f<n;f++){const p=f*o;let d=Number(s&h);s>>=u,d>o&&(d-=l,s+=Zr);const g=p,y=p+Math.abs(d)-1,v=f%2!==0,E=d<0;d===0?c=c.add(yn(v,r[g])):a=a.add(yn(E,r[y]))}return{p:a,f:c}},wNAFUnsafe(i,r,s,n=t.ZERO){const{windows:o,windowSize:a}=wn(i,e),c=BigInt(2**i-1),h=2**i,l=BigInt(i);for(let u=0;u<o;u++){const f=u*a;if(s===Ya)break;let p=Number(s&c);if(s>>=l,p>a&&(p-=h,s+=Zr),p===0)continue;let d=r[f+Math.abs(p)-1];p<0&&(d=d.negate()),n=n.add(d)}return n},getPrecomputes(i,r,s){let n=bn.get(r);return n||(n=this.precomputeWindow(r,i),i!==1&&bn.set(r,s(n))),n},wNAFCached(i,r,s){const n=mn(i);return this.wNAF(n,this.getPrecomputes(n,i,s),r)},wNAFCachedUnsafe(i,r,s,n){const o=mn(i);return o===1?this.unsafeLadder(i,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,i,s),r,n)},setWindowSize(i,r){ml(r,e),vl.set(i,r),bn.delete(i)}}}function oy(t,e,i,r){if(ry(i,t),sy(r,e),i.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const s=t.ZERO,n=Vg(BigInt(i.length)),o=n>12?n-3:n>4?n-2:n?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),h=Math.floor((e.BITS-1)/o)*o;let l=s;for(let u=h;u>=0;u-=o){c.fill(s);for(let p=0;p<r.length;p++){const d=r[p],g=Number(d>>BigInt(u)&BigInt(a));c[g]=c[g].add(i[p])}let f=s;for(let p=c.length-1,d=s;p>0;p--)d=d.add(c[p]),f=f.add(d);if(l=l.add(f),u!==0)for(let p=0;p<o;p++)l=l.double()}return l}function ay(t){return ey(t.Fp),Ro(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...wl(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const ut=BigInt(0),je=BigInt(1),Xr=BigInt(2),cy=BigInt(8),hy={zip215:!0};function ly(t){const e=ay(t);return Ro(t,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function uy(t){const e=ly(t),{Fp:i,n:r,prehash:s,hash:n,randomBytes:o,nByteLength:a,h:c}=e,h=Xr<<BigInt(a*8)-je,l=i.create,u=bl(e.n,e.nBitLength),f=e.uvRatio||((x,m)=>{try{return{isValid:!0,value:i.sqrt(x*i.inv(m))}}catch{return{isValid:!1,value:ut}}}),p=e.adjustScalarBytes||(x=>x),d=e.domain||((x,m,S)=>{if(pn("phflag",S),m.length||S)throw new Error("Contexts/pre-hash are not supported");return x});function g(x,m){Xi("coordinate "+x,m,ut,h)}function y(x){if(!(x instanceof b))throw new Error("ExtendedPoint expected")}const v=Va((x,m)=>{const{ex:S,ey:T,ez:$}=x,R=x.is0();m==null&&(m=R?cy:i.inv($));const k=l(S*m),j=l(T*m),F=l($*m);if(R)return{x:ut,y:je};if(F!==je)throw new Error("invZ was invalid");return{x:k,y:j}}),E=Va(x=>{const{a:m,d:S}=e;if(x.is0())throw new Error("bad point: ZERO");const{ex:T,ey:$,ez:R,et:k}=x,j=l(T*T),F=l($*$),K=l(R*R),V=l(K*K),H=l(j*m),ie=l(K*l(H+F)),te=l(V+l(S*l(j*F)));if(ie!==te)throw new Error("bad point: equation left != right (1)");const Y=l(T*$),ue=l(R*k);if(Y!==ue)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(m,S,T,$){this.ex=m,this.ey=S,this.ez=T,this.et=$,g("x",m),g("y",S),g("z",T),g("t",$),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof b)throw new Error("extended point not allowed");const{x:S,y:T}=m||{};return g("x",S),g("y",T),new b(S,T,je,l(S*T))}static normalizeZ(m){const S=i.invertBatch(m.map(T=>T.ez));return m.map((T,$)=>T.toAffine(S[$])).map(b.fromAffine)}static msm(m,S){return oy(b,u,m,S)}_setWindowSize(m){U.setWindowSize(this,m)}assertValidity(){E(this)}equals(m){y(m);const{ex:S,ey:T,ez:$}=this,{ex:R,ey:k,ez:j}=m,F=l(S*j),K=l(R*$),V=l(T*j),H=l(k*$);return F===K&&V===H}is0(){return this.equals(b.ZERO)}negate(){return new b(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){const{a:m}=e,{ex:S,ey:T,ez:$}=this,R=l(S*S),k=l(T*T),j=l(Xr*l($*$)),F=l(m*R),K=S+T,V=l(l(K*K)-R-k),H=F+k,ie=H-j,te=F-k,Y=l(V*ie),ue=l(H*te),Ie=l(V*te),si=l(ie*H);return new b(Y,ue,si,Ie)}add(m){y(m);const{a:S,d:T}=e,{ex:$,ey:R,ez:k,et:j}=this,{ex:F,ey:K,ez:V,et:H}=m;if(S===BigInt(-1)){const ua=l((R-$)*(K+F)),fa=l((R+$)*(K-F)),nn=l(fa-ua);if(nn===ut)return this.double();const da=l(k*Xr*H),pa=l(j*Xr*V),ga=pa+da,ya=fa+ua,wa=pa-da,id=l(ga*nn),rd=l(ya*wa),sd=l(ga*wa),nd=l(nn*ya);return new b(id,rd,nd,sd)}const ie=l($*F),te=l(R*K),Y=l(j*T*H),ue=l(k*V),Ie=l(($+R)*(F+K)-ie-te),si=ue-Y,Hr=ue+Y,Di=l(te-S*ie),sn=l(Ie*si),Qf=l(Hr*Di),ed=l(Ie*Di),td=l(si*Hr);return new b(sn,Qf,td,ed)}subtract(m){return this.add(m.negate())}wNAF(m){return U.wNAFCached(this,m,b.normalizeZ)}multiply(m){const S=m;Xi("scalar",S,je,r);const{p:T,f:$}=this.wNAF(S);return b.normalizeZ([T,$])[0]}multiplyUnsafe(m,S=b.ZERO){const T=m;return Xi("scalar",T,ut,r),T===ut?I:this.is0()||T===je?this:U.wNAFCachedUnsafe(this,T,b.normalizeZ,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return U.unsafeLadder(this,r).is0()}toAffine(m){return v(this,m)}clearCofactor(){const{h:m}=e;return m===je?this:this.multiplyUnsafe(m)}static fromHex(m,S=!1){const{d:T,a:$}=e,R=i.BYTES;m=$t("pointHex",m,R),pn("zip215",S);const k=m.slice(),j=m[R-1];k[R-1]=j&-129;const F=ds(k),K=S?h:i.ORDER;Xi("pointHex.y",F,ut,K);const V=l(F*F),H=l(V-je),ie=l(T*V-$);let{isValid:te,value:Y}=f(H,ie);if(!te)throw new Error("Point.fromHex: invalid y coordinate");const ue=(Y&je)===je,Ie=(j&128)!==0;if(!S&&Y===ut&&Ie)throw new Error("Point.fromHex: x=0 and x_0=1");return Ie!==ue&&(Y=l(-Y)),b.fromAffine({x:Y,y:F})}static fromPrivateKey(m){return w(m).point}toRawBytes(){const{x:m,y:S}=this.toAffine(),T=jn(S,i.BYTES);return T[T.length-1]|=m&je?128:0,T}toHex(){return No(this.toRawBytes())}}b.BASE=new b(e.Gx,e.Gy,je,l(e.Gx*e.Gy)),b.ZERO=new b(ut,je,je,ut);const{BASE:O,ZERO:I}=b,U=ny(b,a*8);function B(x){return be(x,r)}function P(x){return B(ds(x))}function w(x){const m=i.BYTES;x=$t("private key",x,m);const S=$t("hashed private key",n(x),2*m),T=p(S.slice(0,m)),$=S.slice(m,2*m),R=P(T),k=O.multiply(R),j=k.toRawBytes();return{head:T,prefix:$,scalar:R,point:k,pointBytes:j}}function A(x){return w(x).pointBytes}function _(x=new Uint8Array,...m){const S=Ka(...m);return P(n(d(S,$t("context",x),!!s)))}function D(x,m,S={}){x=$t("message",x),s&&(x=s(x));const{prefix:T,scalar:$,pointBytes:R}=w(m),k=_(S.context,T,x),j=O.multiply(k).toRawBytes(),F=_(S.context,j,R,x),K=B(k+F*$);Xi("signature.s",K,ut,r);const V=Ka(j,jn(K,i.BYTES));return $t("result",V,i.BYTES*2)}const C=hy;function L(x,m,S,T=C){const{context:$,zip215:R}=T,k=i.BYTES;x=$t("signature",x,2*k),m=$t("message",m),S=$t("publicKey",S,k),R!==void 0&&pn("zip215",R),s&&(m=s(m));const j=ds(x.slice(k,2*k));let F,K,V;try{F=b.fromHex(S,R),K=b.fromHex(x.slice(0,k),R),V=O.multiplyUnsafe(j)}catch{return!1}if(!R&&F.isSmallOrder())return!1;const H=_($,K.toRawBytes(),F.toRawBytes(),m);return K.add(F.multiplyUnsafe(H)).subtract(V).clearCofactor().equals(b.ZERO)}return O._setWindowSize(8),{CURVE:e,getPublicKey:A,sign:D,verify:L,ExtendedPoint:b,utils:{getExtendedPublicKey:w,randomPrivateKey:()=>o(i.BYTES),precompute(x=8,m=b.BASE){return m._setWindowSize(x),m.multiply(BigInt(3)),m}}}}BigInt(0),BigInt(1);const Bo=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ja=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const fy=BigInt(1),Za=BigInt(2);BigInt(3);const dy=BigInt(5),py=BigInt(8);function gy(t){const e=BigInt(10),i=BigInt(20),r=BigInt(40),s=BigInt(80),n=Bo,o=t*t%n*t%n,a=bt(o,Za,n)*o%n,c=bt(a,fy,n)*t%n,h=bt(c,dy,n)*c%n,l=bt(h,e,n)*h%n,u=bt(l,i,n)*l%n,f=bt(u,r,n)*u%n,p=bt(f,s,n)*f%n,d=bt(p,s,n)*f%n,g=bt(d,e,n)*h%n;return{pow_p_5_8:bt(g,Za,n)*t%n,b2:o}}function yy(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function wy(t,e){const i=Bo,r=be(e*e*e,i),s=be(r*r*e,i),n=gy(t*s).pow_p_5_8;let o=be(t*r*n,i);const a=be(e*o*o,i),c=o,h=be(o*Ja,i),l=a===t,u=a===be(-t,i),f=a===be(-t*Ja,i);return l&&(o=c),(u||f)&&(o=h),Xg(o,i)&&(o=be(-o,i)),{isValid:l||u,value:o}}const by=bl(Bo,void 0,!0),my={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:by,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:py,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:zg,randomBytes:ul,adjustScalarBytes:yy,uvRatio:wy},El=uy(my),vy="EdDSA",Ey="JWT",Is=".",js="base64url",_l="utf8",xl="utf8",_y=":",xy="did",Iy="key",Xa="base58btc",Sy="z",Dy="K36",$y=32;function ko(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Il(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ko(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Sl(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const i=Il(e);let r=0;for(const s of t)i.set(s,r),r+=s.length;return ko(i)}function Oy(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(i[o]!==255)throw new TypeError(n+" is ambiguous");i[o]=s}var a=t.length,c=t.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,v=0,E=d.length;v!==E&&d[v]===0;)v++,g++;for(var b=(E-v)*l+1>>>0,O=new Uint8Array(b);v!==E;){for(var I=d[v],U=0,B=b-1;(I!==0||U<y)&&B!==-1;B--,U++)I+=256*O[B]>>>0,O[B]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");y=U,v++}for(var P=b-y;P!==b&&O[P]===0;)P++;for(var w=c.repeat(g);P<b;++P)w+=t.charAt(O[P]);return w}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,v=0;d[g]===c;)y++,g++;for(var E=(d.length-g)*h+1>>>0,b=new Uint8Array(E);d[g];){var O=i[d.charCodeAt(g)];if(O===255)return;for(var I=0,U=E-1;(O!==0||I<v)&&U!==-1;U--,I++)O+=a*b[U]>>>0,b[U]=O%256>>>0,O=O/256>>>0;if(O!==0)throw new Error("Non-zero carry");v=I,g++}if(d[g]!==" "){for(var B=E-v;B!==E&&b[B]===0;)B++;for(var P=new Uint8Array(y+(E-B)),w=y;B!==E;)P[w++]=b[B++];return P}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:f,decode:p}}var Ay=Oy,Ty=Ay;const Dl=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Py=t=>new TextEncoder().encode(t),Cy=t=>new TextDecoder().decode(t);let Uy=class{constructor(e,i,r){this.name=e,this.prefix=i,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ny=class{constructor(e,i,r){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return $l(this,e)}},Ry=class{constructor(e){this.decoders=e}or(e){return $l(this,e)}decode(e){const i=e[0],r=this.decoders[i];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const $l=(t,e)=>new Ry({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});let By=class{constructor(e,i,r,s){this.name=e,this.prefix=i,this.baseEncode=r,this.baseDecode=s,this.encoder=new Uy(e,i,r),this.decoder=new Ny(e,i,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Fs=({name:t,prefix:e,encode:i,decode:r})=>new By(t,e,i,r),kr=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:s}=Ty(i,e);return Fs({prefix:t,name:e,encode:r,decode:n=>Dl(s(n))})},ky=(t,e,i,r)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*i/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const u=s[t[l]];if(u===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<i|u,a+=i,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Ly=(t,e,i)=>{const r=e[e.length-1]==="=",s=(1<<i)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>i;)o-=i,n+=e[s&a>>o];if(o&&(n+=e[s&a<<i-o]),r)for(;n.length*i&7;)n+="=";return n},Ae=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>Fs({prefix:e,name:t,encode(s){return Ly(s,r,i)},decode(s){return ky(s,r,i,t)}}),My=Fs({prefix:"\0",name:"identity",encode:t=>Cy(t),decode:t=>Py(t)});var zy=Object.freeze({__proto__:null,identity:My});const qy=Ae({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var jy=Object.freeze({__proto__:null,base2:qy});const Fy=Ae({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ky=Object.freeze({__proto__:null,base8:Fy});const Vy=kr({prefix:"9",name:"base10",alphabet:"0123456789"});var Hy=Object.freeze({__proto__:null,base10:Vy});const Wy=Ae({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Gy=Ae({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Yy=Object.freeze({__proto__:null,base16:Wy,base16upper:Gy});const Jy=Ae({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Zy=Ae({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Xy=Ae({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Qy=Ae({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),e0=Ae({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),t0=Ae({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),i0=Ae({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),r0=Ae({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),s0=Ae({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var n0=Object.freeze({__proto__:null,base32:Jy,base32upper:Zy,base32pad:Xy,base32padupper:Qy,base32hex:e0,base32hexupper:t0,base32hexpad:i0,base32hexpadupper:r0,base32z:s0});const o0=kr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),a0=kr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var c0=Object.freeze({__proto__:null,base36:o0,base36upper:a0});const h0=kr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),l0=kr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var u0=Object.freeze({__proto__:null,base58btc:h0,base58flickr:l0});const f0=Ae({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),d0=Ae({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),p0=Ae({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),g0=Ae({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var y0=Object.freeze({__proto__:null,base64:f0,base64pad:d0,base64url:p0,base64urlpad:g0});const Ol=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),w0=Ol.reduce((t,e,i)=>(t[i]=e,t),[]),b0=Ol.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function m0(t){return t.reduce((e,i)=>(e+=w0[i],e),"")}function v0(t){const e=[];for(const i of t){const r=b0[i.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(r)}return new Uint8Array(e)}const E0=Fs({prefix:"🚀",name:"base256emoji",encode:m0,decode:v0});var _0=Object.freeze({__proto__:null,base256emoji:E0}),x0=Al,Qa=128,I0=127,S0=~I0,D0=Math.pow(2,31);function Al(t,e,i){e=e||[],i=i||0;for(var r=i;t>=D0;)e[i++]=t&255|Qa,t/=128;for(;t&S0;)e[i++]=t&255|Qa,t>>>=7;return e[i]=t|0,Al.bytes=i-r+1,e}var $0=Kn,O0=128,ec=127;function Kn(t,r){var i=0,r=r||0,s=0,n=r,o,a=t.length;do{if(n>=a)throw Kn.bytes=0,new RangeError("Could not decode varint");o=t[n++],i+=s<28?(o&ec)<<s:(o&ec)*Math.pow(2,s),s+=7}while(o>=O0);return Kn.bytes=n-r,i}var A0=Math.pow(2,7),T0=Math.pow(2,14),P0=Math.pow(2,21),C0=Math.pow(2,28),U0=Math.pow(2,35),N0=Math.pow(2,42),R0=Math.pow(2,49),B0=Math.pow(2,56),k0=Math.pow(2,63),L0=function(t){return t<A0?1:t<T0?2:t<P0?3:t<C0?4:t<U0?5:t<N0?6:t<R0?7:t<B0?8:t<k0?9:10},M0={encode:x0,decode:$0,encodingLength:L0},Tl=M0;const tc=(t,e,i=0)=>(Tl.encode(t,e,i),e),ic=t=>Tl.encodingLength(t),Vn=(t,e)=>{const i=e.byteLength,r=ic(t),s=r+ic(i),n=new Uint8Array(s+i);return tc(t,n,0),tc(i,n,r),n.set(e,s),new z0(t,i,e,n)};let z0=class{constructor(e,i,r,s){this.code=e,this.size=i,this.digest=r,this.bytes=s}};const Pl=({name:t,code:e,encode:i})=>new q0(t,e,i);let q0=class{constructor(e,i,r){this.name=e,this.code=i,this.encode=r}digest(e){if(e instanceof Uint8Array){const i=this.encode(e);return i instanceof Uint8Array?Vn(this.code,i):i.then(r=>Vn(this.code,r))}else throw Error("Unknown type, must be binary type")}};const Cl=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),j0=Pl({name:"sha2-256",code:18,encode:Cl("SHA-256")}),F0=Pl({name:"sha2-512",code:19,encode:Cl("SHA-512")});var K0=Object.freeze({__proto__:null,sha256:j0,sha512:F0});const Ul=0,V0="identity",Nl=Dl,H0=t=>Vn(Ul,Nl(t)),W0={code:Ul,name:V0,encode:Nl,digest:H0};var G0=Object.freeze({__proto__:null,identity:W0});new TextEncoder,new TextDecoder;const rc={...zy,...jy,...Ky,...Hy,...Yy,...n0,...c0,...u0,...y0,..._0};({...K0,...G0});function Rl(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const sc=Rl("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),vn=Rl("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=Il(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),Bl={utf8:sc,"utf-8":sc,hex:rc.base16,latin1:vn,ascii:vn,binary:vn,...rc};function Ks(t,e="utf8"){const i=Bl[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):i.encoder.encode(t).substring(1)}function ji(t,e="utf8"){const i=Bl[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ko(globalThis.Buffer.from(t,"utf-8")):i.decoder.decode(`${i.prefix}${t}`)}function nc(t){return ag(Ks(ji(t,js),_l))}function Ss(t){return Ks(ji(cg(t),_l),js)}function kl(t){const e=ji(Dy,Xa),i=Sy+Ks(Sl([e,t]),Xa);return[xy,Iy,i].join(_y)}function Y0(t){return Ks(t,js)}function J0(t){return ji(t,js)}function Z0(t){return ji([Ss(t.header),Ss(t.payload)].join(Is),xl)}function X0(t){return[Ss(t.header),Ss(t.payload),Y0(t.signature)].join(Is)}function Hn(t){const e=t.split(Is),i=nc(e[0]),r=nc(e[1]),s=J0(e[2]),n=ji(e.slice(0,2).join(Is),xl);return{header:i,payload:r,signature:s,data:n}}function oc(t=ul($y)){const e=El.getPublicKey(t);return{secretKey:Sl([t,e]),publicKey:e}}async function Q0(t,e,i,r,s=M.fromMiliseconds(Date.now())){const n={alg:vy,typ:Ey},o=kl(r.publicKey),a=s+i,c={iss:o,sub:t,aud:e,iat:s,exp:a},h=Z0({header:n,payload:c}),l=El.sign(h,r.secretKey.slice(0,32));return X0({header:n,payload:c,signature:l})}var ac=function(t,e,i){if(i||arguments.length===2)for(var r=0,s=e.length,n;r<s;r++)(n||!(r in e))&&(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))},ew=function(){function t(e,i,r){this.name=e,this.version=i,this.os=r,this.type="browser"}return t}(),tw=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),iw=function(){function t(e,i,r,s){this.name=e,this.version=i,this.os=r,this.bot=s,this.type="bot-device"}return t}(),rw=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),sw=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),nw=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,ow=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,cc=3,aw=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",nw]],hc=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function cw(t){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new sw:typeof navigator<"u"?lw(navigator.userAgent):fw()}function hw(t){return t!==""&&aw.reduce(function(e,i){var r=i[0],s=i[1];if(e)return e;var n=s.exec(t);return!!n&&[r,n]},!1)}function lw(t){var e=hw(t);if(!e)return null;var i=e[0],r=e[1];if(i==="searchbot")return new rw;var s=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);s?s.length<cc&&(s=ac(ac([],s,!0),dw(cc-s.length),!0)):s=[];var n=s.join("."),o=uw(t),a=ow.exec(t);return a&&a[1]?new iw(i,n,o,a[1]):new ew(i,n,o)}function uw(t){for(var e=0,i=hc.length;e<i;e++){var r=hc[e],s=r[0],n=r[1],o=n.exec(t);if(o)return s}return null}function fw(){var t=typeof process<"u"&&process.version;return t?new tw(process.version.slice(1)):null}function dw(t){for(var e=[],i=0;i<t;i++)e.push("0");return e}var ce={};Object.defineProperty(ce,"__esModule",{value:!0});ce.getLocalStorage=ce.getLocalStorageOrThrow=ce.getCrypto=ce.getCryptoOrThrow=Ll=ce.getLocation=ce.getLocationOrThrow=Lo=ce.getNavigator=ce.getNavigatorOrThrow=wi=ce.getDocument=ce.getDocumentOrThrow=ce.getFromWindowOrThrow=ce.getFromWindow=void 0;function Ii(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}ce.getFromWindow=Ii;function Fi(t){const e=Ii(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}ce.getFromWindowOrThrow=Fi;function pw(){return Fi("document")}ce.getDocumentOrThrow=pw;function gw(){return Ii("document")}var wi=ce.getDocument=gw;function yw(){return Fi("navigator")}ce.getNavigatorOrThrow=yw;function ww(){return Ii("navigator")}var Lo=ce.getNavigator=ww;function bw(){return Fi("location")}ce.getLocationOrThrow=bw;function mw(){return Ii("location")}var Ll=ce.getLocation=mw;function vw(){return Fi("crypto")}ce.getCryptoOrThrow=vw;function Ew(){return Ii("crypto")}ce.getCrypto=Ew;function _w(){return Fi("localStorage")}ce.getLocalStorageOrThrow=_w;function xw(){return Ii("localStorage")}ce.getLocalStorage=xw;var Mo={};Object.defineProperty(Mo,"__esModule",{value:!0});var Ml=Mo.getWindowMetadata=void 0;const lc=ce;function Iw(){let t,e;try{t=lc.getDocumentOrThrow(),e=lc.getLocationOrThrow()}catch{return null}function i(){const u=t.getElementsByTagName("link"),f=[];for(let p=0;p<u.length;p++){const d=u[p],g=d.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){const y=d.getAttribute("href");if(y)if(y.toLowerCase().indexOf("https:")===-1&&y.toLowerCase().indexOf("http:")===-1&&y.indexOf("//")!==0){let v=e.protocol+"//"+e.host;if(y.indexOf("/")===0)v+=y;else{const E=e.pathname.split("/");E.pop();const b=E.join("/");v+=b+"/"+y}f.push(v)}else if(y.indexOf("//")===0){const v=e.protocol+y;f.push(v)}else f.push(y)}}return f}function r(...u){const f=t.getElementsByTagName("meta");for(let p=0;p<f.length;p++){const d=f[p],g=["itemprop","property","name"].map(y=>d.getAttribute(y)).filter(y=>y?u.includes(y):!1);if(g.length&&g){const y=d.getAttribute("content");if(y)return y}}return""}function s(){let u=r("name","og:site_name","og:title","twitter:title");return u||(u=t.title),u}function n(){return r("description","og:description","twitter:description","keywords")}const o=s(),a=n(),c=e.origin,h=i();return{description:a,url:c,icons:h,name:o}}Ml=Mo.getWindowMetadata=Iw;function Or(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}function Wn(t){return Or(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}const zl="2.31.0";let Qi={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:i})=>e?`${t??"https://viem.sh"}${e}${i?`#${i}`:""}`:void 0,version:`viem@${zl}`};class bi extends Error{constructor(e,i={}){var a;const r=(()=>{var c;return i.cause instanceof bi?i.cause.details:(c=i.cause)!=null&&c.message?i.cause.message:i.details})(),s=i.cause instanceof bi&&i.cause.docsPath||i.docsPath,n=(a=Qi.getDocsUrl)==null?void 0:a.call(Qi,{...i,docsPath:s}),o=[e||"An error occurred.","",...i.metaMessages?[...i.metaMessages,""]:[],...n?[`Docs: ${n}`]:[],...r?[`Details: ${r}`]:[],...Qi.version?[`Version: ${Qi.version}`]:[]].join(`
`);super(o,i.cause?{cause:i.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=r,this.docsPath=s,this.metaMessages=i.metaMessages,this.name=i.name??this.name,this.shortMessage=e,this.version=zl}walk(e){return ql(this,e)}}function ql(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?ql(t.cause,e):e?null:t}class jl extends bi{constructor({size:e,targetSize:i,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (${e}) exceeds padding size (${i}).`,{name:"SizeExceedsPaddingSizeError"})}}function Ki(t,{dir:e,size:i=32}={}){return typeof t=="string"?Sw(t,{dir:e,size:i}):Dw(t,{dir:e,size:i})}function Sw(t,{dir:e,size:i=32}={}){if(i===null)return t;const r=t.replace("0x","");if(r.length>i*2)throw new jl({size:Math.ceil(r.length/2),targetSize:i,type:"hex"});return`0x${r[e==="right"?"padEnd":"padStart"](i*2,"0")}`}function Dw(t,{dir:e,size:i=32}={}){if(i===null)return t;if(t.length>i)throw new jl({size:t.length,targetSize:i,type:"bytes"});const r=new Uint8Array(i);for(let s=0;s<i;s++){const n=e==="right";r[n?s:i-s-1]=t[n?s:t.length-s-1]}return r}class $w extends bi{constructor({max:e,min:i,signed:r,size:s,value:n}){super(`Number "${n}" is not in safe ${s?`${s*8}-bit ${r?"signed":"unsigned"} `:""}integer range ${e?`(${i} to ${e})`:`(above ${i})`}`,{name:"IntegerOutOfRangeError"})}}class Ow extends bi{constructor({givenSize:e,maxSize:i}){super(`Size cannot exceed ${i} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Vi(t,{size:e}){if(Wn(t)>e)throw new Ow({givenSize:Wn(t),maxSize:e})}function Gn(t,e={}){const{signed:i}=e;e.size&&Vi(t,{size:e.size});const r=BigInt(t);if(!i)return r;const s=(t.length-2)/2,n=(1n<<BigInt(s)*8n-1n)-1n;return r<=n?r:r-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function Aw(t,e={}){return Number(Gn(t,e))}const Tw=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Yn(t,e={}){return typeof t=="number"||typeof t=="bigint"?Kl(t,e):typeof t=="string"?Uw(t,e):typeof t=="boolean"?Pw(t,e):Fl(t,e)}function Pw(t,e={}){const i=`0x${Number(t)}`;return typeof e.size=="number"?(Vi(i,{size:e.size}),Ki(i,{size:e.size})):i}function Fl(t,e={}){let i="";for(let s=0;s<t.length;s++)i+=Tw[t[s]];const r=`0x${i}`;return typeof e.size=="number"?(Vi(r,{size:e.size}),Ki(r,{dir:"right",size:e.size})):r}function Kl(t,e={}){const{signed:i,size:r}=e,s=BigInt(t);let n;r?i?n=(1n<<BigInt(r)*8n-1n)-1n:n=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(n=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof n=="bigint"&&i?-n-1n:0;if(n&&s>n||s<o){const c=typeof t=="bigint"?"n":"";throw new $w({max:n?`${n}${c}`:void 0,min:`${o}${c}`,signed:i,size:r,value:`${t}${c}`})}const a=`0x${(i&&s<0?(1n<<BigInt(r*8))+BigInt(s):s).toString(16)}`;return r?Ki(a,{size:r}):a}const Cw=new TextEncoder;function Uw(t,e={}){const i=Cw.encode(t);return Fl(i,e)}const Nw=new TextEncoder;function Rw(t,e={}){return typeof t=="number"||typeof t=="bigint"?kw(t,e):typeof t=="boolean"?Bw(t,e):Or(t)?Vl(t,e):Hl(t,e)}function Bw(t,e={}){const i=new Uint8Array(1);return i[0]=Number(t),typeof e.size=="number"?(Vi(i,{size:e.size}),Ki(i,{size:e.size})):i}const Ot={zero:48,nine:57,A:65,F:70,a:97,f:102};function uc(t){if(t>=Ot.zero&&t<=Ot.nine)return t-Ot.zero;if(t>=Ot.A&&t<=Ot.F)return t-(Ot.A-10);if(t>=Ot.a&&t<=Ot.f)return t-(Ot.a-10)}function Vl(t,e={}){let i=t;e.size&&(Vi(i,{size:e.size}),i=Ki(i,{dir:"right",size:e.size}));let r=i.slice(2);r.length%2&&(r=`0${r}`);const s=r.length/2,n=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=uc(r.charCodeAt(a++)),h=uc(r.charCodeAt(a++));if(c===void 0||h===void 0)throw new bi(`Invalid byte sequence ("${r[a-2]}${r[a-1]}" in "${r}").`);n[o]=c*16+h}return n}function kw(t,e){const i=Kl(t,e);return Vl(i)}function Hl(t,e={}){const i=Nw.encode(t);return typeof e.size=="number"?(Vi(i,{size:e.size}),Ki(i,{dir:"right",size:e.size})):i}const Qr=BigInt(2**32-1),fc=BigInt(32);function Lw(t,e=!1){return e?{h:Number(t&Qr),l:Number(t>>fc&Qr)}:{h:Number(t>>fc&Qr)|0,l:Number(t&Qr)|0}}function Mw(t,e=!1){const i=t.length;let r=new Uint32Array(i),s=new Uint32Array(i);for(let n=0;n<i;n++){const{h:o,l:a}=Lw(t[n],e);[r[n],s[n]]=[o,a]}return[r,s]}const zw=(t,e,i)=>t<<i|e>>>32-i,qw=(t,e,i)=>e<<i|t>>>32-i,jw=(t,e,i)=>e<<i-32|t>>>64-i,Fw=(t,e,i)=>t<<i-32|e>>>64-i,Pi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Kw(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ds(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ar(t,...e){if(!Kw(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function SS(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ds(t.outputLen),Ds(t.blockLen)}function dc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Vw(t,e){Ar(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function Hw(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Wl(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function DS(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function $S(t,e){return t<<32-e|t>>>e}const Ww=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Gw(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function Yw(t){for(let e=0;e<t.length;e++)t[e]=Gw(t[e]);return t}const pc=Ww?t=>t:Yw;function Jw(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Gl(t){return typeof t=="string"&&(t=Jw(t)),Ar(t),t}function OS(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];Ar(s),e+=s.length}const i=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const n=t[r];i.set(n,s),s+=n.length}return i}class Zw{}function Xw(t){const e=r=>t().update(Gl(r)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function AS(t=32){if(Pi&&typeof Pi.getRandomValues=="function")return Pi.getRandomValues(new Uint8Array(t));if(Pi&&typeof Pi.randomBytes=="function")return Uint8Array.from(Pi.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const Qw=BigInt(0),er=BigInt(1),eb=BigInt(2),tb=BigInt(7),ib=BigInt(256),rb=BigInt(113),Yl=[],Jl=[],Zl=[];for(let t=0,e=er,i=1,r=0;t<24;t++){[i,r]=[r,(2*i+3*r)%5],Yl.push(2*(5*r+i)),Jl.push((t+1)*(t+2)/2%64);let s=Qw;for(let n=0;n<7;n++)e=(e<<er^(e>>tb)*rb)%ib,e&eb&&(s^=er<<(er<<BigInt(n))-er);Zl.push(s)}const Xl=Mw(Zl,!0),sb=Xl[0],nb=Xl[1],gc=(t,e,i)=>i>32?jw(t,e,i):zw(t,e,i),yc=(t,e,i)=>i>32?Fw(t,e,i):qw(t,e,i);function ob(t,e=24){const i=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,h=i[c],l=i[c+1],u=gc(h,l,1)^i[a],f=yc(h,l,1)^i[a+1];for(let p=0;p<50;p+=10)t[o+p]^=u,t[o+p+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=Jl[o],c=gc(s,n,a),h=yc(s,n,a),l=Yl[o];s=t[l],n=t[l+1],t[l]=c,t[l+1]=h}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=sb[r],t[1]^=nb[r]}Wl(i)}class zo extends Zw{constructor(e,i,r,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=i,this.outputLen=r,this.enableXOF=s,this.rounds=n,Ds(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Hw(this.state)}clone(){return this._cloneInto()}keccak(){pc(this.state32),ob(this.state32,this.rounds),pc(this.state32),this.posOut=0,this.pos=0}update(e){dc(this),e=Gl(e),Ar(e);const{blockLen:i,state:r}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:r,blockLen:s}=this;e[r]^=i,i&128&&r===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){dc(this,!1),Ar(e),this.finish();const i=this.state,{blockLen:r}=this;for(let s=0,n=e.length;s<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-s);e.set(i.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ds(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Vw(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Wl(this.state)}_cloneInto(e){const{blockLen:i,suffix:r,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new zo(i,r,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const ab=(t,e,i)=>Xw(()=>new zo(e,t,i)),cb=ab(1,136,256/8);function Ql(t,e){const i=e||"hex",r=cb(Or(t,{strict:!1})?Rw(t):t);return i==="bytes"?r:Yn(r)}class hb extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const i=super.get(e);return super.has(e)&&i!==void 0&&(this.delete(e),super.set(e,i)),i}set(e,i){if(super.set(e,i),this.maxSize&&this.size>this.maxSize){const r=this.keys().next().value;r&&this.delete(r)}return this}}const En=new hb(8192);function lb(t,e){if(En.has(`${t}.${e}`))return En.get(`${t}.${e}`);const i=t.substring(2).toLowerCase(),r=Ql(Hl(i),"bytes"),s=i.split("");for(let o=0;o<40;o+=2)r[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(r[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const n=`0x${s.join("")}`;return En.set(`${t}.${e}`,n),n}function ub(t){const e=Ql(`0x${t.substring(4)}`).substring(26);return lb(`0x${e}`)}async function fb({hash:t,signature:e}){const i=Or(t)?t:Yn(t),{secp256k1:r}=await od(async()=>{const{secp256k1:o}=await import("./secp256k1-DzZtQd5f.js");return{secp256k1:o}},__vite__mapDeps([0,1,2,3]));return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:h,s:l,v:u,yParity:f}=e,p=Number(f??u),d=wc(p);return new r.Signature(Gn(h),Gn(l)).addRecoveryBit(d)}const o=Or(e)?e:Yn(e);if(Wn(o)!==65)throw new Error("invalid signature length");const a=Aw(`0x${o.slice(130)}`),c=wc(a);return r.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(i.substring(2)).toHex(!1)}`}function wc(t){if(t===0||t===1)return t;if(t===27)return 0;if(t===28)return 1;throw new Error("Invalid yParityOrV value")}async function db({hash:t,signature:e}){return ub(await fb({hash:t,signature:e}))}function pb(t){if(t.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let h=0;h<e.length;h++)e[h]=255;for(let h=0;h<t.length;h++){const l=t.charAt(h),u=l.charCodeAt(0);if(e[u]!==255)throw new TypeError(l+" is ambiguous");e[u]=h}const i=t.length,r=t.charAt(0),s=Math.log(i)/Math.log(256),n=Math.log(256)/Math.log(i);function o(h){if(h instanceof Uint8Array||(ArrayBuffer.isView(h)?h=new Uint8Array(h.buffer,h.byteOffset,h.byteLength):Array.isArray(h)&&(h=Uint8Array.from(h))),!(h instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(h.length===0)return"";let l=0,u=0,f=0;const p=h.length;for(;f!==p&&h[f]===0;)f++,l++;const d=(p-f)*n+1>>>0,g=new Uint8Array(d);for(;f!==p;){let E=h[f],b=0;for(let O=d-1;(E!==0||b<u)&&O!==-1;O--,b++)E+=256*g[O]>>>0,g[O]=E%i>>>0,E=E/i>>>0;if(E!==0)throw new Error("Non-zero carry");u=b,f++}let y=d-u;for(;y!==d&&g[y]===0;)y++;let v=r.repeat(l);for(;y<d;++y)v+=t.charAt(g[y]);return v}function a(h){if(typeof h!="string")throw new TypeError("Expected String");if(h.length===0)return new Uint8Array;let l=0,u=0,f=0;for(;h[l]===r;)u++,l++;const p=(h.length-l)*s+1>>>0,d=new Uint8Array(p);for(;l<h.length;){const E=h.charCodeAt(l);if(E>255)return;let b=e[E];if(b===255)return;let O=0;for(let I=p-1;(b!==0||O<f)&&I!==-1;I--,O++)b+=i*d[I]>>>0,d[I]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=O,l++}let g=p-f;for(;g!==p&&d[g]===0;)g++;const y=new Uint8Array(u+(p-g));let v=u;for(;g!==p;)y[v++]=d[g++];return y}function c(h){const l=a(h);if(l)return l;throw new Error("Non-base"+i+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var gb="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Lr=pb(gb);function yb(t){const e=t.length;let i=0,r=0;for(;r<e;){let s=t.charCodeAt(r++);if(s&4294967168)if(!(s&4294965248))i+=2;else{if(s>=55296&&s<=56319&&r<e){const n=t.charCodeAt(r);(n&64512)===56320&&(++r,s=((s&1023)<<10)+(n&1023)+65536)}s&4294901760?i+=4:i+=3}else{i++;continue}}return i}function wb(t,e,i){const r=t.length;let s=i,n=0;for(;n<r;){let o=t.charCodeAt(n++);if(o&4294967168)if(!(o&4294965248))e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&n<r){const a=t.charCodeAt(n);(a&64512)===56320&&(++n,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128):(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128)}else{e[s++]=o;continue}e[s++]=o&63|128}}const bb=new TextEncoder,mb=50;function vb(t,e,i){bb.encodeInto(t,e.subarray(i))}function Eb(t,e,i){t.length>mb?vb(t,e,i):wb(t,e,i)}const _b=4096;function eu(t,e,i){let r=e;const s=r+i,n=[];let o="";for(;r<s;){const a=t[r++];if(!(a&128))n.push(a);else if((a&224)===192){const c=t[r++]&63;n.push((a&31)<<6|c)}else if((a&240)===224){const c=t[r++]&63,h=t[r++]&63;n.push((a&31)<<12|c<<6|h)}else if((a&248)===240){const c=t[r++]&63,h=t[r++]&63,l=t[r++]&63;let u=(a&7)<<18|c<<12|h<<6|l;u>65535&&(u-=65536,n.push(u>>>10&1023|55296),u=56320|u&1023),n.push(u)}else n.push(a);n.length>=_b&&(o+=String.fromCharCode(...n),n.length=0)}return n.length>0&&(o+=String.fromCharCode(...n)),o}const xb=new TextDecoder,Ib=200;function Sb(t,e,i){const r=t.subarray(e,e+i);return xb.decode(r)}function Db(t,e,i){return i>Ib?Sb(t,e,i):eu(t,e,i)}class es{constructor(e,i){this.type=e,this.data=i}}class et extends Error{constructor(e){super(e);const i=Object.create(et.prototype);Object.setPrototypeOf(this,i),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:et.name})}}const tr=4294967295;function $b(t,e,i){const r=i/4294967296,s=i;t.setUint32(e,r),t.setUint32(e+4,s)}function tu(t,e,i){const r=Math.floor(i/4294967296),s=i;t.setUint32(e,r),t.setUint32(e+4,s)}function iu(t,e){const i=t.getInt32(e),r=t.getUint32(e+4);return i*4294967296+r}function Ob(t,e){const i=t.getUint32(e),r=t.getUint32(e+4);return i*4294967296+r}const Ab=-1,Tb=4294967296-1,Pb=17179869184-1;function Cb({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=Pb)if(e===0&&t<=Tb){const i=new Uint8Array(4);return new DataView(i.buffer).setUint32(0,t),i}else{const i=t/4294967296,r=t&4294967295,s=new Uint8Array(8),n=new DataView(s.buffer);return n.setUint32(0,e<<2|i&3),n.setUint32(4,r),s}else{const i=new Uint8Array(12),r=new DataView(i.buffer);return r.setUint32(0,e),tu(r,4,t),i}}function Ub(t){const e=t.getTime(),i=Math.floor(e/1e3),r=(e-i*1e3)*1e6,s=Math.floor(r/1e9);return{sec:i+s,nsec:r-s*1e9}}function Nb(t){if(t instanceof Date){const e=Ub(t);return Cb(e)}else return null}function Rb(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const i=e.getUint32(0),r=e.getUint32(4),s=(i&3)*4294967296+r,n=i>>>2;return{sec:s,nsec:n}}case 12:{const i=iu(e,4),r=e.getUint32(0);return{sec:i,nsec:r}}default:throw new et(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function Bb(t){const e=Rb(t);return new Date(e.sec*1e3+e.nsec/1e6)}const kb={type:Ab,encode:Nb,decode:Bb};class $s{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(kb)}register({type:e,encode:i,decode:r}){if(e>=0)this.encoders[e]=i,this.decoders[e]=r;else{const s=-1-e;this.builtInEncoders[s]=i,this.builtInDecoders[s]=r}}tryToEncode(e,i){for(let r=0;r<this.builtInEncoders.length;r++){const s=this.builtInEncoders[r];if(s!=null){const n=s(e,i);if(n!=null){const o=-1-r;return new es(o,n)}}}for(let r=0;r<this.encoders.length;r++){const s=this.encoders[r];if(s!=null){const n=s(e,i);if(n!=null){const o=r;return new es(o,n)}}}return e instanceof es?e:null}decode(e,i,r){const s=i<0?this.builtInDecoders[-1-i]:this.decoders[i];return s?s(e,i,r):new es(i,e)}}$s.defaultCodec=new $s;function Lb(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function Jn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Lb(t)?new Uint8Array(t):Uint8Array.from(t)}const Mb=100,zb=2048;let qb=class ru{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??$s.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??Mb,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??zb,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new ru({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,i){if(i>this.maxDepth)throw new Error(`Too deep objects in depth ${i}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,i)}ensureBufferSizeToWrite(e){const i=this.pos+e;this.view.byteLength<i&&this.resizeBuffer(i*2)}resizeBuffer(e){const i=new ArrayBuffer(e),r=new Uint8Array(i),s=new DataView(i);r.set(this.bytes),this.view=s,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const r=yb(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),Eb(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,i){const r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,i);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,i);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const i=e.byteLength;if(i<256)this.writeU8(196),this.writeU8(i);else if(i<65536)this.writeU8(197),this.writeU16(i);else if(i<4294967296)this.writeU8(198),this.writeU32(i);else throw new Error(`Too large binary: ${i}`);const r=Jn(e);this.writeU8a(r)}encodeArray(e,i){const r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(const s of e)this.doEncode(s,i+1)}countWithoutUndefined(e,i){let r=0;for(const s of i)e[s]!==void 0&&r++;return r}encodeMap(e,i){const r=Object.keys(e);this.sortKeys&&r.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const n of r){const o=e[n];this.ignoreUndefined&&o===void 0||(this.encodeString(n),this.doEncode(o,i+1))}}encodeExtension(e){if(typeof e.data=="function"){const r=e.data(this.pos+6),s=r.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(r);return}const i=e.data.length;if(i===1)this.writeU8(212);else if(i===2)this.writeU8(213);else if(i===4)this.writeU8(214);else if(i===8)this.writeU8(215);else if(i===16)this.writeU8(216);else if(i<256)this.writeU8(199),this.writeU8(i);else if(i<65536)this.writeU8(200),this.writeU16(i);else if(i<4294967296)this.writeU8(201),this.writeU32(i);else throw new Error(`Too large extension object: ${i}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const i=e.length;this.ensureBufferSizeToWrite(i),this.bytes.set(e,this.pos),this.pos+=i}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),$b(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),tu(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function jb(t,e){return new qb(e).encodeSharedRef(t)}function _n(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Fb=16,Kb=16;class Vb{constructor(e=Fb,i=Kb){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=i,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,i,r){const s=this.caches[r-1];e:for(const n of s){const o=n.bytes;for(let a=0;a<r;a++)if(o[a]!==e[i+a])continue e;return n.str}return null}store(e,i){const r=this.caches[e.length-1],s={bytes:e,str:i};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=s:r.push(s)}decode(e,i,r){const s=this.find(e,i,r);if(s!=null)return this.hit++,s;this.miss++;const n=eu(e,i,r),o=Uint8Array.prototype.slice.call(e,i,i+r);return this.store(o,n),n}}const Zn="array",wr="map_key",su="map_value",Hb=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new et("The type of key must be string or number but "+typeof t)};class Wb{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const i=this.getUninitializedStateFromPool();i.type=Zn,i.position=0,i.size=e,i.array=new Array(e)}pushMapState(e){const i=this.getUninitializedStateFromPool();i.type=wr,i.readCount=0,i.size=e,i.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Zn){const r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===wr||e.type===su){const r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const ir=-1,qo=new DataView(new ArrayBuffer(0)),Gb=new Uint8Array(qo.buffer);try{qo.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const bc=new RangeError("Insufficient data"),Yb=new Vb;let Jb=class nu{constructor(e){this.totalPos=0,this.pos=0,this.view=qo,this.bytes=Gb,this.headByte=ir,this.stack=new Wb,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??$s.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??tr,this.maxBinLength=(e==null?void 0:e.maxBinLength)??tr,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??tr,this.maxMapLength=(e==null?void 0:e.maxMapLength)??tr,this.maxExtLength=(e==null?void 0:e.maxExtLength)??tr,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:Yb,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??Hb}clone(){return new nu({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=ir,this.stack.reset()}setBuffer(e){const i=Jn(e);this.bytes=i,this.view=new DataView(i.buffer,i.byteOffset,i.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===ir&&!this.hasRemaining(1))this.setBuffer(e);else{const i=this.bytes.subarray(this.pos),r=Jn(e),s=new Uint8Array(i.length+r.length);s.set(i),s.set(r,i.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:i,pos:r}=this;return new RangeError(`Extra ${i.byteLength-r} of ${i.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const i=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return i}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let i=!1,r;for await(const a of e){if(i)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{r=this.doDecodeSync(),i=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return r}const{headByte:s,pos:n,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${_n(s)} at ${o} (${n} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,i){if(this.entered){yield*this.clone().decodeMultiAsync(e,i);return}try{this.entered=!0;let r=i,s=-1;for await(const n of e){if(i&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(n),r&&(s=this.readArraySize(),r=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let i;if(e>=224)i=e-256;else if(e<192)if(e<128)i=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else i={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else i=[]}else{const s=e-160;i=this.decodeString(s,0)}else if(e===192)i=null;else if(e===194)i=!1;else if(e===195)i=!0;else if(e===202)i=this.readF32();else if(e===203)i=this.readF64();else if(e===204)i=this.readU8();else if(e===205)i=this.readU16();else if(e===206)i=this.readU32();else if(e===207)this.useBigInt64?i=this.readU64AsBigInt():i=this.readU64();else if(e===208)i=this.readI8();else if(e===209)i=this.readI16();else if(e===210)i=this.readI32();else if(e===211)this.useBigInt64?i=this.readI64AsBigInt():i=this.readI64();else if(e===217){const s=this.lookU8();i=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();i=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();i=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else i=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else i=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else i={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else i={}}else if(e===196){const s=this.lookU8();i=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();i=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();i=this.decodeBinary(s,4)}else if(e===212)i=this.decodeExtension(1,0);else if(e===213)i=this.decodeExtension(2,0);else if(e===214)i=this.decodeExtension(4,0);else if(e===215)i=this.decodeExtension(8,0);else if(e===216)i=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();i=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();i=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();i=this.decodeExtension(s,4)}else throw new et(`Unrecognized type byte: ${_n(e)}`);this.complete();const r=this.stack;for(;r.length>0;){const s=r.top();if(s.type===Zn)if(s.array[s.position]=i,s.position++,s.position===s.size)i=s.array,r.release(s);else continue e;else if(s.type===wr){if(i==="__proto__")throw new et("The key __proto__ is not allowed");s.key=this.mapKeyConverter(i),s.type=su;continue e}else if(s.map[s.key]=i,s.readCount++,s.readCount===s.size)i=s.map,r.release(s);else{s.key=null,s.type=wr;continue e}}return i}}readHeadByte(){return this.headByte===ir&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=ir}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new et(`Unrecognized array type byte: ${_n(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new et(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new et(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,i){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,i):this.decodeBinary(e,i)}decodeUtf8String(e,i){var n;if(e>this.maxStrLength)throw new et(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+i+e)throw bc;const r=this.pos+i;let s;return this.stateIsMapKey()&&((n=this.keyDecoder)!=null&&n.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,r,e):s=Db(this.bytes,r,e),this.pos+=i+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===wr:!1}decodeBinary(e,i){if(e>this.maxBinLength)throw new et(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+i))throw bc;const r=this.pos+i,s=this.bytes.subarray(r,r+e);return this.pos+=i+e,s}decodeExtension(e,i){if(e>this.maxExtLength)throw new et(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const r=this.view.getInt8(this.pos+i),s=this.decodeBinary(e,i+1);return this.extensionCodec.decode(s,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=Ob(this.view,this.pos);return this.pos+=8,e}readI64(){const e=iu(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function Zb(t,e){return new Jb(e).decode(t)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Xb(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ou(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(i=>typeof i=="string"):e.every(i=>Number.isSafeInteger(i)):!1}function Os(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function jo(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function Xn(t){if(!Array.isArray(t))throw new Error("array expected")}function As(t,e){if(!ou(!0,e))throw new Error(`${t}: array of strings expected`)}function Qb(t,e){if(!ou(!1,e))throw new Error(`${t}: array of numbers expected`)}function em(...t){const e=n=>n,i=(n,o)=>a=>n(o(a)),r=t.map(n=>n.encode).reduceRight(i,e),s=t.map(n=>n.decode).reduce(i,e);return{encode:r,decode:s}}function tm(t){const e=typeof t=="string"?t.split(""):t,i=e.length;As("alphabet",e);const r=new Map(e.map((s,n)=>[s,n]));return{encode:s=>(Xn(s),s.map(n=>{if(!Number.isSafeInteger(n)||n<0||n>=i)throw new Error(`alphabet.encode: digit index outside alphabet "${n}". Allowed: ${t}`);return e[n]})),decode:s=>(Xn(s),s.map(n=>{Os("alphabet.decode",n);const o=r.get(n);if(o===void 0)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return o}))}}function im(t=""){return Os("join",t),{encode:e=>(As("join.decode",e),e.join(t)),decode:e=>(Os("join.decode",e),e.split(t))}}function rm(t,e="="){return jo(t),Os("padding",e),{encode(i){for(As("padding.encode",i);i.length*t%8;)i.push(e);return i},decode(i){As("padding.decode",i);let r=i.length;if(r*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&i[r-1]===e;r--)if((r-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return i.slice(0,r)}}}const au=(t,e)=>e===0?t:au(e,t%e),Ts=(t,e)=>t+(e-au(t,e)),xn=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function mc(t,e,i,r){if(Xn(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(i<=0||i>32)throw new Error(`convertRadix2: wrong to=${i}`);if(Ts(e,i)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${i} carryBits=${Ts(e,i)}`);let s=0,n=0;const o=xn[e],a=xn[i]-1,c=[];for(const h of t){if(jo(h),h>=o)throw new Error(`convertRadix2: invalid data word=${h} from=${e}`);if(s=s<<e|h,n+e>32)throw new Error(`convertRadix2: carry overflow pos=${n} from=${e}`);for(n+=e;n>=i;n-=i)c.push((s>>n-i&a)>>>0);const l=xn[n];if(l===void 0)throw new Error("invalid carry");s&=l-1}if(s=s<<i-n&a,!r&&n>=e)throw new Error("Excess padding");if(!r&&s>0)throw new Error(`Non-zero padding: ${s}`);return r&&n>0&&c.push(s>>>0),c}function sm(t,e=!1){if(jo(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Ts(8,t)>32||Ts(t,8)>32)throw new Error("radix2: carry overflow");return{encode:i=>{if(!Xb(i))throw new Error("radix2.encode input should be Uint8Array");return mc(Array.from(i),8,t,!e)},decode:i=>(Qb("radix2.decode",i),Uint8Array.from(mc(i,t,8,e)))}}const nm=em(sm(5),tm("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),rm(5),im(""));function Fo(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function cu(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Fo(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function br(t,e){e||(e=t.reduce((s,n)=>s+n.length,0));const i=cu(e);let r=0;for(const s of t)i.set(s,r),r+=s.length;return Fo(i)}function om(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(i[o]!==255)throw new TypeError(n+" is ambiguous");i[o]=s}var a=t.length,c=t.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,v=0,E=d.length;v!==E&&d[v]===0;)v++,g++;for(var b=(E-v)*l+1>>>0,O=new Uint8Array(b);v!==E;){for(var I=d[v],U=0,B=b-1;(I!==0||U<y)&&B!==-1;B--,U++)I+=256*O[B]>>>0,O[B]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");y=U,v++}for(var P=b-y;P!==b&&O[P]===0;)P++;for(var w=c.repeat(g);P<b;++P)w+=t.charAt(O[P]);return w}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,v=0;d[g]===c;)y++,g++;for(var E=(d.length-g)*h+1>>>0,b=new Uint8Array(E);d[g];){var O=i[d.charCodeAt(g)];if(O===255)return;for(var I=0,U=E-1;(O!==0||I<v)&&U!==-1;U--,I++)O+=a*b[U]>>>0,b[U]=O%256>>>0,O=O/256>>>0;if(O!==0)throw new Error("Non-zero carry");v=I,g++}if(d[g]!==" "){for(var B=E-v;B!==E&&b[B]===0;)B++;for(var P=new Uint8Array(y+(E-B)),w=y;B!==E;)P[w++]=b[B++];return P}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:f,decode:p}}var am=om,cm=am;const hm=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},lm=t=>new TextEncoder().encode(t),um=t=>new TextDecoder().decode(t);class fm{constructor(e,i,r){this.name=e,this.prefix=i,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class dm{constructor(e,i,r){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return hu(this,e)}}class pm{constructor(e){this.decoders=e}or(e){return hu(this,e)}decode(e){const i=e[0],r=this.decoders[i];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const hu=(t,e)=>new pm({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class gm{constructor(e,i,r,s){this.name=e,this.prefix=i,this.baseEncode=r,this.baseDecode=s,this.encoder=new fm(e,i,r),this.decoder=new dm(e,i,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Vs=({name:t,prefix:e,encode:i,decode:r})=>new gm(t,e,i,r),Mr=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:s}=cm(i,e);return Vs({prefix:t,name:e,encode:r,decode:n=>hm(s(n))})},ym=(t,e,i,r)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*i/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const u=s[t[l]];if(u===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<i|u,a+=i,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},wm=(t,e,i)=>{const r=e[e.length-1]==="=",s=(1<<i)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>i;)o-=i,n+=e[s&a>>o];if(o&&(n+=e[s&a<<i-o]),r)for(;n.length*i&7;)n+="=";return n},Te=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>Vs({prefix:e,name:t,encode(s){return wm(s,r,i)},decode(s){return ym(s,r,i,t)}}),bm=Vs({prefix:"\0",name:"identity",encode:t=>um(t),decode:t=>lm(t)}),mm=Object.freeze(Object.defineProperty({__proto__:null,identity:bm},Symbol.toStringTag,{value:"Module"})),vm=Te({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Em=Object.freeze(Object.defineProperty({__proto__:null,base2:vm},Symbol.toStringTag,{value:"Module"})),_m=Te({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),xm=Object.freeze(Object.defineProperty({__proto__:null,base8:_m},Symbol.toStringTag,{value:"Module"})),Im=Mr({prefix:"9",name:"base10",alphabet:"0123456789"}),Sm=Object.freeze(Object.defineProperty({__proto__:null,base10:Im},Symbol.toStringTag,{value:"Module"})),Dm=Te({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),$m=Te({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Om=Object.freeze(Object.defineProperty({__proto__:null,base16:Dm,base16upper:$m},Symbol.toStringTag,{value:"Module"})),Am=Te({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Tm=Te({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Pm=Te({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Cm=Te({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Um=Te({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Nm=Te({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Rm=Te({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Bm=Te({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),km=Te({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Lm=Object.freeze(Object.defineProperty({__proto__:null,base32:Am,base32hex:Um,base32hexpad:Rm,base32hexpadupper:Bm,base32hexupper:Nm,base32pad:Pm,base32padupper:Cm,base32upper:Tm,base32z:km},Symbol.toStringTag,{value:"Module"})),Mm=Mr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),zm=Mr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),qm=Object.freeze(Object.defineProperty({__proto__:null,base36:Mm,base36upper:zm},Symbol.toStringTag,{value:"Module"})),jm=Mr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Fm=Mr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Km=Object.freeze(Object.defineProperty({__proto__:null,base58btc:jm,base58flickr:Fm},Symbol.toStringTag,{value:"Module"})),Vm=Te({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Hm=Te({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Wm=Te({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Gm=Te({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Ym=Object.freeze(Object.defineProperty({__proto__:null,base64:Vm,base64pad:Hm,base64url:Wm,base64urlpad:Gm},Symbol.toStringTag,{value:"Module"})),lu=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Jm=lu.reduce((t,e,i)=>(t[i]=e,t),[]),Zm=lu.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function Xm(t){return t.reduce((e,i)=>(e+=Jm[i],e),"")}function Qm(t){const e=[];for(const i of t){const r=Zm[i.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(r)}return new Uint8Array(e)}const e1=Vs({prefix:"🚀",name:"base256emoji",encode:Xm,decode:Qm}),t1=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:e1},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const vc={...mm,...Em,...xm,...Sm,...Om,...Lm,...qm,...Km,...Ym,...t1};function uu(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const Ec=uu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),In=uu("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=cu(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),fu={utf8:Ec,"utf-8":Ec,hex:vc.base16,latin1:In,ascii:In,binary:In,...vc};function ct(t,e="utf8"){const i=fu[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Fo(globalThis.Buffer.from(t,"utf-8")):i.decoder.decode(`${i.prefix}${t}`)}function Je(t,e="utf8"){const i=fu[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):i.encoder.encode(t).substring(1)}const i1={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}},r1="Input must be an string, Buffer or Uint8Array";function s1(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(r1);return e}function n1(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function ts(t){return(4294967296+t).toString(16).substring(1)}function o1(t,e,i){let r=`
`+t+" = ";for(let s=0;s<e.length;s+=2){if(i===32)r+=ts(e[s]).toUpperCase(),r+=" ",r+=ts(e[s+1]).toUpperCase();else if(i===64)r+=ts(e[s+1]).toUpperCase(),r+=ts(e[s]).toUpperCase();else throw new Error("Invalid size "+i);s%6===4?r+=`
`+new Array(t.length+4).join(" "):s<e.length-2&&(r+=" ")}console.log(r)}function a1(t,e,i){let r=new Date().getTime();const s=new Uint8Array(e);for(let o=0;o<e;o++)s[o]=o%256;const n=new Date().getTime();console.log("Generated random input in "+(n-r)+"ms"),r=n;for(let o=0;o<i;o++){const a=t(s),c=new Date().getTime(),h=c-r;r=c,console.log("Hashed in "+h+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(h/1e3)*100)/100+" MB PER SECOND")}}var du={normalizeInput:s1,toHex:n1,debugPrint:o1,testSpeed:a1};const ps=du;function is(t,e,i){const r=t[e]+t[i];let s=t[e+1]+t[i+1];r>=4294967296&&s++,t[e]=r,t[e+1]=s}function _c(t,e,i,r){let s=t[e]+i;i<0&&(s+=4294967296);let n=t[e+1]+r;s>=4294967296&&n++,t[e]=s,t[e+1]=n}function pu(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Mt(t,e,i,r,s,n){const o=dr[s],a=dr[s+1],c=dr[n],h=dr[n+1];is(W,t,e),_c(W,t,o,a);let l=W[r]^W[t],u=W[r+1]^W[t+1];W[r]=u,W[r+1]=l,is(W,i,r),l=W[e]^W[i],u=W[e+1]^W[i+1],W[e]=l>>>24^u<<8,W[e+1]=u>>>24^l<<8,is(W,t,e),_c(W,t,c,h),l=W[r]^W[t],u=W[r+1]^W[t+1],W[r]=l>>>16^u<<16,W[r+1]=u>>>16^l<<16,is(W,i,r),l=W[e]^W[i],u=W[e+1]^W[i+1],W[e]=u>>>31^l<<1,W[e+1]=l>>>31^u<<1}const gu=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),c1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],Ce=new Uint8Array(c1.map(function(t){return t*2})),W=new Uint32Array(32),dr=new Uint32Array(32);function yu(t,e){let i=0;for(i=0;i<16;i++)W[i]=t.h[i],W[i+16]=gu[i];for(W[24]=W[24]^t.t,W[25]=W[25]^t.t/4294967296,e&&(W[28]=~W[28],W[29]=~W[29]),i=0;i<32;i++)dr[i]=pu(t.b,4*i);for(i=0;i<12;i++)Mt(0,8,16,24,Ce[i*16+0],Ce[i*16+1]),Mt(2,10,18,26,Ce[i*16+2],Ce[i*16+3]),Mt(4,12,20,28,Ce[i*16+4],Ce[i*16+5]),Mt(6,14,22,30,Ce[i*16+6],Ce[i*16+7]),Mt(0,10,20,30,Ce[i*16+8],Ce[i*16+9]),Mt(2,12,22,24,Ce[i*16+10],Ce[i*16+11]),Mt(4,14,16,26,Ce[i*16+12],Ce[i*16+13]),Mt(6,8,18,28,Ce[i*16+14],Ce[i*16+15]);for(i=0;i<16;i++)t.h[i]=t.h[i]^W[i]^W[i+16]}const zt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function wu(t,e,i,r){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(i&&i.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(r&&r.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const s={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};zt.fill(0),zt[0]=t,e&&(zt[1]=e.length),zt[2]=1,zt[3]=1,i&&zt.set(i,32),r&&zt.set(r,48);for(let n=0;n<16;n++)s.h[n]=gu[n]^pu(zt,n*4);return e&&(Ko(s,e),s.c=128),s}function Ko(t,e){for(let i=0;i<e.length;i++)t.c===128&&(t.t+=t.c,yu(t,!1),t.c=0),t.b[t.c++]=e[i]}function bu(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;yu(t,!0);const e=new Uint8Array(t.outlen);for(let i=0;i<t.outlen;i++)e[i]=t.h[i>>2]>>8*(i&3);return e}function mu(t,e,i,r,s){i=i||64,t=ps.normalizeInput(t),r&&(r=ps.normalizeInput(r)),s&&(s=ps.normalizeInput(s));const n=wu(i,e,r,s);return Ko(n,t),bu(n)}function h1(t,e,i,r,s){const n=mu(t,e,i,r,s);return ps.toHex(n)}var l1={blake2b:mu,blake2bHex:h1,blake2bInit:wu,blake2bUpdate:Ko,blake2bFinal:bu};const vu=du;function u1(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function qt(t,e,i,r,s,n){ee[t]=ee[t]+ee[e]+s,ee[r]=rs(ee[r]^ee[t],16),ee[i]=ee[i]+ee[r],ee[e]=rs(ee[e]^ee[i],12),ee[t]=ee[t]+ee[e]+n,ee[r]=rs(ee[r]^ee[t],8),ee[i]=ee[i]+ee[r],ee[e]=rs(ee[e]^ee[i],7)}function rs(t,e){return t>>>e^t<<32-e}const Eu=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ue=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ee=new Uint32Array(16),Se=new Uint32Array(16);function _u(t,e){let i=0;for(i=0;i<8;i++)ee[i]=t.h[i],ee[i+8]=Eu[i];for(ee[12]^=t.t,ee[13]^=t.t/4294967296,e&&(ee[14]=~ee[14]),i=0;i<16;i++)Se[i]=u1(t.b,4*i);for(i=0;i<10;i++)qt(0,4,8,12,Se[Ue[i*16+0]],Se[Ue[i*16+1]]),qt(1,5,9,13,Se[Ue[i*16+2]],Se[Ue[i*16+3]]),qt(2,6,10,14,Se[Ue[i*16+4]],Se[Ue[i*16+5]]),qt(3,7,11,15,Se[Ue[i*16+6]],Se[Ue[i*16+7]]),qt(0,5,10,15,Se[Ue[i*16+8]],Se[Ue[i*16+9]]),qt(1,6,11,12,Se[Ue[i*16+10]],Se[Ue[i*16+11]]),qt(2,7,8,13,Se[Ue[i*16+12]],Se[Ue[i*16+13]]),qt(3,4,9,14,Se[Ue[i*16+14]],Se[Ue[i*16+15]]);for(i=0;i<8;i++)t.h[i]^=ee[i]^ee[i+8]}function xu(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");const i=e?e.length:0;if(e&&!(i>0&&i<=32))throw new Error("Incorrect key length, should be in [1, 32]");const r={h:new Uint32Array(Eu),b:new Uint8Array(64),c:0,t:0,outlen:t};return r.h[0]^=16842752^i<<8^t,i>0&&(Vo(r,e),r.c=64),r}function Vo(t,e){for(let i=0;i<e.length;i++)t.c===64&&(t.t+=t.c,_u(t,!1),t.c=0),t.b[t.c++]=e[i]}function Iu(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;_u(t,!0);const e=new Uint8Array(t.outlen);for(let i=0;i<t.outlen;i++)e[i]=t.h[i>>2]>>8*(i&3)&255;return e}function Su(t,e,i){i=i||32,t=vu.normalizeInput(t);const r=xu(i,e);return Vo(r,t),Iu(r)}function f1(t,e,i){const r=Su(t,e,i);return vu.toHex(r)}var d1={blake2s:Su,blake2sHex:f1,blake2sInit:xu,blake2sUpdate:Vo,blake2sFinal:Iu};const rr=l1,sr=d1;var p1={blake2b:rr.blake2b,blake2bHex:rr.blake2bHex,blake2bInit:rr.blake2bInit,blake2bUpdate:rr.blake2bUpdate,blake2bFinal:rr.blake2bFinal,blake2s:sr.blake2s,blake2sHex:sr.blake2sHex,blake2sInit:sr.blake2sInit,blake2sUpdate:sr.blake2sUpdate,blake2sFinal:sr.blake2sFinal},g1={};const y1=":";function gs(t){const[e,i]=t.split(y1);return{namespace:e,reference:i}}function Du(t,e){return t.includes(":")?[t]:e.chains||[]}var w1=Object.defineProperty,b1=Object.defineProperties,m1=Object.getOwnPropertyDescriptors,xc=Object.getOwnPropertySymbols,v1=Object.prototype.hasOwnProperty,E1=Object.prototype.propertyIsEnumerable,Qn=(t,e,i)=>e in t?w1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ic=(t,e)=>{for(var i in e||(e={}))v1.call(e,i)&&Qn(t,i,e[i]);if(xc)for(var i of xc(e))E1.call(e,i)&&Qn(t,i,e[i]);return t},_1=(t,e)=>b1(t,m1(e)),Sc=(t,e,i)=>Qn(t,typeof e!="symbol"?e+"":e,i);const x1="ReactNative",tt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},I1="js";function Ps(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function ri(){return!wi()&&!!Lo()&&navigator.product===x1}function S1(){return ri()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="android"}function D1(){return ri()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"&&(globalThis==null?void 0:globalThis.Platform.OS)==="ios"}function Hi(){return!Ps()&&!!Lo()&&!!wi()}function zr(){return ri()?tt.reactNative:Ps()?tt.node:Hi()?tt.browser:tt.unknown}function Dc(){var t;try{return ri()&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Application)<"u"?(t=globalThis.Application)==null?void 0:t.applicationId:void 0}catch{return}}function $1(t,e){const i=new URLSearchParams(t);for(const r of Object.keys(e).sort())if(e.hasOwnProperty(r)){const s=e[r];s!==void 0&&i.set(r,s)}return i.toString()}function O1(t){var e,i;const r=$u();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(s=>s!=="")),_1(Ic(Ic({},r),t),{url:(t==null?void 0:t.url)||r.url,name:(t==null?void 0:t.name)||r.name,description:(t==null?void 0:t.description)||r.description,icons:(i=t==null?void 0:t.icons)!=null&&i.length&&t.icons.length>0?t.icons:r.icons})}catch(s){return console.warn("Error populating app metadata",s),t||r}}function $u(){return Ml()||{name:"",description:"",url:"",icons:[""]}}function A1(){if(zr()===tt.reactNative&&typeof globalThis<"u"&&typeof(globalThis==null?void 0:globalThis.Platform)<"u"){const{OS:i,Version:r}=globalThis.Platform;return[i,r].join("-")}const t=cw();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function T1(){var t;const e=zr();return e===tt.browser?[e,((t=Ll())==null?void 0:t.host)||"unknown"].join(":"):e}function Ou(t,e,i){const r=A1(),s=T1();return[[t,e].join("-"),[I1,i].join("-"),r,s].join("/")}function P1({protocol:t,version:e,relayUrl:i,sdkVersion:r,auth:s,projectId:n,useOnCloseEvent:o,bundleId:a,packageName:c}){const h=i.split("?"),l=Ou(t,e,r),u={auth:s,ua:l,projectId:n,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},f=$1(h[1]||"",u);return h[0]+"?"+f}function fi(t,e){return t.filter(i=>e.includes(i)).length===t.length}function eo(t){return Object.fromEntries(t.entries())}function to(t){return new Map(Object.entries(t))}function ci(t=M.FIVE_MINUTES,e){const i=M.toMiliseconds(t||M.FIVE_MINUTES);let r,s,n,o;return{resolve:a=>{n&&r&&(clearTimeout(n),r(a),o=Promise.resolve(a))},reject:a=>{n&&s&&(clearTimeout(n),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);n=setTimeout(()=>{const h=new Error(e);o=Promise.reject(h),c(h)},i),r=a,s=c})}}function xt(t,e,i){return new Promise(async(r,s)=>{const n=setTimeout(()=>s(new Error(i)),e);try{const o=await t;r(o)}catch(o){s(o)}clearTimeout(n)})}function Au(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function C1(t){return Au("topic",t)}function U1(t){return Au("id",t)}function Tu(t){const[e,i]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof i=="string")r.topic=i;else if(e==="id"&&Number.isInteger(Number(i)))r.id=Number(i);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${i}`);return r}function we(t,e){return M.fromMiliseconds(Date.now()+M.toMiliseconds(t))}function Yt(t){return Date.now()>=M.toMiliseconds(t)}function re(t,e){return`${t}${e?`:${e}`:""}`}function yi(t=[],e=[]){return[...new Set([...t,...e])]}async function N1({id:t,topic:e,wcDeepLink:i}){var r;try{if(!i)return;const s=typeof i=="string"?JSON.parse(i):i,n=s==null?void 0:s.href;if(typeof n!="string")return;const o=R1(n,t,e),a=zr();if(a===tt.browser){if(!((r=wi())!=null&&r.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}B1(o)}else a===tt.reactNative&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"&&await globalThis.Linking.openURL(o)}catch(s){console.error(s)}}function R1(t,e,i){const r=`requestId=${e}&sessionTopic=${i}`;t.endsWith("/")&&(t=t.slice(0,-1));let s=`${t}`;if(t.startsWith("https://t.me")){const n=t.includes("?")?"&startapp=":"?startapp=";s=`${s}${n}${z1(r,!0)}`}else s=`${s}/wc?${r}`;return s}function B1(t){let e="_self";M1()?e="_top":(L1()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function k1(t,e){let i="";try{if(Hi()&&(i=localStorage.getItem(e),i))return i;i=await t.getItem(e)}catch(r){console.error(r)}return i}function $c(t,e){if(!t.includes(e))return null;const i=t.split(/([&,?,=])/),r=i.indexOf(e);return i[r+2]}function Oc(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ho(){return typeof process<"u"&&g1.IS_VITEST==="true"}function L1(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function M1(){try{return window.self!==window.top}catch{return!1}}function z1(t,e=!1){const i=Buffer.from(t).toString("base64");return e?i.replace(/[=]/g,""):i}function Pu(t){return Buffer.from(t,"base64").toString("utf-8")}function q1(t){return new Promise(e=>setTimeout(e,t))}let j1=class{constructor({limit:e}){Sc(this,"limit"),Sc(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const i=this.set.values().next().value;i&&this.set.delete(i)}this.set.add(e)}}has(e){return this.set.has(e)}};const ss=BigInt(2**32-1),Ac=BigInt(32);function Cu(t,e=!1){return e?{h:Number(t&ss),l:Number(t>>Ac&ss)}:{h:Number(t>>Ac&ss)|0,l:Number(t&ss)|0}}function Uu(t,e=!1){const i=t.length;let r=new Uint32Array(i),s=new Uint32Array(i);for(let n=0;n<i;n++){const{h:o,l:a}=Cu(t[n],e);[r[n],s[n]]=[o,a]}return[r,s]}const Tc=(t,e,i)=>t>>>i,Pc=(t,e,i)=>t<<32-i|e>>>i,Jt=(t,e,i)=>t>>>i|e<<32-i,Zt=(t,e,i)=>t<<32-i|e>>>i,pr=(t,e,i)=>t<<64-i|e>>>i-32,gr=(t,e,i)=>t>>>i-32|e<<64-i,F1=(t,e)=>e,K1=(t,e)=>t,V1=(t,e,i)=>t<<i|e>>>32-i,H1=(t,e,i)=>e<<i|t>>>32-i,W1=(t,e,i)=>e<<i-32|t>>>64-i,G1=(t,e,i)=>t<<i-32|e>>>64-i;function gt(t,e,i,r){const s=(e>>>0)+(r>>>0);return{h:t+i+(s/2**32|0)|0,l:s|0}}const Wo=(t,e,i)=>(t>>>0)+(e>>>0)+(i>>>0),Go=(t,e,i,r)=>e+i+r+(t/2**32|0)|0,Y1=(t,e,i,r)=>(t>>>0)+(e>>>0)+(i>>>0)+(r>>>0),J1=(t,e,i,r,s)=>e+i+r+s+(t/2**32|0)|0,Z1=(t,e,i,r,s)=>(t>>>0)+(e>>>0)+(i>>>0)+(r>>>0)+(s>>>0),X1=(t,e,i,r,s,n)=>e+i+r+s+n+(t/2**32|0)|0,Ci=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Yo(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Rt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ht(t,...e){if(!Yo(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Jo(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Rt(t.outputLen),Rt(t.blockLen)}function ii(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Zo(t,e){ht(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function Tr(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function lt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Sn(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function mt(t,e){return t<<32-e|t>>>e}const Nu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ru(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const Tt=Nu?t=>t:t=>Ru(t);function Q1(t){for(let e=0;e<t.length;e++)t[e]=Ru(t[e]);return t}const Xt=Nu?t=>t:Q1,Bu=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",e2=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Pr(t){if(ht(t),Bu)return t.toHex();let e="";for(let i=0;i<t.length;i++)e+=e2[t[i]];return e}const At={_0:48,_9:57,A:65,F:70,a:97,f:102};function Cc(t){if(t>=At._0&&t<=At._9)return t-At._0;if(t>=At.A&&t<=At.F)return t-(At.A-10);if(t>=At.a&&t<=At.f)return t-(At.a-10)}function Xo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Bu)return Uint8Array.fromHex(t);const e=t.length,i=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(i);for(let s=0,n=0;s<i;s++,n+=2){const o=Cc(t.charCodeAt(n)),a=Cc(t.charCodeAt(n+1));if(o===void 0||a===void 0){const c=t[n]+t[n+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+n)}r[s]=o*16+a}return r}function t2(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function yt(t){return typeof t=="string"&&(t=t2(t)),ht(t),t}function di(...t){let e=0;for(let r=0;r<t.length;r++){const s=t[r];ht(s),e+=s.length}const i=new Uint8Array(e);for(let r=0,s=0;r<t.length;r++){const n=t[r];i.set(n,s),s+=n.length}return i}class Hs{}function qr(t){const e=r=>t().update(yt(r)).digest(),i=t();return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=()=>t(),e}function i2(t){const e=(r,s)=>t(s).update(yt(r)).digest(),i=t({});return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=r=>t(r),e}function Wi(t=32){if(Ci&&typeof Ci.getRandomValues=="function")return Ci.getRandomValues(new Uint8Array(t));if(Ci&&typeof Ci.randomBytes=="function")return Uint8Array.from(Ci.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const r2=BigInt(0),nr=BigInt(1),s2=BigInt(2),n2=BigInt(7),o2=BigInt(256),a2=BigInt(113),ku=[],Lu=[],Mu=[];for(let t=0,e=nr,i=1,r=0;t<24;t++){[i,r]=[r,(2*i+3*r)%5],ku.push(2*(5*r+i)),Lu.push((t+1)*(t+2)/2%64);let s=r2;for(let n=0;n<7;n++)e=(e<<nr^(e>>n2)*a2)%o2,e&s2&&(s^=nr<<(nr<<BigInt(n))-nr);Mu.push(s)}const zu=Uu(Mu,!0),c2=zu[0],h2=zu[1],Uc=(t,e,i)=>i>32?W1(t,e,i):V1(t,e,i),Nc=(t,e,i)=>i>32?G1(t,e,i):H1(t,e,i);function l2(t,e=24){const i=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)i[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,h=i[c],l=i[c+1],u=Uc(h,l,1)^i[a],f=Nc(h,l,1)^i[a+1];for(let p=0;p<50;p+=10)t[o+p]^=u,t[o+p+1]^=f}let s=t[2],n=t[3];for(let o=0;o<24;o++){const a=Lu[o],c=Uc(s,n,a),h=Nc(s,n,a),l=ku[o];s=t[l],n=t[l+1],t[l]=c,t[l+1]=h}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)i[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~i[(a+2)%10]&i[(a+4)%10]}t[0]^=c2[r],t[1]^=h2[r]}lt(i)}let u2=class qu extends Hs{constructor(e,i,r,s=!1,n=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=i,this.outputLen=r,this.enableXOF=s,this.rounds=n,Rt(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Tr(this.state)}clone(){return this._cloneInto()}keccak(){Xt(this.state32),l2(this.state32,this.rounds),Xt(this.state32),this.posOut=0,this.pos=0}update(e){ii(this),e=yt(e),ht(e);const{blockLen:i,state:r}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(i-this.pos,s-n);for(let a=0;a<o;a++)r[this.pos++]^=e[n++];this.pos===i&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:i,pos:r,blockLen:s}=this;e[r]^=i,i&128&&r===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){ii(this,!1),ht(e),this.finish();const i=this.state,{blockLen:r}=this;for(let s=0,n=e.length;s<n;){this.posOut>=r&&this.keccak();const o=Math.min(r-this.posOut,n-s);e.set(i.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Rt(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Zo(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,lt(this.state)}_cloneInto(e){const{blockLen:i,suffix:r,outputLen:s,rounds:n,enableXOF:o}=this;return e||(e=new qu(i,r,s,o,n)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=n,e.suffix=r,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const f2=(t,e,i)=>qr(()=>new u2(e,t,i)),d2=f2(1,136,256/8);function p2(t,e,i,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(i>>s&n),a=Number(i&n),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}function g2(t,e,i){return t&e^~t&i}function y2(t,e,i){return t&e^t&i^e&i}let ju=class extends Hs{constructor(e,i,r,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=i,this.padOffset=r,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Sn(this.buffer)}update(e){ii(this),e=yt(e),ht(e);const{view:i,buffer:r,blockLen:s}=this,n=e.length;for(let o=0;o<n;){const a=Math.min(s-this.pos,n-o);if(a===s){const c=Sn(e);for(;s<=n-o;o+=s)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(i,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ii(this),Zo(e,this),this.finished=!0;const{buffer:i,view:r,blockLen:s,isLE:n}=this;let{pos:o}=this;i[o++]=128,lt(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(r,0),o=0);for(let u=o;u<s;u++)i[u]=0;p2(r,s-8,BigInt(this.length*8),n),this.process(r,0);const a=Sn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,l=this.get();if(h>l.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<h;u++)a.setUint32(4*u,l[u],n)}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:i,buffer:r,length:s,finished:n,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=n,e.length=s,e.pos=a,s%i&&e.buffer.set(r),e}clone(){return this._cloneInto()}};const jt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ne=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Re=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),w2=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ft=new Uint32Array(64);let b2=class extends ju{constructor(e=32){super(64,e,8,!1),this.A=jt[0]|0,this.B=jt[1]|0,this.C=jt[2]|0,this.D=jt[3]|0,this.E=jt[4]|0,this.F=jt[5]|0,this.G=jt[6]|0,this.H=jt[7]|0}get(){const{A:e,B:i,C:r,D:s,E:n,F:o,G:a,H:c}=this;return[e,i,r,s,n,o,a,c]}set(e,i,r,s,n,o,a,c){this.A=e|0,this.B=i|0,this.C=r|0,this.D=s|0,this.E=n|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,i){for(let u=0;u<16;u++,i+=4)Ft[u]=e.getUint32(i,!1);for(let u=16;u<64;u++){const f=Ft[u-15],p=Ft[u-2],d=mt(f,7)^mt(f,18)^f>>>3,g=mt(p,17)^mt(p,19)^p>>>10;Ft[u]=g+Ft[u-7]+d+Ft[u-16]|0}let{A:r,B:s,C:n,D:o,E:a,F:c,G:h,H:l}=this;for(let u=0;u<64;u++){const f=mt(a,6)^mt(a,11)^mt(a,25),p=l+f+g2(a,c,h)+w2[u]+Ft[u]|0,d=(mt(r,2)^mt(r,13)^mt(r,22))+y2(r,s,n)|0;l=h,h=c,c=a,a=o+p|0,o=n,n=s,s=r,r=p+d|0}r=r+this.A|0,s=s+this.B|0,n=n+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,h=h+this.G|0,l=l+this.H|0,this.set(r,s,n,o,a,c,h,l)}roundClean(){lt(Ft)}destroy(){this.set(0,0,0,0,0,0,0,0),lt(this.buffer)}};const Fu=Uu(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),m2=Fu[0],v2=Fu[1],Kt=new Uint32Array(80),Vt=new Uint32Array(80);let Qo=class extends ju{constructor(e=64){super(128,e,16,!1),this.Ah=Re[0]|0,this.Al=Re[1]|0,this.Bh=Re[2]|0,this.Bl=Re[3]|0,this.Ch=Re[4]|0,this.Cl=Re[5]|0,this.Dh=Re[6]|0,this.Dl=Re[7]|0,this.Eh=Re[8]|0,this.El=Re[9]|0,this.Fh=Re[10]|0,this.Fl=Re[11]|0,this.Gh=Re[12]|0,this.Gl=Re[13]|0,this.Hh=Re[14]|0,this.Hl=Re[15]|0}get(){const{Ah:e,Al:i,Bh:r,Bl:s,Ch:n,Cl:o,Dh:a,Dl:c,Eh:h,El:l,Fh:u,Fl:f,Gh:p,Gl:d,Hh:g,Hl:y}=this;return[e,i,r,s,n,o,a,c,h,l,u,f,p,d,g,y]}set(e,i,r,s,n,o,a,c,h,l,u,f,p,d,g,y){this.Ah=e|0,this.Al=i|0,this.Bh=r|0,this.Bl=s|0,this.Ch=n|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=h|0,this.El=l|0,this.Fh=u|0,this.Fl=f|0,this.Gh=p|0,this.Gl=d|0,this.Hh=g|0,this.Hl=y|0}process(e,i){for(let b=0;b<16;b++,i+=4)Kt[b]=e.getUint32(i),Vt[b]=e.getUint32(i+=4);for(let b=16;b<80;b++){const O=Kt[b-15]|0,I=Vt[b-15]|0,U=Jt(O,I,1)^Jt(O,I,8)^Tc(O,I,7),B=Zt(O,I,1)^Zt(O,I,8)^Pc(O,I,7),P=Kt[b-2]|0,w=Vt[b-2]|0,A=Jt(P,w,19)^pr(P,w,61)^Tc(P,w,6),_=Zt(P,w,19)^gr(P,w,61)^Pc(P,w,6),D=Y1(B,_,Vt[b-7],Vt[b-16]),C=J1(D,U,A,Kt[b-7],Kt[b-16]);Kt[b]=C|0,Vt[b]=D|0}let{Ah:r,Al:s,Bh:n,Bl:o,Ch:a,Cl:c,Dh:h,Dl:l,Eh:u,El:f,Fh:p,Fl:d,Gh:g,Gl:y,Hh:v,Hl:E}=this;for(let b=0;b<80;b++){const O=Jt(u,f,14)^Jt(u,f,18)^pr(u,f,41),I=Zt(u,f,14)^Zt(u,f,18)^gr(u,f,41),U=u&p^~u&g,B=f&d^~f&y,P=Z1(E,I,B,v2[b],Vt[b]),w=X1(P,v,O,U,m2[b],Kt[b]),A=P|0,_=Jt(r,s,28)^pr(r,s,34)^pr(r,s,39),D=Zt(r,s,28)^gr(r,s,34)^gr(r,s,39),C=r&n^r&a^n&a,L=s&o^s&c^o&c;v=g|0,E=y|0,g=p|0,y=d|0,p=u|0,d=f|0,{h:u,l:f}=gt(h|0,l|0,w|0,A|0),h=a|0,l=c|0,a=n|0,c=o|0,n=r|0,o=s|0;const x=Wo(A,D,L);r=Go(x,w,_,C),s=x|0}({h:r,l:s}=gt(this.Ah|0,this.Al|0,r|0,s|0)),{h:n,l:o}=gt(this.Bh|0,this.Bl|0,n|0,o|0),{h:a,l:c}=gt(this.Ch|0,this.Cl|0,a|0,c|0),{h,l}=gt(this.Dh|0,this.Dl|0,h|0,l|0),{h:u,l:f}=gt(this.Eh|0,this.El|0,u|0,f|0),{h:p,l:d}=gt(this.Fh|0,this.Fl|0,p|0,d|0),{h:g,l:y}=gt(this.Gh|0,this.Gl|0,g|0,y|0),{h:v,l:E}=gt(this.Hh|0,this.Hl|0,v|0,E|0),this.set(r,s,n,o,a,c,h,l,u,f,p,d,g,y,v,E)}roundClean(){lt(Kt,Vt)}destroy(){lt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},E2=class extends Qo{constructor(){super(48),this.Ah=Ne[0]|0,this.Al=Ne[1]|0,this.Bh=Ne[2]|0,this.Bl=Ne[3]|0,this.Ch=Ne[4]|0,this.Cl=Ne[5]|0,this.Dh=Ne[6]|0,this.Dl=Ne[7]|0,this.Eh=Ne[8]|0,this.El=Ne[9]|0,this.Fh=Ne[10]|0,this.Fl=Ne[11]|0,this.Gh=Ne[12]|0,this.Gl=Ne[13]|0,this.Hh=Ne[14]|0,this.Hl=Ne[15]|0}};const Be=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class _2 extends Qo{constructor(){super(32),this.Ah=Be[0]|0,this.Al=Be[1]|0,this.Bh=Be[2]|0,this.Bl=Be[3]|0,this.Ch=Be[4]|0,this.Cl=Be[5]|0,this.Dh=Be[6]|0,this.Dl=Be[7]|0,this.Eh=Be[8]|0,this.El=Be[9]|0,this.Fh=Be[10]|0,this.Fl=Be[11]|0,this.Gh=Be[12]|0,this.Gl=Be[13]|0,this.Hh=Be[14]|0,this.Hl=Be[15]|0}}const Ws=qr(()=>new b2),x2=qr(()=>new Qo),I2=qr(()=>new E2),S2=qr(()=>new _2),D2=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),ye=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),q=new Uint32Array(32);function Ht(t,e,i,r,s,n){const o=s[n],a=s[n+1];let c=q[2*t],h=q[2*t+1],l=q[2*e],u=q[2*e+1],f=q[2*i],p=q[2*i+1],d=q[2*r],g=q[2*r+1],y=Wo(c,l,o);h=Go(y,h,u,a),c=y|0,{Dh:g,Dl:d}={Dh:g^h,Dl:d^c},{Dh:g,Dl:d}={Dh:F1(g,d),Dl:K1(g)},{h:p,l:f}=gt(p,f,g,d),{Bh:u,Bl:l}={Bh:u^p,Bl:l^f},{Bh:u,Bl:l}={Bh:Jt(u,l,24),Bl:Zt(u,l,24)},q[2*t]=c,q[2*t+1]=h,q[2*e]=l,q[2*e+1]=u,q[2*i]=f,q[2*i+1]=p,q[2*r]=d,q[2*r+1]=g}function Wt(t,e,i,r,s,n){const o=s[n],a=s[n+1];let c=q[2*t],h=q[2*t+1],l=q[2*e],u=q[2*e+1],f=q[2*i],p=q[2*i+1],d=q[2*r],g=q[2*r+1],y=Wo(c,l,o);h=Go(y,h,u,a),c=y|0,{Dh:g,Dl:d}={Dh:g^h,Dl:d^c},{Dh:g,Dl:d}={Dh:Jt(g,d,16),Dl:Zt(g,d,16)},{h:p,l:f}=gt(p,f,g,d),{Bh:u,Bl:l}={Bh:u^p,Bl:l^f},{Bh:u,Bl:l}={Bh:pr(u,l,63),Bl:gr(u,l,63)},q[2*t]=c,q[2*t+1]=h,q[2*e]=l,q[2*e+1]=u,q[2*i]=f,q[2*i+1]=p,q[2*r]=d,q[2*r+1]=g}function $2(t,e={},i,r,s){if(Rt(i),t<0||t>i)throw new Error("outputLen bigger than keyLen");const{key:n,salt:o,personalization:a}=e;if(n!==void 0&&(n.length<1||n.length>i))throw new Error("key length must be undefined or 1.."+i);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class O2 extends Hs{constructor(e,i){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Rt(e),Rt(i),this.blockLen=e,this.outputLen=i,this.buffer=new Uint8Array(e),this.buffer32=Tr(this.buffer)}update(e){ii(this),e=yt(e),ht(e);const{blockLen:i,buffer:r,buffer32:s}=this,n=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<n;){this.pos===i&&(Xt(s),this.compress(s,0,!1),Xt(s),this.pos=0);const h=Math.min(i-this.pos,n-c),l=o+c;if(h===i&&!(l%4)&&c+h<n){const u=new Uint32Array(a,l,Math.floor((n-c)/4));Xt(u);for(let f=0;c+i<n;f+=s.length,c+=i)this.length+=i,this.compress(u,f,!1);Xt(u);continue}r.set(e.subarray(c,c+h),this.pos),this.pos+=h,this.length+=h,c+=h}return this}digestInto(e){ii(this),Zo(e,this);const{pos:i,buffer32:r}=this;this.finished=!0,lt(this.buffer.subarray(i)),Xt(r),this.compress(r,0,!0),Xt(r);const s=Tr(e);this.get().forEach((n,o)=>s[o]=Tt(n))}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}_cloneInto(e){const{buffer:i,length:r,finished:s,destroyed:n,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(i),e.destroyed=n,e.finished=s,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class A2 extends O2{constructor(e={}){const i=e.dkLen===void 0?64:e.dkLen;super(128,i),this.v0l=ye[0]|0,this.v0h=ye[1]|0,this.v1l=ye[2]|0,this.v1h=ye[3]|0,this.v2l=ye[4]|0,this.v2h=ye[5]|0,this.v3l=ye[6]|0,this.v3h=ye[7]|0,this.v4l=ye[8]|0,this.v4h=ye[9]|0,this.v5l=ye[10]|0,this.v5h=ye[11]|0,this.v6l=ye[12]|0,this.v6h=ye[13]|0,this.v7l=ye[14]|0,this.v7h=ye[15]|0,$2(i,e,64,16,16);let{key:r,personalization:s,salt:n}=e,o=0;if(r!==void 0&&(r=yt(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,n!==void 0){n=yt(n);const a=Tr(n);this.v4l^=Tt(a[0]),this.v4h^=Tt(a[1]),this.v5l^=Tt(a[2]),this.v5h^=Tt(a[3])}if(s!==void 0){s=yt(s);const a=Tr(s);this.v6l^=Tt(a[0]),this.v6h^=Tt(a[1]),this.v7l^=Tt(a[2]),this.v7h^=Tt(a[3])}if(r!==void 0){const a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:i,v1l:r,v1h:s,v2l:n,v2h:o,v3l:a,v3h:c,v4l:h,v4h:l,v5l:u,v5h:f,v6l:p,v6h:d,v7l:g,v7h:y}=this;return[e,i,r,s,n,o,a,c,h,l,u,f,p,d,g,y]}set(e,i,r,s,n,o,a,c,h,l,u,f,p,d,g,y){this.v0l=e|0,this.v0h=i|0,this.v1l=r|0,this.v1h=s|0,this.v2l=n|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=h|0,this.v4h=l|0,this.v5l=u|0,this.v5h=f|0,this.v6l=p|0,this.v6h=d|0,this.v7l=g|0,this.v7h=y|0}compress(e,i,r){this.get().forEach((c,h)=>q[h]=c),q.set(ye,16);let{h:s,l:n}=Cu(BigInt(this.length));q[24]=ye[8]^n,q[25]=ye[9]^s,r&&(q[28]=~q[28],q[29]=~q[29]);let o=0;const a=D2;for(let c=0;c<12;c++)Ht(0,4,8,12,e,i+2*a[o++]),Wt(0,4,8,12,e,i+2*a[o++]),Ht(1,5,9,13,e,i+2*a[o++]),Wt(1,5,9,13,e,i+2*a[o++]),Ht(2,6,10,14,e,i+2*a[o++]),Wt(2,6,10,14,e,i+2*a[o++]),Ht(3,7,11,15,e,i+2*a[o++]),Wt(3,7,11,15,e,i+2*a[o++]),Ht(0,5,10,15,e,i+2*a[o++]),Wt(0,5,10,15,e,i+2*a[o++]),Ht(1,6,11,12,e,i+2*a[o++]),Wt(1,6,11,12,e,i+2*a[o++]),Ht(2,7,8,13,e,i+2*a[o++]),Wt(2,7,8,13,e,i+2*a[o++]),Ht(3,4,9,14,e,i+2*a[o++]),Wt(3,4,9,14,e,i+2*a[o++]);this.v0l^=q[0]^q[16],this.v0h^=q[1]^q[17],this.v1l^=q[2]^q[18],this.v1h^=q[3]^q[19],this.v2l^=q[4]^q[20],this.v2h^=q[5]^q[21],this.v3l^=q[6]^q[22],this.v3h^=q[7]^q[23],this.v4l^=q[8]^q[24],this.v4h^=q[9]^q[25],this.v5l^=q[10]^q[26],this.v5h^=q[11]^q[27],this.v6l^=q[12]^q[28],this.v6h^=q[13]^q[29],this.v7l^=q[14]^q[30],this.v7h^=q[15]^q[31],lt(q)}destroy(){this.destroyed=!0,lt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const T2=i2(t=>new A2(t)),P2="https://rpc.walletconnect.org/v1";function Ku(t){const e=`Ethereum Signed Message:
${t.length}`,i=new TextEncoder().encode(e+t);return"0x"+Buffer.from(d2(i)).toString("hex")}async function C2(t,e,i,r,s,n){switch(i.t){case"eip191":return await U2(t,e,i.s);case"eip1271":return await N2(t,e,i.s,r,s,n);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${i.t}`)}}async function U2(t,e,i){return(await db({hash:Ku(e),signature:i})).toLowerCase()===t.toLowerCase()}async function N2(t,e,i,r,s,n){const o=gs(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",h=i.substring(2),l=(h.length/2).toString(16).padStart(64,"0"),u=(e.startsWith("0x")?e:Ku(e)).substring(2),f=a+u+c+l+h,p=await fetch(`${n||P2}/?chainId=${r}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:R2(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:f},"latest"]})}),{result:d}=await p.json();return d?d.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function R2(){return Date.now()+Math.floor(Math.random()*1e3)}function B2(t){const e=atob(t),i=new Uint8Array(e.length);for(let o=0;o<e.length;o++)i[o]=e.charCodeAt(o);const r=i[0];if(r===0)throw new Error("No signatures found");const s=1+r*64;if(i.length<s)throw new Error("Transaction data too short for claimed signature count");if(i.length<100)throw new Error("Transaction too short");const n=Buffer.from(t,"base64").slice(1,65);return Lr.encode(n)}function k2(t){const e=new Uint8Array(Buffer.from(t,"base64")),i=Array.from("TransactionData::").map(n=>n.charCodeAt(0)),r=new Uint8Array(i.length+e.length);r.set(i),r.set(e,i.length);const s=T2(r,{dkLen:32});return Lr.encode(s)}function Rc(t){const e=new Uint8Array(Ws(L2(t)));return Lr.encode(e)}function L2(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Bc(t){const e=Buffer.from(t,"base64"),i=Zb(e).txn;if(!i)throw new Error("Invalid signed transaction: missing 'txn' field");const r=jb(i),s=Buffer.from("TX"),n=Buffer.concat([s,Buffer.from(r)]),o=S2(n);return nm.encode(o).replace(/=+$/,"")}function Dn(t){const e=[];let i=BigInt(t);for(;i>=BigInt(128);)e.push(Number(i&BigInt(127)|BigInt(128))),i>>=BigInt(7);return e.push(Number(i)),Buffer.from(e)}function M2(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),i=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(Dn(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(Dn(i.length)),s.push(i),s.push(Buffer.from([26])),s.push(Dn(r.length)),s.push(r);const n=Buffer.concat(s),o=Ws(n);return Buffer.from(o).toString("hex").toUpperCase()}var z2=Object.defineProperty,q2=Object.defineProperties,j2=Object.getOwnPropertyDescriptors,kc=Object.getOwnPropertySymbols,F2=Object.prototype.hasOwnProperty,K2=Object.prototype.propertyIsEnumerable,Lc=(t,e,i)=>e in t?z2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,V2=(t,e)=>{for(var i in e||(e={}))F2.call(e,i)&&Lc(t,i,e[i]);if(kc)for(var i of kc(e))K2.call(e,i)&&Lc(t,i,e[i]);return t},H2=(t,e)=>q2(t,j2(e));const W2="did:pkh:",ea=t=>t==null?void 0:t.split(":"),G2=t=>{const e=t&&ea(t);if(e)return t.includes(W2)?e[3]:e[1]},io=t=>{const e=t&&ea(t);if(e)return e[2]+":"+e[3]},Cs=t=>{const e=t&&ea(t);if(e)return e.pop()};async function Mc(t){const{cacao:e,projectId:i}=t,{s:r,p:s}=e,n=Vu(s,s.iss),o=Cs(s.iss);return await C2(o,n,r,io(s.iss),i)}const Vu=(t,e)=>{const i=`${t.domain} wants you to sign in with your Ethereum account:`,r=Cs(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=t.statement||void 0;const n=`URI: ${t.aud||t.uri}`,o=`Version: ${t.version}`,a=`Chain ID: ${G2(e)}`,c=`Nonce: ${t.nonce}`,h=`Issued At: ${t.iat}`,l=t.exp?`Expiration Time: ${t.exp}`:void 0,u=t.nbf?`Not Before: ${t.nbf}`:void 0,f=t.requestId?`Request ID: ${t.requestId}`:void 0,p=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,d=ys(t.resources);if(d){const g=Cr(d);s=rv(s,g)}return[i,r,"",s,"",n,o,a,c,h,l,u,f,p].filter(g=>g!=null).join(`
`)};function Y2(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function J2(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function mi(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(i=>{const r=t.att[i];if(Array.isArray(r))throw new Error(`Resource must be an object: ${i}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${i}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${i}`);Object.keys(r).forEach(s=>{const n=r[s];if(!Array.isArray(n))throw new Error(`Ability limits ${s} must be an array of objects, found: ${n}`);if(!n.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);n.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function Z2(t,e,i,r={}){return i==null||i.sort((s,n)=>s.localeCompare(n)),{att:{[t]:X2(e,i,r)}}}function X2(t,e,i={}){e=e==null?void 0:e.sort((s,n)=>s.localeCompare(n));const r=e.map(s=>({[`${t}/${s}`]:[i]}));return Object.assign({},...r)}function Hu(t){return mi(t),`urn:recap:${Y2(t).replace(/=/g,"")}`}function Cr(t){const e=J2(t.replace("urn:recap:",""));return mi(e),e}function Q2(t,e,i){const r=Z2(t,e,i);return Hu(r)}function ev(t){return t&&t.includes("urn:recap:")}function tv(t,e){const i=Cr(t),r=Cr(e),s=iv(i,r);return Hu(s)}function iv(t,e){mi(t),mi(e);const i=Object.keys(t.att).concat(Object.keys(e.att)).sort((s,n)=>s.localeCompare(n)),r={att:{}};return i.forEach(s=>{var n,o;Object.keys(((n=t.att)==null?void 0:n[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,h;r.att[s]=H2(V2({},r.att[s]),{[a]:((c=t.att[s])==null?void 0:c[a])||((h=e.att[s])==null?void 0:h[a])})})}),r}function rv(t="",e){mi(e);const i="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(i))return t;const r=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(u=>({ability:u.split("/")[0],action:u.split("/")[1]}));c.sort((u,f)=>u.action.localeCompare(f.action));const h={};c.forEach(u=>{h[u.ability]||(h[u.ability]=[]),h[u.ability].push(u.action)});const l=Object.keys(h).map(u=>(s++,`(${s}) '${u}': '${h[u].join("', '")}' for '${a}'.`));r.push(l.join(", ").replace(".,","."))});const n=r.join(" "),o=`${i}${n}`;return`${t?t+" ":""}${o}`}function zc(t){var e;const i=Cr(t);mi(i);const r=(e=i.att)==null?void 0:e.eip155;return r?Object.keys(r).map(s=>s.split("/")[1]):[]}function qc(t){const e=Cr(t);mi(e);const i=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(s=>{var n;(n=s==null?void 0:s[0])!=null&&n.chains&&i.push(s[0].chains)})}),[...new Set(i.flat())]}function ys(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return ev(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Wu(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ro(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function $n(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function We(t,...e){if(!Wu(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function jc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function sv(t,e){We(t);const i=e.outputLen;if(t.length<i)throw new Error("digestInto() expects output buffer of length at least "+i)}function ti(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Mi(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function nv(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const ov=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function av(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function so(t){if(typeof t=="string")t=av(t);else if(Wu(t))t=no(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function cv(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function hv(t,e){if(t.length!==e.length)return!1;let i=0;for(let r=0;r<t.length;r++)i|=t[r]^e[r];return i===0}const lv=(t,e)=>{function i(r,...s){if(We(r),!ov)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const h=s[0];if(!h)throw new Error("nonce / iv required");t.varSizeNonce?We(h):We(h,t.nonceLength)}const n=t.tagLength;n&&s[1]!==void 0&&We(s[1]);const o=e(r,...s),a=(h,l)=>{if(l!==void 0){if(h!==2)throw new Error("cipher output not supported");We(l)}};let c=!1;return{encrypt(h,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,We(h),a(o.encrypt.length,l),o.encrypt(h,l)},decrypt(h,l){if(We(h),n&&h.length<n)throw new Error("invalid ciphertext length: smaller than tagLength="+n);return a(o.decrypt.length,l),o.decrypt(h,l)}}}return Object.assign(i,t),i};function Fc(t,e,i=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(i&&!fv(e))throw new Error("invalid output, must be aligned");return e}function Kc(t,e,i,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,i,r);const s=BigInt(32),n=BigInt(4294967295),o=Number(i>>s&n),a=Number(i&n);t.setUint32(e+4,o,r),t.setUint32(e+0,a,r)}function uv(t,e,i){ro(i);const r=new Uint8Array(16),s=nv(r);return Kc(s,0,BigInt(e),i),Kc(s,8,BigInt(t),i),r}function fv(t){return t.byteOffset%4===0}function no(t){return Uint8Array.from(t)}const Gu=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),dv=Gu("expand 16-byte k"),pv=Gu("expand 32-byte k"),gv=ti(dv),yv=ti(pv);function X(t,e){return t<<e|t>>>32-e}function oo(t){return t.byteOffset%4===0}const ns=64,wv=16,Yu=2**32-1,Vc=new Uint32Array;function bv(t,e,i,r,s,n,o,a){const c=s.length,h=new Uint8Array(ns),l=ti(h),u=oo(s)&&oo(n),f=u?ti(s):Vc,p=u?ti(n):Vc;for(let d=0;d<c;o++){if(t(e,i,r,l,o,a),o>=Yu)throw new Error("arx: counter overflow");const g=Math.min(ns,c-d);if(u&&g===ns){const y=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let v=0,E;v<wv;v++)E=y+v,p[E]=f[E]^l[v];d+=ns;continue}for(let y=0,v;y<g;y++)v=d+y,n[v]=s[v]^h[y];d+=g}}function mv(t,e){const{allowShortKeys:i,extendNonceFn:r,counterLength:s,counterRight:n,rounds:o}=cv({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return $n(s),$n(o),ro(n),ro(i),(a,c,h,l,u=0)=>{We(a),We(c),We(h);const f=h.length;if(l===void 0&&(l=new Uint8Array(f)),We(l),$n(u),u<0||u>=Yu)throw new Error("arx: counter overflow");if(l.length<f)throw new Error(`arx: output (${l.length}) is shorter than data (${f})`);const p=[];let d=a.length,g,y;if(d===32)p.push(g=no(a)),y=yv;else if(d===16&&i)g=new Uint8Array(32),g.set(a),g.set(a,16),y=gv,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);oo(c)||p.push(c=no(c));const v=ti(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(y,v,ti(c.subarray(0,16)),v),c=c.subarray(16)}const E=16-s;if(E!==c.length)throw new Error(`arx: nonce must be ${E} or 16 bytes`);if(E!==12){const O=new Uint8Array(12);O.set(c,n?0:12-c.length),c=O,p.push(c)}const b=ti(c);return bv(t,y,v,b,h,l,u,o),Mi(...p),l}}const De=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class vv{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=so(e),We(e,32);const i=De(e,0),r=De(e,2),s=De(e,4),n=De(e,6),o=De(e,8),a=De(e,10),c=De(e,12),h=De(e,14);this.r[0]=i&8191,this.r[1]=(i>>>13|r<<3)&8191,this.r[2]=(r>>>10|s<<6)&7939,this.r[3]=(s>>>7|n<<9)&8191,this.r[4]=(n>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|h<<8)&8191,this.r[9]=h>>>5&127;for(let l=0;l<8;l++)this.pad[l]=De(e,16+2*l)}process(e,i,r=!1){const s=r?0:2048,{h:n,r:o}=this,a=o[0],c=o[1],h=o[2],l=o[3],u=o[4],f=o[5],p=o[6],d=o[7],g=o[8],y=o[9],v=De(e,i+0),E=De(e,i+2),b=De(e,i+4),O=De(e,i+6),I=De(e,i+8),U=De(e,i+10),B=De(e,i+12),P=De(e,i+14);let w=n[0]+(v&8191),A=n[1]+((v>>>13|E<<3)&8191),_=n[2]+((E>>>10|b<<6)&8191),D=n[3]+((b>>>7|O<<9)&8191),C=n[4]+((O>>>4|I<<12)&8191),L=n[5]+(I>>>1&8191),x=n[6]+((I>>>14|U<<2)&8191),m=n[7]+((U>>>11|B<<5)&8191),S=n[8]+((B>>>8|P<<8)&8191),T=n[9]+(P>>>5|s),$=0,R=$+w*a+A*(5*y)+_*(5*g)+D*(5*d)+C*(5*p);$=R>>>13,R&=8191,R+=L*(5*f)+x*(5*u)+m*(5*l)+S*(5*h)+T*(5*c),$+=R>>>13,R&=8191;let k=$+w*c+A*a+_*(5*y)+D*(5*g)+C*(5*d);$=k>>>13,k&=8191,k+=L*(5*p)+x*(5*f)+m*(5*u)+S*(5*l)+T*(5*h),$+=k>>>13,k&=8191;let j=$+w*h+A*c+_*a+D*(5*y)+C*(5*g);$=j>>>13,j&=8191,j+=L*(5*d)+x*(5*p)+m*(5*f)+S*(5*u)+T*(5*l),$+=j>>>13,j&=8191;let F=$+w*l+A*h+_*c+D*a+C*(5*y);$=F>>>13,F&=8191,F+=L*(5*g)+x*(5*d)+m*(5*p)+S*(5*f)+T*(5*u),$+=F>>>13,F&=8191;let K=$+w*u+A*l+_*h+D*c+C*a;$=K>>>13,K&=8191,K+=L*(5*y)+x*(5*g)+m*(5*d)+S*(5*p)+T*(5*f),$+=K>>>13,K&=8191;let V=$+w*f+A*u+_*l+D*h+C*c;$=V>>>13,V&=8191,V+=L*a+x*(5*y)+m*(5*g)+S*(5*d)+T*(5*p),$+=V>>>13,V&=8191;let H=$+w*p+A*f+_*u+D*l+C*h;$=H>>>13,H&=8191,H+=L*c+x*a+m*(5*y)+S*(5*g)+T*(5*d),$+=H>>>13,H&=8191;let ie=$+w*d+A*p+_*f+D*u+C*l;$=ie>>>13,ie&=8191,ie+=L*h+x*c+m*a+S*(5*y)+T*(5*g),$+=ie>>>13,ie&=8191;let te=$+w*g+A*d+_*p+D*f+C*u;$=te>>>13,te&=8191,te+=L*l+x*h+m*c+S*a+T*(5*y),$+=te>>>13,te&=8191;let Y=$+w*y+A*g+_*d+D*p+C*f;$=Y>>>13,Y&=8191,Y+=L*u+x*l+m*h+S*c+T*a,$+=Y>>>13,Y&=8191,$=($<<2)+$|0,$=$+R|0,R=$&8191,$=$>>>13,k+=$,n[0]=R,n[1]=k,n[2]=j,n[3]=F,n[4]=K,n[5]=V,n[6]=H,n[7]=ie,n[8]=te,n[9]=Y}finalize(){const{h:e,pad:i}=this,r=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,r[0]=e[0]+5,s=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+s,s=r[a]>>>13,r[a]&=8191;r[9]-=8192;let n=(s^1)-1;for(let a=0;a<10;a++)r[a]&=n;n=~n;for(let a=0;a<10;a++)e[a]=e[a]&n|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+i[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+i[a]|0)+(o>>>16)|0,e[a]=o&65535;Mi(r)}update(e){jc(this),e=so(e),We(e);const{buffer:i,blockLen:r}=this,s=e.length;for(let n=0;n<s;){const o=Math.min(r-this.pos,s-n);if(o===r){for(;r<=s-n;n+=r)this.process(e,n);continue}i.set(e.subarray(n,n+o),this.pos),this.pos+=o,n+=o,this.pos===r&&(this.process(i,0,!1),this.pos=0)}return this}destroy(){Mi(this.h,this.r,this.buffer,this.pad)}digestInto(e){jc(this),sv(e,this),this.finished=!0;const{buffer:i,h:r}=this;let{pos:s}=this;if(s){for(i[s++]=1;s<16;s++)i[s]=0;this.process(i,0,!0)}this.finalize();let n=0;for(let o=0;o<8;o++)e[n++]=r[o]>>>0,e[n++]=r[o]>>>8;return e}digest(){const{buffer:e,outputLen:i}=this;this.digestInto(e);const r=e.slice(0,i);return this.destroy(),r}}function Ev(t){const e=(r,s)=>t(s).update(so(r)).digest(),i=t(new Uint8Array(32));return e.outputLen=i.outputLen,e.blockLen=i.blockLen,e.create=r=>t(r),e}const _v=Ev(t=>new vv(t));function xv(t,e,i,r,s,n=20){let o=t[0],a=t[1],c=t[2],h=t[3],l=e[0],u=e[1],f=e[2],p=e[3],d=e[4],g=e[5],y=e[6],v=e[7],E=s,b=i[0],O=i[1],I=i[2],U=o,B=a,P=c,w=h,A=l,_=u,D=f,C=p,L=d,x=g,m=y,S=v,T=E,$=b,R=O,k=I;for(let F=0;F<n;F+=2)U=U+A|0,T=X(T^U,16),L=L+T|0,A=X(A^L,12),U=U+A|0,T=X(T^U,8),L=L+T|0,A=X(A^L,7),B=B+_|0,$=X($^B,16),x=x+$|0,_=X(_^x,12),B=B+_|0,$=X($^B,8),x=x+$|0,_=X(_^x,7),P=P+D|0,R=X(R^P,16),m=m+R|0,D=X(D^m,12),P=P+D|0,R=X(R^P,8),m=m+R|0,D=X(D^m,7),w=w+C|0,k=X(k^w,16),S=S+k|0,C=X(C^S,12),w=w+C|0,k=X(k^w,8),S=S+k|0,C=X(C^S,7),U=U+_|0,k=X(k^U,16),m=m+k|0,_=X(_^m,12),U=U+_|0,k=X(k^U,8),m=m+k|0,_=X(_^m,7),B=B+D|0,T=X(T^B,16),S=S+T|0,D=X(D^S,12),B=B+D|0,T=X(T^B,8),S=S+T|0,D=X(D^S,7),P=P+C|0,$=X($^P,16),L=L+$|0,C=X(C^L,12),P=P+C|0,$=X($^P,8),L=L+$|0,C=X(C^L,7),w=w+A|0,R=X(R^w,16),x=x+R|0,A=X(A^x,12),w=w+A|0,R=X(R^w,8),x=x+R|0,A=X(A^x,7);let j=0;r[j++]=o+U|0,r[j++]=a+B|0,r[j++]=c+P|0,r[j++]=h+w|0,r[j++]=l+A|0,r[j++]=u+_|0,r[j++]=f+D|0,r[j++]=p+C|0,r[j++]=d+L|0,r[j++]=g+x|0,r[j++]=y+m|0,r[j++]=v+S|0,r[j++]=E+T|0,r[j++]=b+$|0,r[j++]=O+R|0,r[j++]=I+k|0}const Iv=mv(xv,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Sv=new Uint8Array(16),Hc=(t,e)=>{t.update(e);const i=e.length%16;i&&t.update(Sv.subarray(i))},Dv=new Uint8Array(32);function Wc(t,e,i,r,s){const n=t(e,i,Dv),o=_v.create(n);s&&Hc(o,s),Hc(o,r);const a=uv(r.length,s?s.length:0,!0);o.update(a);const c=o.digest();return Mi(n,a),c}const $v=t=>(e,i,r)=>({encrypt(s,n){const o=s.length;n=Fc(o+16,n,!1),n.set(s);const a=n.subarray(0,-16);t(e,i,a,a,1);const c=Wc(t,e,i,a,r);return n.set(c,o),Mi(c),n},decrypt(s,n){n=Fc(s.length-16,n,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Wc(t,e,i,o,r);if(!hv(a,c))throw new Error("invalid tag");return n.set(s.subarray(0,-16)),t(e,i,n,n,1),Mi(c),n}}),Ju=lv({blockSize:64,nonceLength:12,tagLength:16},$v(Iv));let Zu=class extends Hs{constructor(e,i){super(),this.finished=!1,this.destroyed=!1,Jo(e);const r=yt(i);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,n=new Uint8Array(s);n.set(r.length>s?e.create().update(r).digest():r);for(let o=0;o<n.length;o++)n[o]^=54;this.iHash.update(n),this.oHash=e.create();for(let o=0;o<n.length;o++)n[o]^=106;this.oHash.update(n),lt(n)}update(e){return ii(this),this.iHash.update(e),this}digestInto(e){ii(this),ht(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:i,iHash:r,finished:s,destroyed:n,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=n,e.blockLen=o,e.outputLen=a,e.oHash=i._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Gs=(t,e,i)=>new Zu(t,e).update(i).digest();Gs.create=(t,e)=>new Zu(t,e);function Ov(t,e,i){return Jo(t),i===void 0&&(i=new Uint8Array(t.outputLen)),Gs(t,yt(i),yt(e))}const On=Uint8Array.from([0]),Gc=Uint8Array.of();function Av(t,e,i,r=32){Jo(t),Rt(r);const s=t.outputLen;if(r>255*s)throw new Error("Length should be <= 255*HashLen");const n=Math.ceil(r/s);i===void 0&&(i=Gc);const o=new Uint8Array(n*s),a=Gs.create(t,e),c=a._cloneInto(),h=new Uint8Array(a.outputLen);for(let l=0;l<n;l++)On[0]=l+1,c.update(l===0?Gc:h).update(i).update(On).digestInto(h),o.set(h,s*l),a._cloneInto(c);return a.destroy(),c.destroy(),lt(h,On),o.slice(0,r)}const Tv=(t,e,i,r,s)=>Av(t,Ov(t,e,i),r,s),Ys=Ws,ta=BigInt(0),ao=BigInt(1);function Us(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function os(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Xu(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ta:BigInt("0x"+t)}function Js(t){return Xu(Pr(t))}function Ns(t){return ht(t),Xu(Pr(Uint8Array.from(t).reverse()))}function ia(t,e){return Xo(t.toString(16).padStart(e*2,"0"))}function ra(t,e){return ia(t,e).reverse()}function He(t,e,i){let r;if(typeof e=="string")try{r=Xo(e)}catch(n){throw new Error(t+" must be hex string or Uint8Array, cause: "+n)}else if(Yo(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const s=r.length;if(typeof i=="number"&&s!==i)throw new Error(t+" of length "+i+" expected, got "+s);return r}const An=t=>typeof t=="bigint"&&ta<=t;function Pv(t,e,i){return An(t)&&An(e)&&An(i)&&e<=t&&t<i}function co(t,e,i,r){if(!Pv(e,i,r))throw new Error("expected valid "+t+": "+i+" <= n < "+r+", got "+e)}function Cv(t){let e;for(e=0;t>ta;t>>=ao,e+=1);return e}const Zs=t=>(ao<<BigInt(t))-ao;function Uv(t,e,i){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof i!="function")throw new Error("hmacFn must be a function");const r=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let n=r(t),o=r(t),a=0;const c=()=>{n.fill(1),o.fill(0),a=0},h=(...f)=>i(o,n,...f),l=(f=r(0))=>{o=h(s(0),f),n=h(),f.length!==0&&(o=h(s(1),f),n=h())},u=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const p=[];for(;f<e;){n=h();const d=n.slice();p.push(d),f+=n.length}return di(...p)};return(f,p)=>{c(),l(f);let d;for(;!(d=p(u()));)l();return c(),d}}function Xs(t,e,i={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(s,n,o){const a=t[s];if(o&&a===void 0)return;const c=typeof a;if(c!==n||a===null)throw new Error(`param "${s}" is invalid: expected ${n}, got ${c}`)}Object.entries(e).forEach(([s,n])=>r(s,n,!1)),Object.entries(i).forEach(([s,n])=>r(s,n,!0))}function Yc(t){const e=new WeakMap;return(i,...r)=>{const s=e.get(i);if(s!==void 0)return s;const n=t(i,...r);return e.set(i,n),n}}const Ye=BigInt(0),Me=BigInt(1),pi=BigInt(2),Nv=BigInt(3),Qu=BigInt(4),ef=BigInt(5),tf=BigInt(8);function at(t,e){const i=t%e;return i>=Ye?i:e+i}function dt(t,e,i){let r=t;for(;e-- >Ye;)r*=r,r%=i;return r}function Jc(t,e){if(t===Ye)throw new Error("invert: expected non-zero number");if(e<=Ye)throw new Error("invert: expected positive modulus, got "+e);let i=at(t,e),r=e,s=Ye,n=Me;for(;i!==Ye;){const o=r/i,a=r%i,c=s-n*o;r=i,i=a,s=n,n=c}if(r!==Me)throw new Error("invert: does not exist");return at(s,e)}function rf(t,e){const i=(t.ORDER+Me)/Qu,r=t.pow(e,i);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function Rv(t,e){const i=(t.ORDER-ef)/tf,r=t.mul(e,pi),s=t.pow(r,i),n=t.mul(e,s),o=t.mul(t.mul(n,pi),s),a=t.mul(n,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Bv(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-Me,i=0;for(;e%pi===Ye;)e/=pi,i++;let r=pi;const s=Gi(t);for(;Zc(s,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(i===1)return rf;let n=s.pow(r,e);const o=(e+Me)/pi;return function(a,c){if(a.is0(c))return c;if(Zc(a,c)!==1)throw new Error("Cannot find square root");let h=i,l=a.mul(a.ONE,n),u=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(u,a.ONE);){if(a.is0(u))return a.ZERO;let p=1,d=a.sqr(u);for(;!a.eql(d,a.ONE);)if(p++,d=a.sqr(d),p===h)throw new Error("Cannot find square root");const g=Me<<BigInt(h-p-1),y=a.pow(l,g);h=p,l=a.sqr(y),u=a.mul(u,l),f=a.mul(f,y)}return f}}function kv(t){return t%Qu===Nv?rf:t%tf===ef?Rv:Bv(t)}const Lv=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Mv(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},i=Lv.reduce((r,s)=>(r[s]="function",r),e);return Xs(t,i),t}function zv(t,e,i){if(i<Ye)throw new Error("invalid exponent, negatives unsupported");if(i===Ye)return t.ONE;if(i===Me)return e;let r=t.ONE,s=e;for(;i>Ye;)i&Me&&(r=t.mul(r,s)),s=t.sqr(s),i>>=Me;return r}function sf(t,e,i=!1){const r=new Array(e.length).fill(i?t.ZERO:void 0),s=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),n=t.inv(s);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),n),r}function Zc(t,e){const i=(t.ORDER-Me)/pi,r=t.pow(e,i),s=t.eql(r,t.ONE),n=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!s&&!n&&!o)throw new Error("invalid Legendre symbol result");return s?1:n?0:-1}function qv(t,e){e!==void 0&&Rt(e);const i=e!==void 0?e:t.toString(2).length,r=Math.ceil(i/8);return{nBitLength:i,nByteLength:r}}function Gi(t,e,i=!1,r={}){if(t<=Ye)throw new Error("invalid field: expected ORDER > 0, got "+t);let s,n;if(typeof e=="object"&&e!=null){if(r.sqrt||i)throw new Error("cannot specify opts in two arguments");const l=e;l.BITS&&(s=l.BITS),l.sqrt&&(n=l.sqrt),typeof l.isLE=="boolean"&&(i=l.isLE)}else typeof e=="number"&&(s=e),r.sqrt&&(n=r.sqrt);const{nBitLength:o,nByteLength:a}=qv(t,s);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const h=Object.freeze({ORDER:t,isLE:i,BITS:o,BYTES:a,MASK:Zs(o),ZERO:Ye,ONE:Me,create:l=>at(l,t),isValid:l=>{if(typeof l!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof l);return Ye<=l&&l<t},is0:l=>l===Ye,isValidNot0:l=>!h.is0(l)&&h.isValid(l),isOdd:l=>(l&Me)===Me,neg:l=>at(-l,t),eql:(l,u)=>l===u,sqr:l=>at(l*l,t),add:(l,u)=>at(l+u,t),sub:(l,u)=>at(l-u,t),mul:(l,u)=>at(l*u,t),pow:(l,u)=>zv(h,l,u),div:(l,u)=>at(l*Jc(u,t),t),sqrN:l=>l*l,addN:(l,u)=>l+u,subN:(l,u)=>l-u,mulN:(l,u)=>l*u,inv:l=>Jc(l,t),sqrt:n||(l=>(c||(c=kv(t)),c(h,l))),toBytes:l=>i?ra(l,a):ia(l,a),fromBytes:l=>{if(l.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+l.length);return i?Ns(l):Js(l)},invertBatch:l=>sf(h,l),cmov:(l,u,f)=>f?u:l});return Object.freeze(h)}function nf(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function of(t){const e=nf(t);return e+Math.ceil(e/2)}function jv(t,e,i=!1){const r=t.length,s=nf(e),n=of(e);if(r<16||r<n||r>1024)throw new Error("expected "+n+"-1024 bytes of input, got "+r);const o=i?Ns(t):Js(t),a=at(o,e-Me)+Me;return i?ra(a,s):ia(a,s)}const zi=BigInt(0),gi=BigInt(1);function mr(t,e){const i=e.negate();return t?i:e}function Fv(t,e,i){const r=n=>n.pz,s=sf(t.Fp,i.map(r));return i.map((n,o)=>n.toAffine(s[o])).map(t.fromAffine)}function af(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Tn(t,e){af(t,e);const i=Math.ceil(e/t)+1,r=2**(t-1),s=2**t,n=Zs(t),o=BigInt(t);return{windows:i,windowSize:r,mask:n,maxNumber:s,shiftBy:o}}function Xc(t,e,i){const{windowSize:r,mask:s,maxNumber:n,shiftBy:o}=i;let a=Number(t&s),c=t>>o;a>r&&(a-=n,c+=gi);const h=e*r,l=h+Math.abs(a)-1,u=a===0,f=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:u,isNeg:f,isNegF:p,offsetF:h}}function Kv(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((i,r)=>{if(!(i instanceof e))throw new Error("invalid point at index "+r)})}function Vv(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((i,r)=>{if(!e.isValid(i))throw new Error("invalid scalar at index "+r)})}const Pn=new WeakMap,cf=new WeakMap;function Cn(t){return cf.get(t)||1}function Qc(t){if(t!==zi)throw new Error("invalid wNAF")}function Hv(t,e){return{constTimeNegate:mr,hasPrecomputes(i){return Cn(i)!==1},unsafeLadder(i,r,s=t.ZERO){let n=i;for(;r>zi;)r&gi&&(s=s.add(n)),n=n.double(),r>>=gi;return s},precomputeWindow(i,r){const{windows:s,windowSize:n}=Tn(r,e),o=[];let a=i,c=a;for(let h=0;h<s;h++){c=a,o.push(c);for(let l=1;l<n;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(i,r,s){let n=t.ZERO,o=t.BASE;const a=Tn(i,e);for(let c=0;c<a.windows;c++){const{nextN:h,offset:l,isZero:u,isNeg:f,isNegF:p,offsetF:d}=Xc(s,c,a);s=h,u?o=o.add(mr(p,r[d])):n=n.add(mr(f,r[l]))}return Qc(s),{p:n,f:o}},wNAFUnsafe(i,r,s,n=t.ZERO){const o=Tn(i,e);for(let a=0;a<o.windows&&s!==zi;a++){const{nextN:c,offset:h,isZero:l,isNeg:u}=Xc(s,a,o);if(s=c,!l){const f=r[h];n=n.add(u?f.negate():f)}}return Qc(s),n},getPrecomputes(i,r,s){let n=Pn.get(r);return n||(n=this.precomputeWindow(r,i),i!==1&&(typeof s=="function"&&(n=s(n)),Pn.set(r,n))),n},wNAFCached(i,r,s){const n=Cn(i);return this.wNAF(n,this.getPrecomputes(n,i,s),r)},wNAFCachedUnsafe(i,r,s,n){const o=Cn(i);return o===1?this.unsafeLadder(i,r,n):this.wNAFUnsafe(o,this.getPrecomputes(o,i,s),r,n)},setWindowSize(i,r){af(r,e),cf.set(i,r),Pn.delete(i)}}}function Wv(t,e,i,r){let s=e,n=t.ZERO,o=t.ZERO;for(;i>zi||r>zi;)i&gi&&(n=n.add(s)),r&gi&&(o=o.add(s)),s=s.double(),i>>=gi,r>>=gi;return{p1:n,p2:o}}function Gv(t,e,i,r){Kv(i,t),Vv(r,e);const s=i.length,n=r.length;if(s!==n)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Cv(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const h=Zs(c),l=new Array(Number(h)+1).fill(o),u=Math.floor((e.BITS-1)/c)*c;let f=o;for(let p=u;p>=0;p-=c){l.fill(o);for(let g=0;g<n;g++){const y=r[g],v=Number(y>>BigInt(p)&h);l[v]=l[v].add(i[g])}let d=o;for(let g=l.length-1,y=o;g>0;g--)y=y.add(l[g]),d=d.add(y);if(f=f.add(d),p!==0)for(let g=0;g<c;g++)f=f.double()}return f}function eh(t,e){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Mv(e),e}else return Gi(t)}function Yv(t,e,i={}){if(!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const o of["p","n","h"]){const a=e[o];if(!(typeof a=="bigint"&&a>zi))throw new Error(`CURVE.${o} must be positive bigint`)}const r=eh(e.p,i.Fp),s=eh(e.n,i.Fn),n=["Gx","Gy","a","b"];for(const o of n)if(!r.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:r,Fn:s}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);const or=BigInt(0),Ui=BigInt(1),as=BigInt(2);function Jv(t){return Xs(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function Zv(t){const e=Jv(t),{P:i,type:r,adjustScalarBytes:s,powPminus2:n,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");const c=o||Wi,h=a?255:448,l=a?32:56,u=BigInt(a?9:5),f=BigInt(a?121665:39081),p=a?as**BigInt(254):as**BigInt(447),d=a?BigInt(8)*as**BigInt(251)-Ui:BigInt(4)*as**BigInt(445)-Ui,g=p+d+Ui,y=w=>at(w,i),v=E(u);function E(w){return ra(y(w),l)}function b(w){const A=He("u coordinate",w,l);return a&&(A[31]&=127),y(Ns(A))}function O(w){return Ns(s(He("scalar",w,l)))}function I(w,A){const _=P(b(A),O(w));if(_===or)throw new Error("invalid private or public key received");return E(_)}function U(w){return I(w,v)}function B(w,A,_){const D=y(w*(A-_));return A=y(A-D),_=y(_+D),{x_2:A,x_3:_}}function P(w,A){co("u",w,or,i),co("scalar",A,p,g);const _=A,D=w;let C=Ui,L=or,x=w,m=Ui,S=or;for(let $=BigInt(h-1);$>=or;$--){const R=_>>$&Ui;S^=R,{x_2:C,x_3:x}=B(S,C,x),{x_2:L,x_3:m}=B(S,L,m),S=R;const k=C+L,j=y(k*k),F=C-L,K=y(F*F),V=j-K,H=x+m,ie=x-m,te=y(ie*k),Y=y(H*F),ue=te+Y,Ie=te-Y;x=y(ue*ue),m=y(D*y(Ie*Ie)),C=y(j*K),L=y(V*(j+y(f*V)))}({x_2:C,x_3:x}=B(S,C,x)),{x_2:L,x_3:m}=B(S,L,m);const T=n(L);return y(C*T)}return{scalarMult:I,scalarMultBase:U,getSharedSecret:(w,A)=>I(w,A),getPublicKey:w=>U(w),utils:{randomPrivateKey:()=>c(l)},GuBytes:v.slice()}}BigInt(0);const Xv=BigInt(1),th=BigInt(2),Qv=BigInt(3),eE=BigInt(5),tE=BigInt(8),hf={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:tE,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function iE(t){const e=BigInt(10),i=BigInt(20),r=BigInt(40),s=BigInt(80),n=hf.p,o=t*t%n*t%n,a=dt(o,th,n)*o%n,c=dt(a,Xv,n)*t%n,h=dt(c,eE,n)*c%n,l=dt(h,e,n)*h%n,u=dt(l,i,n)*l%n,f=dt(u,r,n)*u%n,p=dt(f,s,n)*f%n,d=dt(p,s,n)*f%n,g=dt(d,e,n)*h%n;return{pow_p_5_8:dt(g,th,n)*t%n,b2:o}}function rE(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const ho=(()=>{const t=hf.p;return Zv({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:i,b2:r}=iE(e);return at(dt(i,Qv,t)*r,t)},adjustScalarBytes:rE})})();function ih(t){t.lowS!==void 0&&Us("lowS",t.lowS),t.prehash!==void 0&&Us("prehash",t.prehash)}class sE extends Error{constructor(e=""){super(e)}}const Ut={Err:sE,_tlv:{encode:(t,e)=>{const{Err:i}=Ut;if(t<0||t>256)throw new i("tlv.encode: wrong tag");if(e.length&1)throw new i("tlv.encode: unpadded data");const r=e.length/2,s=os(r);if(s.length/2&128)throw new i("tlv.encode: long form length too big");const n=r>127?os(s.length/2|128):"";return os(t)+n+s+e},decode(t,e){const{Err:i}=Ut;let r=0;if(t<0||t>256)throw new i("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new i("tlv.decode: wrong tlv");const s=e[r++],n=!!(s&128);let o=0;if(!n)o=s;else{const c=s&127;if(!c)throw new i("tlv.decode(long): indefinite length not supported");if(c>4)throw new i("tlv.decode(long): byte length is too big");const h=e.subarray(r,r+c);if(h.length!==c)throw new i("tlv.decode: length bytes not complete");if(h[0]===0)throw new i("tlv.decode(long): zero leftmost byte");for(const l of h)o=o<<8|l;if(r+=c,o<128)throw new i("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new i("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){const{Err:e}=Ut;if(t<vr)throw new e("integer: negative integers are not allowed");let i=os(t);if(Number.parseInt(i[0],16)&8&&(i="00"+i),i.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return i},decode(t){const{Err:e}=Ut;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Js(t)}},toSig(t){const{Err:e,_int:i,_tlv:r}=Ut,s=He("signature",t),{v:n,l:o}=r.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,n),{v:h,l}=r.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:i.decode(a),s:i.decode(h)}},hexFromSig(t){const{_tlv:e,_int:i}=Ut,r=e.encode(2,i.encode(t.r)),s=e.encode(2,i.encode(t.s)),n=r+s;return e.encode(48,n)}},vr=BigInt(0),Er=BigInt(1),nE=BigInt(2),cs=BigInt(3),oE=BigInt(4);function aE(t,e,i){function r(s){const n=t.sqr(s),o=t.mul(n,s);return t.add(t.add(o,t.mul(s,e)),i)}return r}function lf(t,e,i){const{BYTES:r}=t;function s(n){let o;if(typeof n=="bigint")o=n;else{let a=He("private key",n);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");const c=new Uint8Array(r);c.set(a,c.length-a.length),a=c}try{o=t.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${r}, got ${typeof n}`)}}if(i&&(o=t.create(o)),!t.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return s}function cE(t,e={}){const{Fp:i,Fn:r}=Yv("weierstrass",t,e),{h:s,n}=t;Xs(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=e;if(o&&(!i.is0(t.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(P,w,A){const{x:_,y:D}=w.toAffine(),C=i.toBytes(_);if(Us("isCompressed",A),A){a();const L=!i.isOdd(D);return di(uf(L),C)}else return di(Uint8Array.of(4),C,i.toBytes(D))}function h(P){ht(P);const w=i.BYTES,A=w+1,_=2*w+1,D=P.length,C=P[0],L=P.subarray(1);if(D===A&&(C===2||C===3)){const x=i.fromBytes(L);if(!i.isValid(x))throw new Error("bad point: is not on curve, wrong x");const m=f(x);let S;try{S=i.sqrt(m)}catch($){const R=$ instanceof Error?": "+$.message:"";throw new Error("bad point: is not on curve, sqrt error"+R)}a();const T=i.isOdd(S);return(C&1)===1!==T&&(S=i.neg(S)),{x,y:S}}else if(D===_&&C===4){const x=i.fromBytes(L.subarray(w*0,w*1)),m=i.fromBytes(L.subarray(w*1,w*2));if(!p(x,m))throw new Error("bad point: is not on curve");return{x,y:m}}else throw new Error(`bad point: got length ${D}, expected compressed=${A} or uncompressed=${_}`)}const l=e.toBytes||c,u=e.fromBytes||h,f=aE(i,t.a,t.b);function p(P,w){const A=i.sqr(w),_=f(P);return i.eql(A,_)}if(!p(t.Gx,t.Gy))throw new Error("bad curve params: generator point");const d=i.mul(i.pow(t.a,cs),oE),g=i.mul(i.sqr(t.b),BigInt(27));if(i.is0(i.add(d,g)))throw new Error("bad curve params: a or b");function y(P,w,A=!1){if(!i.isValid(w)||A&&i.is0(w))throw new Error(`bad point coordinate ${P}`);return w}function v(P){if(!(P instanceof I))throw new Error("ProjectivePoint expected")}const E=Yc((P,w)=>{const{px:A,py:_,pz:D}=P;if(i.eql(D,i.ONE))return{x:A,y:_};const C=P.is0();w==null&&(w=C?i.ONE:i.inv(D));const L=i.mul(A,w),x=i.mul(_,w),m=i.mul(D,w);if(C)return{x:i.ZERO,y:i.ZERO};if(!i.eql(m,i.ONE))throw new Error("invZ was invalid");return{x:L,y:x}}),b=Yc(P=>{if(P.is0()){if(e.allowInfinityPoint&&!i.is0(P.py))return;throw new Error("bad point: ZERO")}const{x:w,y:A}=P.toAffine();if(!i.isValid(w)||!i.isValid(A))throw new Error("bad point: x or y not field elements");if(!p(w,A))throw new Error("bad point: equation left != right");if(!P.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function O(P,w,A,_,D){return A=new I(i.mul(A.px,P),A.py,A.pz),w=mr(_,w),A=mr(D,A),w.add(A)}class I{constructor(w,A,_){this.px=y("x",w),this.py=y("y",A,!0),this.pz=y("z",_),Object.freeze(this)}static fromAffine(w){const{x:A,y:_}=w||{};if(!w||!i.isValid(A)||!i.isValid(_))throw new Error("invalid affine point");if(w instanceof I)throw new Error("projective point not allowed");return i.is0(A)&&i.is0(_)?I.ZERO:new I(A,_,i.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(w){return Fv(I,"pz",w)}static fromBytes(w){return ht(w),I.fromHex(w)}static fromHex(w){const A=I.fromAffine(u(He("pointHex",w)));return A.assertValidity(),A}static fromPrivateKey(w){const A=lf(r,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return I.BASE.multiply(A(w))}static msm(w,A){return Gv(I,r,w,A)}precompute(w=8,A=!0){return B.setWindowSize(this,w),A||this.multiply(cs),this}_setWindowSize(w){this.precompute(w)}assertValidity(){b(this)}hasEvenY(){const{y:w}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(w)}equals(w){v(w);const{px:A,py:_,pz:D}=this,{px:C,py:L,pz:x}=w,m=i.eql(i.mul(A,x),i.mul(C,D)),S=i.eql(i.mul(_,x),i.mul(L,D));return m&&S}negate(){return new I(this.px,i.neg(this.py),this.pz)}double(){const{a:w,b:A}=t,_=i.mul(A,cs),{px:D,py:C,pz:L}=this;let x=i.ZERO,m=i.ZERO,S=i.ZERO,T=i.mul(D,D),$=i.mul(C,C),R=i.mul(L,L),k=i.mul(D,C);return k=i.add(k,k),S=i.mul(D,L),S=i.add(S,S),x=i.mul(w,S),m=i.mul(_,R),m=i.add(x,m),x=i.sub($,m),m=i.add($,m),m=i.mul(x,m),x=i.mul(k,x),S=i.mul(_,S),R=i.mul(w,R),k=i.sub(T,R),k=i.mul(w,k),k=i.add(k,S),S=i.add(T,T),T=i.add(S,T),T=i.add(T,R),T=i.mul(T,k),m=i.add(m,T),R=i.mul(C,L),R=i.add(R,R),T=i.mul(R,k),x=i.sub(x,T),S=i.mul(R,$),S=i.add(S,S),S=i.add(S,S),new I(x,m,S)}add(w){v(w);const{px:A,py:_,pz:D}=this,{px:C,py:L,pz:x}=w;let m=i.ZERO,S=i.ZERO,T=i.ZERO;const $=t.a,R=i.mul(t.b,cs);let k=i.mul(A,C),j=i.mul(_,L),F=i.mul(D,x),K=i.add(A,_),V=i.add(C,L);K=i.mul(K,V),V=i.add(k,j),K=i.sub(K,V),V=i.add(A,D);let H=i.add(C,x);return V=i.mul(V,H),H=i.add(k,F),V=i.sub(V,H),H=i.add(_,D),m=i.add(L,x),H=i.mul(H,m),m=i.add(j,F),H=i.sub(H,m),T=i.mul($,V),m=i.mul(R,F),T=i.add(m,T),m=i.sub(j,T),T=i.add(j,T),S=i.mul(m,T),j=i.add(k,k),j=i.add(j,k),F=i.mul($,F),V=i.mul(R,V),j=i.add(j,F),F=i.sub(k,F),F=i.mul($,F),V=i.add(V,F),k=i.mul(j,V),S=i.add(S,k),k=i.mul(H,V),m=i.mul(K,m),m=i.sub(m,k),k=i.mul(K,j),T=i.mul(H,T),T=i.add(T,k),new I(m,S,T)}subtract(w){return this.add(w.negate())}is0(){return this.equals(I.ZERO)}multiply(w){const{endo:A}=e;if(!r.isValidNot0(w))throw new Error("invalid scalar: out of range");let _,D;const C=L=>B.wNAFCached(this,L,I.normalizeZ);if(A){const{k1neg:L,k1:x,k2neg:m,k2:S}=A.splitScalar(w),{p:T,f:$}=C(x),{p:R,f:k}=C(S);D=$.add(k),_=O(A.beta,T,R,L,m)}else{const{p:L,f:x}=C(w);_=L,D=x}return I.normalizeZ([_,D])[0]}multiplyUnsafe(w){const{endo:A}=e,_=this;if(!r.isValid(w))throw new Error("invalid scalar: out of range");if(w===vr||_.is0())return I.ZERO;if(w===Er)return _;if(B.hasPrecomputes(this))return this.multiply(w);if(A){const{k1neg:D,k1:C,k2neg:L,k2:x}=A.splitScalar(w),{p1:m,p2:S}=Wv(I,_,C,x);return O(A.beta,m,S,D,L)}else return B.wNAFCachedUnsafe(_,w)}multiplyAndAddUnsafe(w,A,_){const D=this.multiplyUnsafe(A).add(w.multiplyUnsafe(_));return D.is0()?void 0:D}toAffine(w){return E(this,w)}isTorsionFree(){const{isTorsionFree:w}=e;return s===Er?!0:w?w(I,this):B.wNAFCachedUnsafe(this,n).is0()}clearCofactor(){const{clearCofactor:w}=e;return s===Er?this:w?w(I,this):this.multiplyUnsafe(s)}toBytes(w=!0){return Us("isCompressed",w),this.assertValidity(),l(I,this,w)}toRawBytes(w=!0){return this.toBytes(w)}toHex(w=!0){return Pr(this.toBytes(w))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}I.BASE=new I(t.Gx,t.Gy,i.ONE),I.ZERO=new I(i.ZERO,i.ONE,i.ZERO),I.Fp=i,I.Fn=r;const U=r.BITS,B=Hv(I,e.endo?Math.ceil(U/2):U);return I}function uf(t){return Uint8Array.of(t?2:3)}function hE(t,e,i={}){Xs(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const r=e.randomBytes||Wi,s=e.hmac||((_,...D)=>Gs(e.hash,_,di(...D))),{Fp:n,Fn:o}=t,{ORDER:a,BITS:c}=o;function h(_){const D=a>>Er;return _>D}function l(_){return h(_)?o.neg(_):_}function u(_,D){if(!o.isValidNot0(D))throw new Error(`invalid signature ${_}: out of range 1..CURVE.n`)}class f{constructor(D,C,L){u("r",D),u("s",C),this.r=D,this.s=C,L!=null&&(this.recovery=L),Object.freeze(this)}static fromCompact(D){const C=o.BYTES,L=He("compactSignature",D,C*2);return new f(o.fromBytes(L.subarray(0,C)),o.fromBytes(L.subarray(C,C*2)))}static fromDER(D){const{r:C,s:L}=Ut.toSig(He("DER",D));return new f(C,L)}assertValidity(){}addRecoveryBit(D){return new f(this.r,this.s,D)}recoverPublicKey(D){const C=n.ORDER,{r:L,s:x,recovery:m}=this;if(m==null||![0,1,2,3].includes(m))throw new Error("recovery id invalid");if(a*nE<C&&m>1)throw new Error("recovery id is ambiguous for h>1 curve");const S=m===2||m===3?L+a:L;if(!n.isValid(S))throw new Error("recovery id 2 or 3 invalid");const T=n.toBytes(S),$=t.fromHex(di(uf((m&1)===0),T)),R=o.inv(S),k=b(He("msgHash",D)),j=o.create(-k*R),F=o.create(x*R),K=t.BASE.multiplyUnsafe(j).add($.multiplyUnsafe(F));if(K.is0())throw new Error("point at infinify");return K.assertValidity(),K}hasHighS(){return h(this.s)}normalizeS(){return this.hasHighS()?new f(this.r,o.neg(this.s),this.recovery):this}toBytes(D){if(D==="compact")return di(o.toBytes(this.r),o.toBytes(this.s));if(D==="der")return Xo(Ut.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Pr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Pr(this.toBytes("compact"))}}const p=lf(o,i.allowedPrivateKeyLengths,i.wrapPrivateKey),d={isValidPrivateKey(_){try{return p(_),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{const _=a;return jv(r(of(_)),_)},precompute(_=8,D=t.BASE){return D.precompute(_,!1)}};function g(_,D=!0){return t.fromPrivateKey(_).toBytes(D)}function y(_){if(typeof _=="bigint")return!1;if(_ instanceof t)return!0;const D=He("key",_).length,C=n.BYTES,L=C+1,x=2*C+1;if(!(i.allowedPrivateKeyLengths||o.BYTES===L))return D===L||D===x}function v(_,D,C=!0){if(y(_)===!0)throw new Error("first arg must be private key");if(y(D)===!1)throw new Error("second arg must be public key");return t.fromHex(D).multiply(p(_)).toBytes(C)}const E=e.bits2int||function(_){if(_.length>8192)throw new Error("input is too large");const D=Js(_),C=_.length*8-c;return C>0?D>>BigInt(C):D},b=e.bits2int_modN||function(_){return o.create(E(_))},O=Zs(c);function I(_){return co("num < 2^"+c,_,vr,O),o.toBytes(_)}function U(_,D,C=B){if(["recovered","canonical"].some(K=>K in C))throw new Error("sign() legacy options not supported");const{hash:L}=e;let{lowS:x,prehash:m,extraEntropy:S}=C;x==null&&(x=!0),_=He("msgHash",_),ih(C),m&&(_=He("prehashed msgHash",L(_)));const T=b(_),$=p(D),R=[I($),I(T)];if(S!=null&&S!==!1){const K=S===!0?r(n.BYTES):S;R.push(He("extraEntropy",K))}const k=di(...R),j=T;function F(K){const V=E(K);if(!o.isValidNot0(V))return;const H=o.inv(V),ie=t.BASE.multiply(V).toAffine(),te=o.create(ie.x);if(te===vr)return;const Y=o.create(H*o.create(j+te*$));if(Y===vr)return;let ue=(ie.x===te?0:2)|Number(ie.y&Er),Ie=Y;return x&&h(Y)&&(Ie=l(Y),ue^=1),new f(te,Ie,ue)}return{seed:k,k2sig:F}}const B={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function w(_,D,C=B){const{seed:L,k2sig:x}=U(_,D,C);return Uv(e.hash.outputLen,o.BYTES,s)(L,x)}t.BASE.precompute(8);function A(_,D,C,L=P){const x=_;D=He("msgHash",D),C=He("publicKey",C),ih(L);const{lowS:m,prehash:S,format:T}=L;if("strict"in L)throw new Error("options.strict was renamed to lowS");if(T!==void 0&&!["compact","der","js"].includes(T))throw new Error('format must be "compact", "der" or "js"');const $=typeof x=="string"||Yo(x),R=!$&&!T&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!$&&!R)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let k,j;try{if(R)if(T===void 0||T==="js")k=new f(x.r,x.s);else throw new Error("invalid format");if($){try{T!=="compact"&&(k=f.fromDER(x))}catch(ue){if(!(ue instanceof Ut.Err))throw ue}!k&&T!=="der"&&(k=f.fromCompact(x))}j=t.fromHex(C)}catch{return!1}if(!k||m&&k.hasHighS())return!1;S&&(D=e.hash(D));const{r:F,s:K}=k,V=b(D),H=o.inv(K),ie=o.create(V*H),te=o.create(F*H),Y=t.BASE.multiplyUnsafe(ie).add(j.multiplyUnsafe(te));return Y.is0()?!1:o.create(Y.x)===F}return Object.freeze({getPublicKey:g,getSharedSecret:v,sign:w,verify:A,utils:d,Point:t,Signature:f})}function lE(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},i=t.Fp,r=Gi(e.n,t.nBitLength),s={Fp:i,Fn:r,allowedPrivateKeyLengths:t.allowedPrivateKeyLengths,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,wrapPrivateKey:t.wrapPrivateKey,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:s}}function uE(t){const{CURVE:e,curveOpts:i}=lE(t),r={hash:t.hash,hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:i,ecdsaOpts:r}}function fE(t,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:t})}function dE(t){const{CURVE:e,curveOpts:i,ecdsaOpts:r}=uE(t),s=cE(e,i),n=hE(s,r,i);return fE(t,n)}function lo(t,e){const i=r=>dE({...t,hash:r});return{...i(e),create:i}}const ff={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},df={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},pf={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},pE=Gi(ff.p),gE=Gi(df.p),yE=Gi(pf.p),wE=lo({...ff,Fp:pE,lowS:!1},Ws);lo({...df,Fp:gE,lowS:!1},I2),lo({...pf,Fp:yE,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},x2);const bE=wE,gf="base10",ze="base16",Ge="base64pad",Qt="base64url",jr="utf8",yf=0,Nt=1,Fr=2,mE=0,rh=1,_r=12,sa=32;function vE(){const t=ho.utils.randomPrivateKey(),e=ho.getPublicKey(t);return{privateKey:Je(t,ze),publicKey:Je(e,ze)}}function uo(){const t=Wi(sa);return Je(t,ze)}function EE(t,e){const i=ho.getSharedSecret(ct(t,ze),ct(e,ze)),r=Tv(Ys,i,void 0,void 0,sa);return Je(r,ze)}function ws(t){const e=Ys(ct(t,ze));return Je(e,ze)}function nt(t){const e=Ys(ct(t,jr));return Je(e,ze)}function wf(t){return ct(`${t}`,gf)}function vi(t){return Number(Je(t,gf))}function bf(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function mf(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),i=(4-e.length%4)%4;return e+"=".repeat(i)}function _E(t){const e=wf(typeof t.type<"u"?t.type:yf);if(vi(e)===Nt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const i=typeof t.senderPublicKey<"u"?ct(t.senderPublicKey,ze):void 0,r=typeof t.iv<"u"?ct(t.iv,ze):Wi(_r),s=ct(t.symKey,ze),n=Ju(s,r).encrypt(ct(t.message,jr)),o=vf({type:e,sealed:n,iv:r,senderPublicKey:i});return t.encoding===Qt?bf(o):o}function xE(t){const e=ct(t.symKey,ze),{sealed:i,iv:r}=Ur({encoded:t.encoded,encoding:t.encoding}),s=Ju(e,r).decrypt(i);if(s===null)throw new Error("Failed to decrypt");return Je(s,jr)}function IE(t,e){const i=wf(Fr),r=Wi(_r),s=ct(t,jr),n=vf({type:i,sealed:s,iv:r});return e===Qt?bf(n):n}function SE(t,e){const{sealed:i}=Ur({encoded:t,encoding:e});return Je(i,jr)}function vf(t){if(vi(t.type)===Fr)return Je(br([t.type,t.sealed]),Ge);if(vi(t.type)===Nt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Je(br([t.type,t.senderPublicKey,t.iv,t.sealed]),Ge)}return Je(br([t.type,t.iv,t.sealed]),Ge)}function Ur(t){const e=(t.encoding||Ge)===Qt?mf(t.encoded):t.encoded,i=ct(e,Ge),r=i.slice(mE,rh),s=rh;if(vi(r)===Nt){const c=s+sa,h=c+_r,l=i.slice(s,c),u=i.slice(c,h),f=i.slice(h);return{type:r,sealed:f,iv:u,senderPublicKey:l}}if(vi(r)===Fr){const c=i.slice(s),h=Wi(_r);return{type:r,sealed:c,iv:h}}const n=s+_r,o=i.slice(s,n),a=i.slice(n);return{type:r,sealed:a,iv:o}}function DE(t,e){const i=Ur({encoded:t,encoding:e==null?void 0:e.encoding});return Ef({type:vi(i.type),senderPublicKey:typeof i.senderPublicKey<"u"?Je(i.senderPublicKey,ze):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Ef(t){const e=(t==null?void 0:t.type)||yf;if(e===Nt){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function sh(t){return t.type===Nt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function nh(t){return t.type===Fr}function $E(t){const e=Buffer.from(t.x,"base64"),i=Buffer.from(t.y,"base64");return br([new Uint8Array([4]),e,i])}function OE(t,e){const[i,r,s]=t.split("."),n=Buffer.from(mf(s),"base64");if(n.length!==64)throw new Error("Invalid signature length");const o=n.slice(0,32),a=n.slice(32,64),c=`${i}.${r}`,h=Ys(c),l=$E(e);if(!bE.verify(br([o,a]),h,l))throw new Error("Invalid signature");return Hn(t).payload}const AE="irn";function Rs(t){return(t==null?void 0:t.relay)||{protocol:AE}}function ki(t){const e=i1[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}function TE(t,e="-"){const i={},r="relay"+e;return Object.keys(t).forEach(s=>{if(s.startsWith(r)){const n=s.replace(r,""),o=t[s];i[n]=o}}),i}function oh(t){if(!t.includes("wc:")){const h=Pu(t);h!=null&&h.includes("wc:")&&(t=h)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),i=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),s=t.substring(e+1,i).split("@"),n=typeof i<"u"?t.substring(i):"",o=new URLSearchParams(n),a={};o.forEach((h,l)=>{a[l]=h});const c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:PE(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:TE(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function PE(t){return t.startsWith("//")?t.substring(2):t}function CE(t,e="-"){const i="relay",r={};return Object.keys(t).forEach(s=>{const n=s,o=i+e+n;t[n]&&(r[o]=t[n])}),r}function ah(t){const e=new URLSearchParams,i=CE(t.relay);Object.keys(i).sort().forEach(s=>{e.set(s,i[s])}),e.set("symKey",t.symKey),t.expiryTimestamp&&e.set("expiryTimestamp",t.expiryTimestamp.toString()),t.methods&&e.set("methods",t.methods.join(","));const r=e.toString();return`${t.protocol}:${t.topic}@${t.version}?${r}`}function hs(t,e,i){return`${t}?wc_ev=${i}&topic=${e}`}var UE=Object.defineProperty,NE=Object.defineProperties,RE=Object.getOwnPropertyDescriptors,ch=Object.getOwnPropertySymbols,BE=Object.prototype.hasOwnProperty,kE=Object.prototype.propertyIsEnumerable,hh=(t,e,i)=>e in t?UE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,LE=(t,e)=>{for(var i in e||(e={}))BE.call(e,i)&&hh(t,i,e[i]);if(ch)for(var i of ch(e))kE.call(e,i)&&hh(t,i,e[i]);return t},ME=(t,e)=>NE(t,RE(e));function Yi(t){const e=[];return t.forEach(i=>{const[r,s]=i.split(":");e.push(`${r}:${s}`)}),e}function zE(t){const e=[];return Object.values(t).forEach(i=>{e.push(...Yi(i.accounts))}),e}function qE(t,e){const i=[];return Object.values(t).forEach(r=>{Yi(r.accounts).includes(e)&&i.push(...r.methods)}),i}function jE(t,e){const i=[];return Object.values(t).forEach(r=>{Yi(r.accounts).includes(e)&&i.push(...r.events)}),i}function _f(t){return t.includes(":")}function FE(t){return _f(t)?t.split(":")[0]:t}function lh(t){var e,i,r;const s={};if(!Nr(t))return s;for(const[n,o]of Object.entries(t)){const a=_f(n)?[n]:o.chains,c=o.methods||[],h=o.events||[],l=FE(n);s[l]=ME(LE({},s[l]),{chains:yi(a,(e=s[l])==null?void 0:e.chains),methods:yi(c,(i=s[l])==null?void 0:i.methods),events:yi(h,(r=s[l])==null?void 0:r.events)})}return s}function KE(t){const e={};return t==null||t.forEach(i=>{var r;const[s,n]=i.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(i),(r=e[s].chains)==null||r.push(`${s}:${n}`)}),e}function uh(t,e){e=e.map(r=>r.replace("did:pkh:",""));const i=KE(e);for(const[r,s]of Object.entries(i))s.methods?s.methods=yi(s.methods,t):s.methods=t,s.events=["chainChanged","accountsChanged"];return i}function VE(t,e){var i,r,s,n,o,a;const c=lh(t),h=lh(e),l={},u=Object.keys(c).concat(Object.keys(h));for(const f of u)l[f]={chains:yi((i=c[f])==null?void 0:i.chains,(r=h[f])==null?void 0:r.chains),methods:yi((s=c[f])==null?void 0:s.methods,(n=h[f])==null?void 0:n.methods),events:yi((o=c[f])==null?void 0:o.events,(a=h[f])==null?void 0:a.events)};return l}const HE={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},WE={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function z(t,e){const{message:i,code:r}=WE[t];return{message:e?`${i} ${e}`:i,code:r}}function le(t,e){const{message:i,code:r}=HE[t];return{message:e?`${i} ${e}`:i,code:r}}function qi(t,e){return!!Array.isArray(t)}function Nr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function _e(t){return typeof t>"u"}function ge(t,e){return e&&_e(t)?!0:typeof t=="string"&&!!t.trim().length}function na(t,e){return typeof t=="number"&&!isNaN(t)}function GE(t,e){const{requiredNamespaces:i}=e,r=Object.keys(t.namespaces),s=Object.keys(i);let n=!0;return fi(s,r)?(r.forEach(o=>{const{accounts:a,methods:c,events:h}=t.namespaces[o],l=Yi(a),u=i[o];(!fi(Du(o,u),l)||!fi(u.methods,c)||!fi(u.events,h))&&(n=!1)}),n):!1}function Bs(t){return ge(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function YE(t){if(ge(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const i=e[0]+":"+e[1];return!!e[2]&&Bs(i)}}return!1}function JE(t){function e(i){try{return typeof new URL(i)<"u"}catch{return!1}}try{if(ge(t,!1)){if(e(t))return!0;const i=Pu(t);return e(i)}}catch{}return!1}function ZE(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function XE(t){return t==null?void 0:t.topic}function QE(t,e){let i=null;return ge(t==null?void 0:t.publicKey,!1)||(i=z("MISSING_OR_INVALID",`${e} controller public key should be a string`)),i}function fh(t){let e=!0;return qi(t)?t.length&&(e=t.every(i=>ge(i,!1))):e=!1,e}function e_(t,e,i){let r=null;return qi(e)&&e.length?e.forEach(s=>{r||Bs(s)||(r=le("UNSUPPORTED_CHAINS",`${i}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Bs(t)||(r=le("UNSUPPORTED_CHAINS",`${i}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function t_(t,e,i){let r=null;return Object.entries(t).forEach(([s,n])=>{if(r)return;const o=e_(s,Du(s,n),`${e} ${i}`);o&&(r=o)}),r}function i_(t,e){let i=null;return qi(t)?t.forEach(r=>{i||YE(r)||(i=le("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):i=le("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),i}function r_(t,e){let i=null;return Object.values(t).forEach(r=>{if(i)return;const s=i_(r==null?void 0:r.accounts,`${e} namespace`);s&&(i=s)}),i}function s_(t,e){let i=null;return fh(t==null?void 0:t.methods)?fh(t==null?void 0:t.events)||(i=le("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):i=le("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),i}function xf(t,e){let i=null;return Object.values(t).forEach(r=>{if(i)return;const s=s_(r,`${e}, namespace`);s&&(i=s)}),i}function n_(t,e,i){let r=null;if(t&&Nr(t)){const s=xf(t,e);s&&(r=s);const n=t_(t,e,i);n&&(r=n)}else r=z("MISSING_OR_INVALID",`${e}, ${i} should be an object with data`);return r}function Un(t,e){let i=null;if(t&&Nr(t)){const r=xf(t,e);r&&(i=r);const s=r_(t,e);s&&(i=s)}else i=z("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return i}function If(t){return ge(t.protocol,!0)}function o_(t,e){let i=!1;return t?t&&qi(t)&&t.length&&t.forEach(r=>{i=If(r)}):i=!0,i}function a_(t){return typeof t=="number"}function Ve(t){return typeof t<"u"&&typeof t!==null}function c_(t){return!(!t||typeof t!="object"||!t.code||!na(t.code)||!t.message||!ge(t.message,!1))}function h_(t){return!(_e(t)||!ge(t.method,!1))}function l_(t){return!(_e(t)||_e(t.result)&&_e(t.error)||!na(t.id)||!ge(t.jsonrpc,!1))}function u_(t){return!(_e(t)||!ge(t.name,!1))}function dh(t,e){return!(!Bs(e)||!zE(t).includes(e))}function f_(t,e,i){return ge(i,!1)?qE(t,e).includes(i):!1}function d_(t,e,i){return ge(i,!1)?jE(t,e).includes(i):!1}function ph(t,e,i){let r=null;const s=p_(t),n=g_(e),o=Object.keys(s),a=Object.keys(n),c=gh(Object.keys(t)),h=gh(Object.keys(e)),l=c.filter(u=>!h.includes(u));return l.length&&(r=z("NON_CONFORMING_NAMESPACES",`${i} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),fi(o,a)||(r=z("NON_CONFORMING_NAMESPACES",`${i} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(u=>{if(!u.includes(":")||r)return;const f=Yi(e[u].accounts);f.includes(u)||(r=z("NON_CONFORMING_NAMESPACES",`${i} namespaces accounts don't satisfy namespace accounts for ${u}
        Required: ${u}
        Approved: ${f.toString()}`))}),o.forEach(u=>{r||(fi(s[u].methods,n[u].methods)?fi(s[u].events,n[u].events)||(r=z("NON_CONFORMING_NAMESPACES",`${i} namespaces events don't satisfy namespace events for ${u}`)):r=z("NON_CONFORMING_NAMESPACES",`${i} namespaces methods don't satisfy namespace methods for ${u}`))}),r}function p_(t){const e={};return Object.keys(t).forEach(i=>{var r;i.includes(":")?e[i]=t[i]:(r=t[i].chains)==null||r.forEach(s=>{e[s]={methods:t[i].methods,events:t[i].events}})}),e}function gh(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function g_(t){const e={};return Object.keys(t).forEach(i=>{if(i.includes(":"))e[i]=t[i];else{const r=Yi(t[i].accounts);r==null||r.forEach(s=>{e[s]={accounts:t[i].accounts.filter(n=>n.includes(`${s}:`)),methods:t[i].methods,events:t[i].events}})}}),e}function y_(t,e){return na(t)&&t<=e.max&&t>=e.min}function yh(){const t=zr();return new Promise(e=>{switch(t){case tt.browser:e(w_());break;case tt.reactNative:e(b_());break;case tt.node:e(m_());break;default:e(!0)}})}function w_(){return Hi()&&(navigator==null?void 0:navigator.onLine)}async function b_(){if(ri()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo){const t=await(globalThis==null?void 0:globalThis.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function m_(){return!0}function v_(t){switch(zr()){case tt.browser:E_(t);break;case tt.reactNative:__(t);break}}function E_(t){!ri()&&Hi()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function __(t){ri()&&typeof globalThis<"u"&&globalThis!=null&&globalThis.NetInfo&&(globalThis==null||globalThis.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function x_(){var t;return Hi()&&wi()?((t=wi())==null?void 0:t.visibilityState)==="visible":!0}const Nn={};class ar{static get(e){return Nn[e]}static set(e,i){Nn[e]=i}static delete(e){delete Nn[e]}}function I_(t){const e=Lr.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function S_({publicKey:t,signature:e,payload:i}){var r;const s=fo(i.method),n=128|parseInt(((r=i.version)==null?void 0:r.toString())||"4"),o=O_(i.address),a=i.era==="00"?new Uint8Array([0]):fo(i.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(i.nonce,16),h=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${$_(i.tip)}`),u=T_(l),f=new Uint8Array([0,...t,o,...e,...a,...h,...u,...s]),p=A_(f.length+1);return new Uint8Array([...p,n,...f])}function D_(t){const e=fo(t),i=p1.blake2b(e,void 0,32);return"0x"+Buffer.from(i).toString("hex")}function fo(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function $_(t){return t.startsWith("0x")?t.slice(2):t}function O_(t){const e=Lr.decode(t)[0];return e===42?0:e===60?2:1}function A_(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function T_(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function P_(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),i=I_(t.transaction.address),r=S_({publicKey:i,signature:e,payload:t.transaction}),s=Buffer.from(r).toString("hex");return D_(s)}class C_{}class U_ extends C_{constructor(){super()}}class N_ extends U_{constructor(e){super()}}const R_="^wss?:";function B_(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function k_(t,e){const i=B_(t);return typeof i>"u"?!1:new RegExp(e).test(i)}function wh(t){return k_(t,R_)}function L_(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Sf(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function oa(t){return Sf(t)&&"method"in t}function Qs(t){return Sf(t)&&(_t(t)||ot(t))}function _t(t){return"result"in t}function ot(t){return"error"in t}class M_ extends N_{constructor(e){super(e),this.events=new wt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async request(e,i){return this.requestStrict(Ct(e.method,e.params||[],e.id||ei().toString()),i)}async requestStrict(e,i){return new Promise(async(r,s)=>{if(!this.connection.connected)try{await this.open()}catch(n){s(n)}this.events.on(`${e.id}`,n=>{ot(n)?s(n.error):r(n.result)});try{await this.connection.send(e,i)}catch(n){s(n)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Qs(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const z_=t=>JSON.stringify(t,(e,i)=>typeof i=="bigint"?i.toString()+"n":i),q_=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,i=t.replace(e,'$1"$2n"$3');return JSON.parse(i,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function j_(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return q_(t)}catch{return t}}function F_(t){return typeof t=="string"?t:z_(t)||""}const K_=()=>typeof WebSocket<"u"?WebSocket:typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"?globalThis.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),V_=()=>typeof WebSocket<"u"||typeof globalThis<"u"&&typeof globalThis.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",bh=t=>t.split("?")[0],mh=10,H_=K_();let W_=class{constructor(e){if(this.url=e,this.events=new wt.EventEmitter,this.registering=!1,!wh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,i)=>{if(typeof this.socket>"u"){i(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(F_(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!wh(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((r,s)=>{this.events.once("register_error",n=>{this.resetMaxListeners(),s(n)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((i,r)=>{const s=ad.isReactNative()?void 0:{rejectUnauthorized:!L_(e)},n=new H_(e,[],s);V_()?n.onerror=o=>{const a=o;r(this.emitError(a.error))}:n.on("error",o=>{r(this.emitError(o))}),n.onopen=()=>{this.onOpen(n),i(n)}})}onOpen(e){e.onmessage=i=>this.onPayload(i),e.onclose=i=>this.onClose(i),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const i=typeof e.data=="string"?j_(e.data):e.data;this.events.emit("payload",i)}onError(e,i){const r=this.parseError(i),s=r.message||r.toString(),n=$o(e,s);this.events.emit("payload",n)}parseError(e,i=this.url){return cd(e,bh(i),"WS")}resetMaxListeners(){this.events.getMaxListeners()>mh&&this.events.setMaxListeners(mh)}emitError(e){const i=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${bh(this.url)}`));return this.events.emit("register_error",i),i}};var G_={};const Df="wc",$f=2,ks="core",St=`${Df}@2:${ks}:`,Y_={name:ks,logger:"error"},J_={database:":memory:"},Z_="crypto",vh="client_ed25519_seed",X_=M.ONE_DAY,Q_="keychain",e3="0.3",t3="messages",i3="0.3",r3=M.SIX_HOURS,s3="publisher",Of="irn",n3="error",Af="wss://relay.walletconnect.org",o3="relayer",fe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},a3="_subscription",it={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},c3=.1,po="2.21.8",he={link_mode:"link_mode",relay:"relay"},bs={inbound:"inbound",outbound:"outbound"},h3="0.3",l3="WALLETCONNECT_CLIENT_ID",Eh="WALLETCONNECT_LINK_MODE_APPS",Qe={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},u3="subscription",f3="0.3",d3="pairing",p3="0.3",cr={wc_pairingDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:M.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:M.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:M.ONE_DAY,prompt:!1,tag:0},res:{ttl:M.ONE_DAY,prompt:!1,tag:0}}},ui={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},ft={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},g3="history",y3="0.3",w3="expirer",st={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},b3="0.3",m3="verify-api",v3="https://verify.walletconnect.com",Tf="https://verify.walletconnect.org",xr=Tf,E3=`${xr}/v3`,_3=[v3,Tf],x3="echo",I3="https://echo.walletconnect.com",Et={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Pt={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Gt={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},hr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},ai={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},lr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},S3=.1,D3="event-client",$3=86400,O3="https://pulse.walletconnect.org/batch";function A3(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),r=0;r<i.length;r++)i[r]=255;for(var s=0;s<t.length;s++){var n=t.charAt(s),o=n.charCodeAt(0);if(i[o]!==255)throw new TypeError(n+" is ambiguous");i[o]=s}var a=t.length,c=t.charAt(0),h=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function u(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var g=0,y=0,v=0,E=d.length;v!==E&&d[v]===0;)v++,g++;for(var b=(E-v)*l+1>>>0,O=new Uint8Array(b);v!==E;){for(var I=d[v],U=0,B=b-1;(I!==0||U<y)&&B!==-1;B--,U++)I+=256*O[B]>>>0,O[B]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");y=U,v++}for(var P=b-y;P!==b&&O[P]===0;)P++;for(var w=c.repeat(g);P<b;++P)w+=t.charAt(O[P]);return w}function f(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;var g=0;if(d[g]!==" "){for(var y=0,v=0;d[g]===c;)y++,g++;for(var E=(d.length-g)*h+1>>>0,b=new Uint8Array(E);d[g];){var O=i[d.charCodeAt(g)];if(O===255)return;for(var I=0,U=E-1;(O!==0||I<v)&&U!==-1;U--,I++)O+=a*b[U]>>>0,b[U]=O%256>>>0,O=O/256>>>0;if(O!==0)throw new Error("Non-zero carry");v=I,g++}if(d[g]!==" "){for(var B=E-v;B!==E&&b[B]===0;)B++;for(var P=new Uint8Array(y+(E-B)),w=y;B!==E;)P[w++]=b[B++];return P}}}function p(d){var g=f(d);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:u,decodeUnsafe:f,decode:p}}var T3=A3,P3=T3;const Pf=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},C3=t=>new TextEncoder().encode(t),U3=t=>new TextDecoder().decode(t);class N3{constructor(e,i,r){this.name=e,this.prefix=i,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class R3{constructor(e,i,r){if(this.name=e,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Cf(this,e)}}class B3{constructor(e){this.decoders=e}or(e){return Cf(this,e)}decode(e){const i=e[0],r=this.decoders[i];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Cf=(t,e)=>new B3({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class k3{constructor(e,i,r,s){this.name=e,this.prefix=i,this.baseEncode=r,this.baseDecode=s,this.encoder=new N3(e,i,r),this.decoder=new R3(e,i,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const en=({name:t,prefix:e,encode:i,decode:r})=>new k3(t,e,i,r),Kr=({prefix:t,name:e,alphabet:i})=>{const{encode:r,decode:s}=P3(i,e);return en({prefix:t,name:e,encode:r,decode:n=>Pf(s(n))})},L3=(t,e,i,r)=>{const s={};for(let l=0;l<e.length;++l)s[e[l]]=l;let n=t.length;for(;t[n-1]==="=";)--n;const o=new Uint8Array(n*i/8|0);let a=0,c=0,h=0;for(let l=0;l<n;++l){const u=s[t[l]];if(u===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<i|u,a+=i,a>=8&&(a-=8,o[h++]=255&c>>a)}if(a>=i||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},M3=(t,e,i)=>{const r=e[e.length-1]==="=",s=(1<<i)-1;let n="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>i;)o-=i,n+=e[s&a>>o];if(o&&(n+=e[s&a<<i-o]),r)for(;n.length*i&7;)n+="=";return n},Pe=({name:t,prefix:e,bitsPerChar:i,alphabet:r})=>en({prefix:e,name:t,encode(s){return M3(s,r,i)},decode(s){return L3(s,r,i,t)}}),z3=en({prefix:"\0",name:"identity",encode:t=>U3(t),decode:t=>C3(t)});var q3=Object.freeze({__proto__:null,identity:z3});const j3=Pe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var F3=Object.freeze({__proto__:null,base2:j3});const K3=Pe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var V3=Object.freeze({__proto__:null,base8:K3});const H3=Kr({prefix:"9",name:"base10",alphabet:"0123456789"});var W3=Object.freeze({__proto__:null,base10:H3});const G3=Pe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Y3=Pe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var J3=Object.freeze({__proto__:null,base16:G3,base16upper:Y3});const Z3=Pe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),X3=Pe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q3=Pe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ex=Pe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),tx=Pe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ix=Pe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),rx=Pe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),sx=Pe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),nx=Pe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var ox=Object.freeze({__proto__:null,base32:Z3,base32upper:X3,base32pad:Q3,base32padupper:ex,base32hex:tx,base32hexupper:ix,base32hexpad:rx,base32hexpadupper:sx,base32z:nx});const ax=Kr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),cx=Kr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var hx=Object.freeze({__proto__:null,base36:ax,base36upper:cx});const lx=Kr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ux=Kr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fx=Object.freeze({__proto__:null,base58btc:lx,base58flickr:ux});const dx=Pe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),px=Pe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),gx=Pe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yx=Pe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var wx=Object.freeze({__proto__:null,base64:dx,base64pad:px,base64url:gx,base64urlpad:yx});const Uf=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),bx=Uf.reduce((t,e,i)=>(t[i]=e,t),[]),mx=Uf.reduce((t,e,i)=>(t[e.codePointAt(0)]=i,t),[]);function vx(t){return t.reduce((e,i)=>(e+=bx[i],e),"")}function Ex(t){const e=[];for(const i of t){const r=mx[i.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${i}`);e.push(r)}return new Uint8Array(e)}const _x=en({prefix:"🚀",name:"base256emoji",encode:vx,decode:Ex});var xx=Object.freeze({__proto__:null,base256emoji:_x}),Ix=Nf,_h=128,Sx=127,Dx=~Sx,$x=Math.pow(2,31);function Nf(t,e,i){e=e||[],i=i||0;for(var r=i;t>=$x;)e[i++]=t&255|_h,t/=128;for(;t&Dx;)e[i++]=t&255|_h,t>>>=7;return e[i]=t|0,Nf.bytes=i-r+1,e}var Ox=go,Ax=128,xh=127;function go(t,r){var i=0,r=r||0,s=0,n=r,o,a=t.length;do{if(n>=a)throw go.bytes=0,new RangeError("Could not decode varint");o=t[n++],i+=s<28?(o&xh)<<s:(o&xh)*Math.pow(2,s),s+=7}while(o>=Ax);return go.bytes=n-r,i}var Tx=Math.pow(2,7),Px=Math.pow(2,14),Cx=Math.pow(2,21),Ux=Math.pow(2,28),Nx=Math.pow(2,35),Rx=Math.pow(2,42),Bx=Math.pow(2,49),kx=Math.pow(2,56),Lx=Math.pow(2,63),Mx=function(t){return t<Tx?1:t<Px?2:t<Cx?3:t<Ux?4:t<Nx?5:t<Rx?6:t<Bx?7:t<kx?8:t<Lx?9:10},zx={encode:Ix,decode:Ox,encodingLength:Mx},Rf=zx;const Ih=(t,e,i=0)=>(Rf.encode(t,e,i),e),Sh=t=>Rf.encodingLength(t),yo=(t,e)=>{const i=e.byteLength,r=Sh(t),s=r+Sh(i),n=new Uint8Array(s+i);return Ih(t,n,0),Ih(i,n,r),n.set(e,s),new qx(t,i,e,n)};class qx{constructor(e,i,r,s){this.code=e,this.size=i,this.digest=r,this.bytes=s}}const Bf=({name:t,code:e,encode:i})=>new jx(t,e,i);class jx{constructor(e,i,r){this.name=e,this.code=i,this.encode=r}digest(e){if(e instanceof Uint8Array){const i=this.encode(e);return i instanceof Uint8Array?yo(this.code,i):i.then(r=>yo(this.code,r))}else throw Error("Unknown type, must be binary type")}}const kf=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Fx=Bf({name:"sha2-256",code:18,encode:kf("SHA-256")}),Kx=Bf({name:"sha2-512",code:19,encode:kf("SHA-512")});var Vx=Object.freeze({__proto__:null,sha256:Fx,sha512:Kx});const Lf=0,Hx="identity",Mf=Pf,Wx=t=>yo(Lf,Mf(t)),Gx={code:Lf,name:Hx,encode:Mf,digest:Wx};var Yx=Object.freeze({__proto__:null,identity:Gx});new TextEncoder,new TextDecoder;const Dh={...q3,...F3,...V3,...W3,...J3,...ox,...hx,...fx,...wx,...xx};({...Vx,...Yx});function zf(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Jx(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?zf(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function qf(t,e,i,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:i},decoder:{decode:r}}}const $h=qf("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Rn=qf("ascii","a",t=>{let e="a";for(let i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},t=>{t=t.substring(1);const e=Jx(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}),Zx={utf8:$h,"utf-8":$h,hex:Dh.base16,latin1:Rn,ascii:Rn,binary:Rn,...Dh};function Xx(t,e="utf8"){const i=Zx[e];if(!i)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?zf(globalThis.Buffer.from(t,"utf-8")):i.decoder.decode(`${i.prefix}${t}`)}var Qx=Object.defineProperty,e8=(t,e,i)=>e in t?Qx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,vt=(t,e,i)=>e8(t,typeof e!="symbol"?e+"":e,i);class t8{constructor(e,i){this.core=e,this.logger=i,vt(this,"keychain",new Map),vt(this,"name",Q_),vt(this,"version",e3),vt(this,"initialized",!1),vt(this,"storagePrefix",St),vt(this,"init",async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}}),vt(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),vt(this,"set",async(r,s)=>{this.isInitialized(),this.keychain.set(r,s),await this.persist()}),vt(this,"get",r=>{this.isInitialized();const s=this.keychain.get(r);if(typeof s>"u"){const{message:n}=z("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return s}),vt(this,"del",async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()}),this.core=e,this.logger=qe(i,this.name)}get context(){return Ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,eo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?to(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var i8=Object.defineProperty,r8=(t,e,i)=>e in t?i8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,$e=(t,e,i)=>r8(t,typeof e!="symbol"?e+"":e,i);class s8{constructor(e,i,r){this.core=e,this.logger=i,$e(this,"name",Z_),$e(this,"keychain"),$e(this,"randomSessionIdentifier",uo()),$e(this,"initialized",!1),$e(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),$e(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),$e(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),n=oc(s);return kl(n.publicKey)}),$e(this,"generateKeyPair",()=>{this.isInitialized();const s=vE();return this.setPrivateKey(s.publicKey,s.privateKey)}),$e(this,"signJWT",async s=>{this.isInitialized();const n=await this.getClientSeed(),o=oc(n),a=this.randomSessionIdentifier;return await Q0(a,s,X_,o)}),$e(this,"generateSharedKey",(s,n,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=EE(a,n);return this.setSymKey(c,o)}),$e(this,"setSymKey",async(s,n)=>{this.isInitialized();const o=n||ws(s);return await this.keychain.set(o,s),o}),$e(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),$e(this,"encode",async(s,n,o)=>{this.isInitialized();const a=Ef(o),c=sg(n);if(nh(a))return IE(c,o==null?void 0:o.encoding);if(sh(a)){const f=a.senderPublicKey,p=a.receiverPublicKey;s=await this.generateSharedKey(f,p)}const h=this.getSymKey(s),{type:l,senderPublicKey:u}=a;return _E({type:l,symKey:h,message:c,senderPublicKey:u,encoding:o==null?void 0:o.encoding})}),$e(this,"decode",async(s,n,o)=>{this.isInitialized();const a=DE(n,o);if(nh(a)){const c=SE(n,o==null?void 0:o.encoding);return qa(c)}if(sh(a)){const c=a.receiverPublicKey,h=a.senderPublicKey;s=await this.generateSharedKey(c,h)}try{const c=this.getSymKey(s),h=xE({symKey:c,encoded:n,encoding:o==null?void 0:o.encoding});return qa(h)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),$e(this,"getPayloadType",(s,n=Ge)=>{const o=Ur({encoded:s,encoding:n});return vi(o.type)}),$e(this,"getPayloadSenderPublicKey",(s,n=Ge)=>{const o=Ur({encoded:s,encoding:n});return o.senderPublicKey?Je(o.senderPublicKey,ze):void 0}),this.core=e,this.logger=qe(i,this.name),this.keychain=r||new t8(this.core,this.logger)}get context(){return Ze(this.logger)}async setPrivateKey(e,i){return await this.keychain.set(e,i),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(vh)}catch{e=uo(),await this.keychain.set(vh,e)}return Xx(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var n8=Object.defineProperty,o8=Object.defineProperties,a8=Object.getOwnPropertyDescriptors,Oh=Object.getOwnPropertySymbols,c8=Object.prototype.hasOwnProperty,h8=Object.prototype.propertyIsEnumerable,wo=(t,e,i)=>e in t?n8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,l8=(t,e)=>{for(var i in e||(e={}))c8.call(e,i)&&wo(t,i,e[i]);if(Oh)for(var i of Oh(e))h8.call(e,i)&&wo(t,i,e[i]);return t},u8=(t,e)=>o8(t,a8(e)),Xe=(t,e,i)=>wo(t,typeof e!="symbol"?e+"":e,i);class f8 extends Fp{constructor(e,i){super(e,i),this.logger=e,this.core=i,Xe(this,"messages",new Map),Xe(this,"messagesWithoutClientAck",new Map),Xe(this,"name",t3),Xe(this,"version",i3),Xe(this,"initialized",!1),Xe(this,"storagePrefix",St),Xe(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}}),Xe(this,"set",async(r,s,n)=>{this.isInitialized();const o=nt(s);let a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(r,a),n===bs.inbound){const c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,u8(l8({},c),{[o]:s}))}return await this.persist(),o}),Xe(this,"get",r=>{this.isInitialized();let s=this.messages.get(r);return typeof s>"u"&&(s={}),s}),Xe(this,"getWithoutAck",r=>{this.isInitialized();const s={};for(const n of r){const o=this.messagesWithoutClientAck.get(n)||{};s[n]=Object.values(o)}return s}),Xe(this,"has",(r,s)=>{this.isInitialized();const n=this.get(r),o=nt(s);return typeof n[o]<"u"}),Xe(this,"ack",async(r,s)=>{this.isInitialized();const n=this.messagesWithoutClientAck.get(r);if(typeof n>"u")return;const o=nt(s);delete n[o],Object.keys(n).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,n),await this.persist()}),Xe(this,"del",async r=>{this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),await this.persist()}),this.logger=qe(e,this.name),this.core=i}get context(){return Ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,eo(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,eo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?to(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?to(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var d8=Object.defineProperty,p8=Object.defineProperties,g8=Object.getOwnPropertyDescriptors,Ah=Object.getOwnPropertySymbols,y8=Object.prototype.hasOwnProperty,w8=Object.prototype.propertyIsEnumerable,bo=(t,e,i)=>e in t?d8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ni=(t,e)=>{for(var i in e||(e={}))y8.call(e,i)&&bo(t,i,e[i]);if(Ah)for(var i of Ah(e))w8.call(e,i)&&bo(t,i,e[i]);return t},Th=(t,e)=>p8(t,g8(e)),rt=(t,e,i)=>bo(t,typeof e!="symbol"?e+"":e,i);class b8 extends Kp{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,rt(this,"events",new wt.EventEmitter),rt(this,"name",s3),rt(this,"queue",new Map),rt(this,"publishTimeout",M.toMiliseconds(M.ONE_MINUTE)),rt(this,"initialPublishTimeout",M.toMiliseconds(M.ONE_SECOND*15)),rt(this,"needsTransportRestart",!1),rt(this,"publish",async(r,s,n)=>{var o,a,c,h,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:n}});const u=(n==null?void 0:n.ttl)||r3,f=(n==null?void 0:n.prompt)||!1,p=(n==null?void 0:n.tag)||0,d=(n==null?void 0:n.id)||ei().toString(),g=ki(Rs().protocol),y={id:d,method:(n==null?void 0:n.publishMethod)||g.publish,params:Ni({topic:r,message:s,ttl:u,prompt:f,tag:p,attestation:n==null?void 0:n.attestation},(n==null?void 0:n.tvf)&&{tvf:n.tvf})},v=`Failed to publish payload, please try again. id:${d} tag:${p}`;try{_e((o=y.params)==null?void 0:o.prompt)&&((a=y.params)==null||delete a.prompt),_e((c=y.params)==null?void 0:c.tag)&&((h=y.params)==null||delete h.tag);const E=new Promise(async b=>{const O=({id:U})=>{var B;((B=y.id)==null?void 0:B.toString())===U.toString()&&(this.removeRequestFromQueue(U),this.relayer.events.removeListener(fe.publish,O),b())};this.relayer.events.on(fe.publish,O);const I=xt(new Promise((U,B)=>{this.rpcPublish(y,n).then(U).catch(P=>{this.logger.warn(P,P==null?void 0:P.message),B(P)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${d} tag:${p}`);try{await I,this.events.removeListener(fe.publish,O)}catch(U){this.queue.set(d,{request:y,opts:n,attempt:1}),this.logger.warn(U,U==null?void 0:U.message)}});this.logger.trace({type:"method",method:"publish",params:{id:d,topic:r,message:s,opts:n}}),await xt(E,this.publishTimeout,v)}catch(E){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(E),(l=n==null?void 0:n.internal)!=null&&l.throwOnFailedPublish)throw E}finally{this.queue.delete(d)}}),rt(this,"publishCustom",async r=>{var s,n,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});const{payload:h,opts:l={}}=r,{attestation:u,tvf:f,publishMethod:p,prompt:d,tag:g,ttl:y=M.FIVE_MINUTES}=l,v=l.id||ei().toString(),E=ki(Rs().protocol),b=p||E.publish,O={id:v,method:b,params:Ni(Th(Ni({},h),{ttl:y,prompt:d,tag:g,attestation:u}),f)},I=`Failed to publish custom payload, please try again. id:${v} tag:${g}`;try{_e((s=O.params)==null?void 0:s.prompt)&&((n=O.params)==null||delete n.prompt),_e((o=O.params)==null?void 0:o.tag)&&((a=O.params)==null||delete a.tag);const U=new Promise(async B=>{const P=({id:A})=>{var _;((_=O.id)==null?void 0:_.toString())===A.toString()&&(this.removeRequestFromQueue(A),this.relayer.events.removeListener(fe.publish,P),B())};this.relayer.events.on(fe.publish,P);const w=xt(new Promise((A,_)=>{this.rpcPublish(O,l).then(A).catch(D=>{this.logger.warn(D,D==null?void 0:D.message),_(D)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${b} id:${v} tag:${g}`);try{await w,this.events.removeListener(fe.publish,P)}catch(A){this.queue.set(v,{request:O,opts:l,attempt:1}),this.logger.warn(A,A==null?void 0:A.message)}});this.logger.trace({type:"method",method:"publish",params:{id:v,payload:h,opts:l}}),await xt(U,this.publishTimeout,I)}catch(U){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(U),(c=l==null?void 0:l.internal)!=null&&c.throwOnFailedPublish)throw U}finally{this.queue.delete(v)}}),rt(this,"on",(r,s)=>{this.events.on(r,s)}),rt(this,"once",(r,s)=>{this.events.once(r,s)}),rt(this,"off",(r,s)=>{this.events.off(r,s)}),rt(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),this.relayer=e,this.logger=qe(i,this.name),this.registerEventListeners()}get context(){return Ze(this.logger)}async rpcPublish(e,i){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const r=await this.relayer.request(e);return this.relayer.events.emit(fe.publish,Ni(Ni({},e),i)),this.logger.debug("Successfully Published Payload"),r}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,i)=>{var r;const s=e.attempt+1;this.queue.set(i,Th(Ni({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(r=e.request.params)==null?void 0:r.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(_i.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(fe.connection_stalled);return}this.checkQueue()}),this.relayer.on(fe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var m8=Object.defineProperty,v8=(t,e,i)=>e in t?m8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ri=(t,e,i)=>v8(t,typeof e!="symbol"?e+"":e,i);class E8{constructor(){Ri(this,"map",new Map),Ri(this,"set",(e,i)=>{const r=this.get(e);this.exists(e,i)||this.map.set(e,[...r,i])}),Ri(this,"get",e=>this.map.get(e)||[]),Ri(this,"exists",(e,i)=>this.get(e).includes(i)),Ri(this,"delete",(e,i)=>{if(typeof i>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,i))return;const s=r.filter(n=>n!==i);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Ri(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var _8=Object.defineProperty,x8=Object.defineProperties,I8=Object.getOwnPropertyDescriptors,Ph=Object.getOwnPropertySymbols,S8=Object.prototype.hasOwnProperty,D8=Object.prototype.propertyIsEnumerable,mo=(t,e,i)=>e in t?_8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ur=(t,e)=>{for(var i in e||(e={}))S8.call(e,i)&&mo(t,i,e[i]);if(Ph)for(var i of Ph(e))D8.call(e,i)&&mo(t,i,e[i]);return t},Bn=(t,e)=>x8(t,I8(e)),oe=(t,e,i)=>mo(t,typeof e!="symbol"?e+"":e,i);class $8 extends Wp{constructor(e,i){super(e,i),this.relayer=e,this.logger=i,oe(this,"subscriptions",new Map),oe(this,"topicMap",new E8),oe(this,"events",new wt.EventEmitter),oe(this,"name",u3),oe(this,"version",f3),oe(this,"pending",new Map),oe(this,"cached",[]),oe(this,"initialized",!1),oe(this,"storagePrefix",St),oe(this,"subscribeTimeout",M.toMiliseconds(M.ONE_MINUTE)),oe(this,"initialSubscribeTimeout",M.toMiliseconds(M.ONE_SECOND*15)),oe(this,"clientId"),oe(this,"batchSubscribeTopicsLimit",500),oe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),oe(this,"subscribe",async(r,s)=>{var n;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}});try{const o=Rs(s),a={topic:r,relay:o,transportType:s==null?void 0:s.transportType};(n=s==null?void 0:s.internal)!=null&&n.skipSubscribe||this.pending.set(r,a);const c=await this.rpcSubscribe(r,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),oe(this,"unsubscribe",async(r,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(r,s.id,s):await this.unsubscribeByTopic(r,s)}),oe(this,"isSubscribed",r=>new Promise(s=>{s(this.topicMap.topics.includes(r))})),oe(this,"isKnownTopic",r=>new Promise(s=>{s(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(n=>n.topic===r))})),oe(this,"on",(r,s)=>{this.events.on(r,s)}),oe(this,"once",(r,s)=>{this.events.once(r,s)}),oe(this,"off",(r,s)=>{this.events.off(r,s)}),oe(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),oe(this,"start",async()=>{await this.onConnect()}),oe(this,"stop",async()=>{await this.onDisconnect()}),oe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),oe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const r=[];this.pending.forEach(s=>{r.push(s)}),await this.batchSubscribe(r)}),oe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(_i.pulse,async()=>{await this.checkPending()}),this.events.on(Qe.created,async r=>{const s=Qe.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()}),this.events.on(Qe.deleted,async r=>{const s=Qe.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:r}),await this.persist()})}),this.relayer=e,this.logger=qe(i,this.name),this.clientId=""}get context(){return Ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,i){let r=!1;try{r=this.getSubscription(e).topic===i}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,i){const r=this.topicMap.get(e);await Promise.all(r.map(async s=>await this.unsubscribeById(e,s,i)))}async unsubscribeById(e,i,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:r}});try{const s=Rs(r);await this.restartToComplete({topic:e,id:i,relay:s}),await this.rpcUnsubscribe(e,i,s);const n=le("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,i,n),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:i,opts:r}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,i,r){var s,n;const o=await this.getSubscriptionId(e);if((s=r==null?void 0:r.internal)!=null&&s.skipSubscribe)return o;(!r||(r==null?void 0:r.transportType)===he.relay)&&await this.restartToComplete({topic:e,id:e,relay:i});const a={method:ki(i.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(n=r==null?void 0:r.internal)==null?void 0:n.throwOnFailedPublish;try{if((r==null?void 0:r.transportType)===he.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(u=>this.logger.warn(u))},M.toMiliseconds(M.ONE_SECOND)),o;const h=new Promise(async u=>{const f=p=>{p.topic===e&&(this.events.removeListener(Qe.created,f),u(p.id))};this.events.on(Qe.created,f);try{const p=await xt(new Promise((d,g)=>{this.relayer.request(a).catch(y=>{this.logger.warn(y,y==null?void 0:y.message),g(y)}).then(d)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Qe.created,f),u(p)}catch{}}),l=await xt(h,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(h){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(fe.connection_stalled),c)throw h}return null}async rpcBatchSubscribe(e){if(!e.length)return;const i=e[0].relay,r={method:ki(i.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{await await xt(new Promise(s=>{this.relayer.request(r).catch(n=>this.logger.warn(n)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(fe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const i=e[0].relay,r={method:ki(i.protocol).batchFetchMessages,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let s;try{s=await await xt(new Promise((n,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(n)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(fe.connection_stalled)}return s}rpcUnsubscribe(e,i,r){const s={method:ki(r.protocol).unsubscribe,params:{topic:e,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,i){this.setSubscription(e,Bn(ur({},i),{id:e})),this.pending.delete(i.topic)}onBatchSubscribe(e){e.length&&e.forEach(i=>{this.setSubscription(i.id,ur({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(e,i,r){this.events.removeAllListeners(i),this.hasSubscription(i,e)&&this.deleteSubscription(i,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,i){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:i}),this.addSubscription(e,i)}addSubscription(e,i){this.subscriptions.set(e,ur({},i)),this.topicMap.set(i.topic,e),this.events.emit(Qe.created,i)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const i=this.subscriptions.get(e);if(!i){const{message:r}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return i}deleteSubscription(e,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:i});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Qe.deleted,Bn(ur({},r),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Qe.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],i=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<i;r++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Qe.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(i=>{var r;return i.topic===((r=this.subscriptions.get(i.id))==null?void 0:r.topic)})){const{message:i}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async i=>Bn(ur({},i),{id:await this.getSubscriptionId(i.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const i=await this.rpcBatchFetchMessages(e);i&&i.messages&&(await q1(M.toMiliseconds(M.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(i.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return nt(e+await this.getClientId())}}var O8=Object.defineProperty,Ch=Object.getOwnPropertySymbols,A8=Object.prototype.hasOwnProperty,T8=Object.prototype.propertyIsEnumerable,vo=(t,e,i)=>e in t?O8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Uh=(t,e)=>{for(var i in e||(e={}))A8.call(e,i)&&vo(t,i,e[i]);if(Ch)for(var i of Ch(e))T8.call(e,i)&&vo(t,i,e[i]);return t},Q=(t,e,i)=>vo(t,typeof e!="symbol"?e+"":e,i);class P8 extends Vp{constructor(e){super(e),Q(this,"protocol","wc"),Q(this,"version",2),Q(this,"core"),Q(this,"logger"),Q(this,"events",new wt.EventEmitter),Q(this,"provider"),Q(this,"messages"),Q(this,"subscriber"),Q(this,"publisher"),Q(this,"name",o3),Q(this,"transportExplicitlyClosed",!1),Q(this,"initialized",!1),Q(this,"connectionAttemptInProgress",!1),Q(this,"relayUrl"),Q(this,"projectId"),Q(this,"packageName"),Q(this,"bundleId"),Q(this,"hasExperiencedNetworkDisruption",!1),Q(this,"pingTimeout"),Q(this,"heartBeatTimeout",M.toMiliseconds(M.THIRTY_SECONDS+M.FIVE_SECONDS)),Q(this,"reconnectTimeout"),Q(this,"connectPromise"),Q(this,"reconnectInProgress",!1),Q(this,"requestsInFlight",[]),Q(this,"connectTimeout",M.toMiliseconds(M.ONE_SECOND*15)),Q(this,"request",async i=>{var r,s;this.logger.debug("Publishing Request Payload");const n=i.id||ei().toString();await this.toEstablishConnection();try{this.logger.trace({id:n,method:i.method,topic:(r=i.params)==null?void 0:r.topic},"relayer.request - publishing...");const o=`${n}:${((s=i.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(i);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${n}`),o}}),Q(this,"resetPingTimeout",()=>{Ps()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var i,r,s,n;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(n=(s=(r=(i=this.provider)==null?void 0:i.connection)==null?void 0:r.socket)==null?void 0:s.terminate)==null||n.call(s)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),Q(this,"onPayloadHandler",i=>{this.onProviderPayload(i),this.resetPingTimeout()}),Q(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(fe.connect)}),Q(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),Q(this,"onProviderErrorHandler",i=>{this.logger.fatal(`Fatal socket error: ${i.message}`),this.events.emit(fe.error,i),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Q(this,"registerProviderListeners",()=>{this.provider.on(it.payload,this.onPayloadHandler),this.provider.on(it.connect,this.onConnectHandler),this.provider.on(it.disconnect,this.onDisconnectHandler),this.provider.on(it.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?qe(e.logger,this.name):qs(To({level:e.logger||n3})),this.messages=new f8(this.logger,e.core),this.subscriber=new $8(this,this.logger),this.publisher=new b8(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Af,S1()?this.packageName=Dc():D1()&&(this.bundleId=Dc()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return Ze(this.logger)}get connected(){var e,i,r;return((r=(i=(e=this.provider)==null?void 0:e.connection)==null?void 0:i.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,i,r;return((r=(i=(e=this.provider)==null?void 0:e.connection)==null?void 0:i.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,i,r){this.isInitialized(),await this.publisher.publish(e,i,r),await this.recordMessageEvent({topic:e,message:i,publishedAt:Date.now(),transportType:he.relay},bs.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,i){var r,s,n;this.isInitialized(),(!(i!=null&&i.transportType)||(i==null?void 0:i.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((r=i==null?void 0:i.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(s=i==null?void 0:i.internal)==null?void 0:s.throwOnFailedPublish;let a=((n=this.subscriber.topicMap.get(e))==null?void 0:n[0])||"",c;const h=l=>{l.topic===e&&(this.subscriber.off(Qe.created,h),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Qe.created,h)}),new Promise(async(l,u)=>{a=await this.subscriber.subscribe(e,Uh({internal:{throwOnFailedPublish:o}},i)).catch(f=>{o&&u(f)})||a,l()})]),a}async unsubscribe(e,i){this.isInitialized(),await this.subscriber.unsubscribe(e,i)}on(e,i){this.events.on(e,i)}once(e,i){this.events.once(e,i)}off(e,i){this.events.off(e,i)}removeListener(e,i){this.events.removeListener(e,i)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await xt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(i,r)=>{await this.connect(e).then(i).catch(r).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await yh())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const i=e.sort((r,s)=>r.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${i.length} message events sorted`);for(const r of i)try{await this.onMessageEvent(r)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${i.length} message events processed`)}async onLinkMessageEvent(e,i){const{topic:r}=e;if(!i.sessionExists){const s=we(M.FIVE_MINUTES),n={topic:r,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(r,n)}this.events.emit(fe.message,e),await this.recordMessageEvent(e,bs.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let i=1;for(;i<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${i}...`),await this.createProvider(),await new Promise(async(r,s)=>{const n=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(it.disconnect,n),await xt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(it.disconnect,n),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(it.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(it.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){await this.subscriber.stop();const s=r;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${i}`);break}await new Promise(r=>setTimeout(r,M.toMiliseconds(i*1))),i++}}startPingTimeout(){var e,i,r,s,n;if(Ps())try{(i=(e=this.provider)==null?void 0:e.connection)!=null&&i.socket&&((n=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null||n.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new M_(new W_(P1({sdkVersion:po,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,i){const{topic:r,message:s}=e;await this.messages.set(r,s,i)}async shouldIgnoreMessageEvent(e){const{topic:i,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isKnownTopic(i))return this.logger.warn(`Ignoring message for unknown topic ${i}`),!0;const s=this.messages.has(i,r);return s&&this.logger.warn(`Ignoring duplicate message: ${r}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),oa(e)){if(!e.method.endsWith(a3))return;const i=e.params,{topic:r,message:s,publishedAt:n,attestation:o}=i.data,a={topic:r,message:s,publishedAt:n,transportType:he.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Uh({type:"event",event:i.id},a)),this.events.emit(i.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Qs(e)&&this.events.emit(fe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,bs.inbound),this.events.emit(fe.message,e))}async acknowledgePayload(e){const i=Es(e.id,!0);await this.provider.connection.send(i)}unregisterProviderListeners(){this.provider.off(it.payload,this.onPayloadHandler),this.provider.off(it.connect,this.onConnectHandler),this.provider.off(it.disconnect,this.onDisconnectHandler),this.provider.off(it.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await yh();v_(async i=>{e!==i&&(e=i,i?await this.transportOpen().catch(r=>this.logger.error(r,r==null?void 0:r.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(_i.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&x_())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(i){this.logger.warn(i,i==null?void 0:i.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(fe.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},M.toMiliseconds(c3)))))}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function C8(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Nh(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Rh(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const U8="[object RegExp]",N8="[object String]",R8="[object Number]",B8="[object Boolean]",Bh="[object Arguments]",k8="[object Symbol]",L8="[object Date]",M8="[object Map]",z8="[object Set]",q8="[object Array]",j8="[object Function]",F8="[object ArrayBuffer]",kn="[object Object]",K8="[object Error]",V8="[object DataView]",H8="[object Uint8Array]",W8="[object Uint8ClampedArray]",G8="[object Uint16Array]",Y8="[object Uint32Array]",J8="[object BigUint64Array]",Z8="[object Int8Array]",X8="[object Int16Array]",Q8="[object Int32Array]",eI="[object BigInt64Array]",tI="[object Float32Array]",iI="[object Float64Array]";function rI(){}function kh(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function sI(t,e,i){return yr(t,e,void 0,void 0,void 0,void 0,i)}function yr(t,e,i,r,s,n,o){const a=o(t,e,i,r,s,n);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return Ir(t,e,n,o)}return Ir(t,e,n,o)}function Ir(t,e,i,r){if(Object.is(t,e))return!0;let s=Rh(t),n=Rh(e);if(s===Bh&&(s=kn),n===Bh&&(n=kn),s!==n)return!1;switch(s){case N8:return t.toString()===e.toString();case R8:{const c=t.valueOf(),h=e.valueOf();return C8(c,h)}case B8:case L8:case k8:return Object.is(t.valueOf(),e.valueOf());case U8:return t.source===e.source&&t.flags===e.flags;case j8:return t===e}i=i??new Map;const o=i.get(t),a=i.get(e);if(o!=null&&a!=null)return o===e;i.set(t,e),i.set(e,t);try{switch(s){case M8:{if(t.size!==e.size)return!1;for(const[c,h]of t.entries())if(!e.has(c)||!yr(h,e.get(c),c,t,e,i,r))return!1;return!0}case z8:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),h=Array.from(e.values());for(let l=0;l<c.length;l++){const u=c[l],f=h.findIndex(p=>yr(u,p,void 0,t,e,i,r));if(f===-1)return!1;h.splice(f,1)}return!0}case q8:case H8:case W8:case G8:case Y8:case J8:case Z8:case X8:case Q8:case eI:case tI:case iI:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!yr(t[c],e[c],c,t,e,i,r))return!1;return!0}case F8:return t.byteLength!==e.byteLength?!1:Ir(new Uint8Array(t),new Uint8Array(e),i,r);case V8:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:Ir(new Uint8Array(t),new Uint8Array(e),i,r);case K8:return t.name===e.name&&t.message===e.message;case kn:{if(!(Ir(t.constructor,e.constructor,i,r)||kh(t)&&kh(e)))return!1;const c=[...Object.keys(t),...Nh(t)],h=[...Object.keys(e),...Nh(e)];if(c.length!==h.length)return!1;for(let l=0;l<c.length;l++){const u=c[l],f=t[u];if(!Object.hasOwn(e,u))return!1;const p=e[u];if(!yr(f,p,u,t,e,i,r))return!1}return!0}default:return!1}}finally{i.delete(t),i.delete(e)}}function nI(t,e){return sI(t,e,rI)}var oI=Object.defineProperty,Lh=Object.getOwnPropertySymbols,aI=Object.prototype.hasOwnProperty,cI=Object.prototype.propertyIsEnumerable,Eo=(t,e,i)=>e in t?oI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Mh=(t,e)=>{for(var i in e||(e={}))aI.call(e,i)&&Eo(t,i,e[i]);if(Lh)for(var i of Lh(e))cI.call(e,i)&&Eo(t,i,e[i]);return t},Fe=(t,e,i)=>Eo(t,typeof e!="symbol"?e+"":e,i);class Si extends Hp{constructor(e,i,r,s=St,n=void 0){super(e,i,r,s),this.core=e,this.logger=i,this.name=r,Fe(this,"map",new Map),Fe(this,"version",h3),Fe(this,"cached",[]),Fe(this,"initialized",!1),Fe(this,"getKey"),Fe(this,"storagePrefix",St),Fe(this,"recentlyDeleted",[]),Fe(this,"recentlyDeletedLimit",200),Fe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!_e(o)?this.map.set(this.getKey(o),o):ZE(o)?this.map.set(o.id,o):XE(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Fe(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Fe(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Fe(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>nI(a[c],o[c]))):this.values)),Fe(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Mh(Mh({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Fe(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=qe(i,this.name),this.storagePrefix=s,this.getKey=n}get context(){return Ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const i=this.map.get(e);if(!i){if(this.recentlyDeleted.includes(e)){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:r}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:i}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var hI=Object.defineProperty,lI=(t,e,i)=>e in t?hI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,J=(t,e,i)=>lI(t,typeof e!="symbol"?e+"":e,i);class uI{constructor(e,i){this.core=e,this.logger=i,J(this,"name",d3),J(this,"version",p3),J(this,"events",new el),J(this,"pairings"),J(this,"initialized",!1),J(this,"storagePrefix",St),J(this,"ignoredPayloadTypes",[Nt]),J(this,"registeredMethods",[]),J(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),J(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),J(this,"create",async r=>{this.isInitialized();const s=uo(),n=await this.core.crypto.setSymKey(s),o=we(M.FIVE_MINUTES),a={protocol:Of},c={topic:n,expiry:o,relay:a,active:!1,methods:r==null?void 0:r.methods},h=ah({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:s,relay:a,expiryTimestamp:o,methods:r==null?void 0:r.methods});return this.events.emit(ui.create,c),this.core.expirer.set(n,o),await this.pairings.set(n,c),await this.core.relayer.subscribe(n,{transportType:r==null?void 0:r.transportType,internal:r==null?void 0:r.internal}),{topic:n,uri:h}}),J(this,"pair",async r=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:r==null?void 0:r.uri,trace:[Et.pairing_started]}});this.isValidPair(r,s);const{topic:n,symKey:o,relay:a,expiryTimestamp:c,methods:h}=oh(r.uri);s.props.properties.topic=n,s.addTrace(Et.pairing_uri_validation_success),s.addTrace(Et.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(n)){if(l=this.pairings.get(n),s.addTrace(Et.existing_pairing),l.active)throw s.setError(Pt.active_pairing_already_exists),new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);s.addTrace(Et.pairing_not_expired)}const u=c||we(M.FIVE_MINUTES),f={topic:n,relay:a,expiry:u,active:!1,methods:h};this.core.expirer.set(n,u),await this.pairings.set(n,f),s.addTrace(Et.store_new_pairing),r.activatePairing&&await this.activate({topic:n}),this.events.emit(ui.create,f),s.addTrace(Et.emit_inactive_pairing),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(o,n),s.addTrace(Et.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Pt.no_internet_connection)}try{await this.core.relayer.subscribe(n,{relay:a})}catch(p){throw s.setError(Pt.subscribe_pairing_topic_failure),p}return s.addTrace(Et.subscribe_pairing_topic_success),f}),J(this,"activate",async({topic:r})=>{this.isInitialized();const s=we(M.FIVE_MINUTES);this.core.expirer.set(r,s),await this.pairings.update(r,{active:!0,expiry:s})}),J(this,"ping",async r=>{this.isInitialized(),await this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=r;if(this.pairings.keys.includes(s)){const n=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=ci();this.events.once(re("pairing_ping",n),({error:h})=>{h?c(h):a()}),await o()}}),J(this,"updateExpiry",async({topic:r,expiry:s})=>{this.isInitialized(),await this.pairings.update(r,{expiry:s})}),J(this,"updateMetadata",async({topic:r,metadata:s})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:s})}),J(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),J(this,"disconnect",async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",le("USER_DISCONNECTED")),await this.deletePairing(s))}),J(this,"formatUriFromPairing",r=>{this.isInitialized();const{topic:s,relay:n,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(s);return ah({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:n,expiryTimestamp:o,methods:a})}),J(this,"sendRequest",async(r,s,n)=>{const o=Ct(s,n),a=await this.core.crypto.encode(r,o),c=cr[s].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id}),J(this,"sendResult",async(r,s,n)=>{const o=Es(r,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,r)).request.method,h=cr[c].res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),J(this,"sendError",async(r,s,n)=>{const o=$o(r,n),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,r)).request.method,h=cr[c]?cr[c].res:cr.unregistered_method.res;await this.core.relayer.publish(s,a,h),await this.core.history.resolve(o)}),J(this,"deletePairing",async(r,s)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,le("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),s?Promise.resolve():this.core.expirer.del(r)])}),J(this,"cleanup",async()=>{const r=this.pairings.getAll().filter(s=>Yt(s.expiry));await Promise.all(r.map(s=>this.deletePairing(s.topic)))}),J(this,"onRelayEventRequest",async r=>{const{topic:s,payload:n}=r;switch(n.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,n);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,n);default:return await this.onUnknownRpcMethodRequest(s,n)}}),J(this,"onRelayEventResponse",async r=>{const{topic:s,payload:n}=r,o=(await this.core.history.get(s,n.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,n);default:return this.onUnknownRpcMethodResponse(o)}}),J(this,"onPairingPingRequest",async(r,s)=>{const{id:n}=s;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.events.emit(ui.ping,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),J(this,"onPairingPingResponse",(r,s)=>{const{id:n}=s;setTimeout(()=>{_t(s)?this.events.emit(re("pairing_ping",n),{}):ot(s)&&this.events.emit(re("pairing_ping",n),{error:s.error})},500)}),J(this,"onPairingDeleteRequest",async(r,s)=>{const{id:n}=s;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(ui.delete,{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.logger.error(o)}}),J(this,"onUnknownRpcMethodRequest",async(r,s)=>{const{id:n,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=le("WC_METHOD_UNSUPPORTED",o);await this.sendError(n,r,a),this.logger.error(a)}catch(a){await this.sendError(n,r,a),this.logger.error(a)}}),J(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(le("WC_METHOD_UNSUPPORTED",r))}),J(this,"isValidPair",(r,s)=>{var n;if(!Ve(r)){const{message:a}=z("MISSING_OR_INVALID",`pair() params: ${r}`);throw s.setError(Pt.malformed_pairing_uri),new Error(a)}if(!JE(r.uri)){const{message:a}=z("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw s.setError(Pt.malformed_pairing_uri),new Error(a)}const o=oh(r==null?void 0:r.uri);if(!((n=o==null?void 0:o.relay)!=null&&n.protocol)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Pt.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=z("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Pt.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&M.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError(Pt.pairing_expired);const{message:a}=z("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),J(this,"isValidPing",async r=>{if(!Ve(r)){const{message:n}=z("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:s}=r;await this.isValidPairingTopic(s)}),J(this,"isValidDisconnect",async r=>{if(!Ve(r)){const{message:n}=z("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:s}=r;await this.isValidPairingTopic(s)}),J(this,"isValidPairingTopic",async r=>{if(!ge(r,!1)){const{message:s}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.pairings.keys.includes(r)){const{message:s}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if(Yt(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:s}=z("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}}),this.core=e,this.logger=qe(i,this.name),this.pairings=new Si(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ze(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(fe.message,async e=>{const{topic:i,message:r,transportType:s}=e;if(this.pairings.keys.includes(i)&&s!==he.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{const n=await this.core.crypto.decode(i,r);oa(n)?(this.core.history.set(i,n),await this.onRelayEventRequest({topic:i,payload:n})):Qs(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:i,payload:n}),this.core.history.delete(i,n.id)),await this.core.relayer.messages.ack(i,r)}catch(n){this.logger.error(n)}})}registerExpirerEvents(){this.core.expirer.on(st.expired,async e=>{const{topic:i}=Tu(e.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit(ui.expire,{topic:i}))})}}var fI=Object.defineProperty,dI=(t,e,i)=>e in t?fI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Oe=(t,e,i)=>dI(t,typeof e!="symbol"?e+"":e,i);class pI extends jp{constructor(e,i){super(e,i),this.core=e,this.logger=i,Oe(this,"records",new Map),Oe(this,"events",new wt.EventEmitter),Oe(this,"name",g3),Oe(this,"version",y3),Oe(this,"cached",[]),Oe(this,"initialized",!1),Oe(this,"storagePrefix",St),Oe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Oe(this,"set",(r,s,n)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:s,chainId:n}),this.records.has(s.id))return;const o={id:s.id,topic:r,request:{method:s.method,params:s.params||null},chainId:n,expiry:we(M.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(ft.created,o)}),Oe(this,"resolve",async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const s=await this.getRecord(r.id);typeof s.response>"u"&&(s.response=ot(r)?{error:r.error}:{result:r.result},this.records.set(s.id,s),this.persist(),this.events.emit(ft.updated,s))}),Oe(this,"get",async(r,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:s}),await this.getRecord(s))),Oe(this,"delete",(r,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(n=>{if(n.topic===r){if(typeof s<"u"&&n.id!==s)return;this.records.delete(n.id),this.events.emit(ft.deleted,n)}}),this.persist()}),Oe(this,"exists",async(r,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===r:!1)),Oe(this,"on",(r,s)=>{this.events.on(r,s)}),Oe(this,"once",(r,s)=>{this.events.once(r,s)}),Oe(this,"off",(r,s)=>{this.events.off(r,s)}),Oe(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),this.logger=qe(i,this.name)}get context(){return Ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const r={topic:i.topic,request:Ct(i.request.method,i.request.params,i.id),chainId:i.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const i=this.records.get(e);if(!i){const{message:r}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ft.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:i}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(ft.created,e=>{const i=ft.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.events.on(ft.updated,e=>{const i=ft.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.events.on(ft.deleted,e=>{const i=ft.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:e})}),this.core.heartbeat.on(_i.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(i=>{M.toMiliseconds(i.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${i.id}`),this.records.delete(i.id),this.events.emit(ft.deleted,i,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var gI=Object.defineProperty,yI=(t,e,i)=>e in t?gI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ke=(t,e,i)=>yI(t,typeof e!="symbol"?e+"":e,i);class wI extends Gp{constructor(e,i){super(e,i),this.core=e,this.logger=i,ke(this,"expirations",new Map),ke(this,"events",new wt.EventEmitter),ke(this,"name",w3),ke(this,"version",b3),ke(this,"cached",[]),ke(this,"initialized",!1),ke(this,"storagePrefix",St),ke(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ke(this,"has",r=>{try{const s=this.formatTarget(r);return typeof this.getExpiration(s)<"u"}catch{return!1}}),ke(this,"set",(r,s)=>{this.isInitialized();const n=this.formatTarget(r),o={target:n,expiry:s};this.expirations.set(n,o),this.checkExpiry(n,o),this.events.emit(st.created,{target:n,expiration:o})}),ke(this,"get",r=>{this.isInitialized();const s=this.formatTarget(r);return this.getExpiration(s)}),ke(this,"del",r=>{if(this.isInitialized(),this.has(r)){const s=this.formatTarget(r),n=this.getExpiration(s);this.expirations.delete(s),this.events.emit(st.deleted,{target:s,expiration:n})}}),ke(this,"on",(r,s)=>{this.events.on(r,s)}),ke(this,"once",(r,s)=>{this.events.once(r,s)}),ke(this,"off",(r,s)=>{this.events.off(r,s)}),ke(this,"removeListener",(r,s)=>{this.events.removeListener(r,s)}),this.logger=qe(i,this.name)}get context(){return Ze(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return C1(e);if(typeof e=="number")return U1(e);const{message:i}=z("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(i)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(st.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:i}=z("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const i=this.expirations.get(e);if(!i){const{message:r}=z("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return i}checkExpiry(e,i){const{expiry:r}=i;M.toMiliseconds(r)-Date.now()<=0&&this.expire(e,i)}expire(e,i){this.expirations.delete(e),this.events.emit(st.expired,{target:e,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,i)=>this.checkExpiry(i,e))}registerEventListeners(){this.core.heartbeat.on(_i.pulse,()=>this.checkExpirations()),this.events.on(st.created,e=>{const i=st.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(st.expired,e=>{const i=st.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()}),this.events.on(st.deleted,e=>{const i=st.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}}var bI=Object.defineProperty,mI=(t,e,i)=>e in t?bI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,pe=(t,e,i)=>mI(t,typeof e!="symbol"?e+"":e,i);class vI extends Yp{constructor(e,i,r){super(e,i,r),this.core=e,this.logger=i,this.store=r,pe(this,"name",m3),pe(this,"abortController"),pe(this,"isDevEnv"),pe(this,"verifyUrlV3",E3),pe(this,"storagePrefix",St),pe(this,"version",$f),pe(this,"publicKey"),pe(this,"fetchPromise"),pe(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&M.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),pe(this,"register",async s=>{if(!Hi()||this.isDevEnv)return;const n=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${n}&id=${o}&decryptedId=${a}`;try{const h=wi(),l=this.startAbortTimer(M.ONE_SECOND*5),u=await new Promise((f,p)=>{const d=()=>{window.removeEventListener("message",y),h.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",d);const g=h.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",d,{signal:this.abortController.signal});const y=v=>{if(v.data&&typeof v.data=="string")try{const E=JSON.parse(v.data);if(E.type==="verify_attestation"){if(Hn(E.attestation).payload.id!==o)return;clearInterval(l),h.body.removeChild(g),this.abortController.signal.removeEventListener("abort",d),window.removeEventListener("message",y),f(E.attestation===null?"":E.attestation)}}catch(E){this.logger.warn(E)}};h.body.appendChild(g),window.addEventListener("message",y,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",u),u}catch(h){this.logger.warn(h)}return""}),pe(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:n,hash:o,encryptedId:a}=s;if(n===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(n){if(Hn(n).payload.id!==a)return;const h=await this.isValidJwtAttestation(n);if(h){if(!h.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return h}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),pe(this,"fetchAttestation",async(s,n)=>{this.logger.debug(`resolving attestation: ${s} from url: ${n}`);const o=this.startAbortTimer(M.ONE_SECOND*5),a=await fetch(`${n}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),pe(this,"getVerifyUrl",s=>{let n=s||xr;return _3.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${xr}`),n=xr),n}),pe(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(M.FIVE_SECONDS),n=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await n.json()}catch(s){this.logger.warn(s)}}),pe(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),pe(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),pe(this,"isValidJwtAttestation",async s=>{const n=await this.getPublicKey();try{if(n)return this.validateAttestation(s,n)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),pe(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),pe(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async n=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),n(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),pe(this,"validateAttestation",(s,n)=>{const o=OE(s,n.publicKey),a={hasExpired:M.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=qe(i,this.name),this.abortController=new AbortController,this.isDevEnv=Ho(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Ze(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),M.toMiliseconds(e))}}var EI=Object.defineProperty,_I=(t,e,i)=>e in t?EI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,zh=(t,e,i)=>_I(t,typeof e!="symbol"?e+"":e,i);class xI extends Jp{constructor(e,i){super(e,i),this.projectId=e,this.logger=i,zh(this,"context",x3),zh(this,"registerDeviceToken",async r=>{const{clientId:s,token:n,notificationType:o,enableEncrypted:a=!1}=r,c=`${I3}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:n,always_raw:a})})}),this.logger=qe(i,this.context)}}var II=Object.defineProperty,qh=Object.getOwnPropertySymbols,SI=Object.prototype.hasOwnProperty,DI=Object.prototype.propertyIsEnumerable,_o=(t,e,i)=>e in t?II(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,fr=(t,e)=>{for(var i in e||(e={}))SI.call(e,i)&&_o(t,i,e[i]);if(qh)for(var i of qh(e))DI.call(e,i)&&_o(t,i,e[i]);return t},me=(t,e,i)=>_o(t,typeof e!="symbol"?e+"":e,i);class $I extends Zp{constructor(e,i,r=!0){super(e,i,r),this.core=e,this.logger=i,me(this,"context",D3),me(this,"storagePrefix",St),me(this,"storageVersion",S3),me(this,"events",new Map),me(this,"shouldPersist",!1),me(this,"init",async()=>{if(!Ho())try{const s={eventId:Oc(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:Ou(this.core.relayer.protocol,this.core.relayer.version,po)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),me(this,"createEvent",s=>{const{event:n="ERROR",type:o="",properties:{topic:a,trace:c}}=s,h=Oc(),l=this.core.projectId||"",u=Date.now(),f=fr({eventId:h,timestamp:u,props:{event:n,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(h));return this.telemetryEnabled&&(this.events.set(h,f),this.shouldPersist=!0),f}),me(this,"getEvent",s=>{const{eventId:n,topic:o}=s;if(n)return this.events.get(n);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return fr(fr({},a),this.setMethods(a.eventId))}),me(this,"deleteEvent",s=>{const{eventId:n}=s;this.events.delete(n),this.shouldPersist=!0}),me(this,"setEventListeners",()=>{this.core.heartbeat.on(_i.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{M.fromMiliseconds(Date.now())-M.fromMiliseconds(s.timestamp)>$3&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),me(this,"setMethods",s=>({addTrace:n=>this.addTrace(s,n),setError:n=>this.setError(s,n)})),me(this,"addTrace",(s,n)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(n),this.events.set(s,o),this.shouldPersist=!0)}),me(this,"setError",(s,n)=>{const o=this.events.get(s);o&&(o.props.type=n,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),me(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),me(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(n=>{this.events.set(n.eventId,fr(fr({},n),this.setMethods(n.eventId)))})}catch(s){this.logger.warn(s)}}),me(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[n,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const n of s)this.events.delete(n.eventId),this.shouldPersist=!0}catch(n){this.logger.warn(n)}}),me(this,"sendEvent",async s=>{const n=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${O3}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${po}${n}`,{method:"POST",body:JSON.stringify(s)})}),me(this,"getAppDomain",()=>$u().url),this.logger=qe(i,this.context),this.telemetryEnabled=r,r?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var OI=Object.defineProperty,jh=Object.getOwnPropertySymbols,AI=Object.prototype.hasOwnProperty,TI=Object.prototype.propertyIsEnumerable,xo=(t,e,i)=>e in t?OI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Fh=(t,e)=>{for(var i in e||(e={}))AI.call(e,i)&&xo(t,i,e[i]);if(jh)for(var i of jh(e))TI.call(e,i)&&xo(t,i,e[i]);return t},ae=(t,e,i)=>xo(t,typeof e!="symbol"?e+"":e,i);class aa extends Lp{constructor(e){var i;super(e),ae(this,"protocol",Df),ae(this,"version",$f),ae(this,"name",ks),ae(this,"relayUrl"),ae(this,"projectId"),ae(this,"customStoragePrefix"),ae(this,"events",new wt.EventEmitter),ae(this,"logger"),ae(this,"heartbeat"),ae(this,"relayer"),ae(this,"crypto"),ae(this,"storage"),ae(this,"history"),ae(this,"expirer"),ae(this,"pairing"),ae(this,"verify"),ae(this,"echoClient"),ae(this,"linkModeSupportedApps"),ae(this,"eventClient"),ae(this,"initialized",!1),ae(this,"logChunkController"),ae(this,"on",(a,c)=>this.events.on(a,c)),ae(this,"once",(a,c)=>this.events.once(a,c)),ae(this,"off",(a,c)=>this.events.off(a,c)),ae(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ae(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:h})=>{if(!a||!c)return;const l={topic:a,message:c,publishedAt:Date.now(),transportType:he.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:h})});const r=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Af,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=To({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:Y_.logger,name:ks}),{logger:n,chunkLoggerController:o}=Rp({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(i=this.logChunkController)!=null&&i.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=qe(n,this.name),this.heartbeat=new Id,this.crypto=new s8(this,this.logger,e==null?void 0:e.keychain),this.history=new pI(this,this.logger),this.expirer=new wI(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new op(Fh(Fh({},J_),e==null?void 0:e.storageOptions)),this.relayer=new P8({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new uI(this,this.logger),this.verify=new vI(this,this.logger,this.storage),this.echoClient=new xI(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new $I(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const i=new aa(e);await i.initialize();const r=await i.crypto.getClientId();return await i.storage.setItem(l3,r),i}get context(){return Ze(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Eh,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Eh)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const i=`_walletConnectCore_${e}`,r=`${i}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[i]}catch(i){console.warn("Failed to get global WalletConnect core",i);return}}setGlobalCore(e){var i;try{if(this.isGlobalCoreDisabled())return;const r=`_walletConnectCore_${((i=e.opts)==null?void 0:i.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&G_.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}}const PI=aa,ca="wc",ha=2,la="client",tn=`${ca}@${ha}:${la}:`,ms={name:la,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"},Io="WALLETCONNECT_DEEPLINK_CHOICE",jf="proposal",So="Proposal expired",Ff="session",hi=M.SEVEN_DAYS,Kf="engine",Ee={wc_sessionPropose:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1104},res:{ttl:M.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1106},res:{ttl:M.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:M.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1112},res:{ttl:M.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:M.ONE_DAY,prompt:!1,tag:1114},res:{ttl:M.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:M.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:M.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:M.FIVE_MINUTES,prompt:!1,tag:1119}}},vs={min:M.FIVE_MINUTES,max:M.SEVEN_DAYS},pt={idle:"IDLE",active:"ACTIVE"},Vf={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},Hf="request",Wf=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],Gf="wc",Yf="auth",Jf="authKeys",Zf="pairingTopics",Xf="requests",Vr=`${Gf}@${1.5}:${Yf}:`,Sr=`${Vr}:PUB_KEY`;var CI=Object.defineProperty,UI=Object.defineProperties,NI=Object.getOwnPropertyDescriptors,Kh=Object.getOwnPropertySymbols,RI=Object.prototype.hasOwnProperty,BI=Object.prototype.propertyIsEnumerable,Do=(t,e,i)=>e in t?CI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,se=(t,e)=>{for(var i in e||(e={}))RI.call(e,i)&&Do(t,i,e[i]);if(Kh)for(var i of Kh(e))BI.call(e,i)&&Do(t,i,e[i]);return t},Le=(t,e)=>UI(t,NI(e)),N=(t,e,i)=>Do(t,typeof e!="symbol"?e+"":e,i);class kI extends tg{constructor(e){super(e),N(this,"name",Kf),N(this,"events",new el),N(this,"initialized",!1),N(this,"requestQueue",{state:pt.idle,queue:[]}),N(this,"sessionRequestQueue",{state:pt.idle,queue:[]}),N(this,"emittedSessionRequests",new j1({limit:500})),N(this,"requestQueueDelay",M.ONE_SECOND),N(this,"expectedPairingMethodMap",new Map),N(this,"recentlyDeletedMap",new Map),N(this,"recentlyDeletedLimit",200),N(this,"relayMessageCache",[]),N(this,"pendingSessions",new Map),N(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ee)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay)))}),N(this,"connect",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const r=Le(se({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(r),r.optionalNamespaces=VE(r.requiredNamespaces,r.optionalNamespaces),r.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:h}=r;let l=s,u,f=!1;try{if(l){const U=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=U.active}}catch(U){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),U}if(!l||!f){const{topic:U,uri:B}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=U,u=B}if(!l){const{message:U}=z("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(U)}const p=await this.client.core.crypto.generateKeyPair(),d=Ee.wc_sessionPropose.req.ttl||M.FIVE_MINUTES,g=we(d),y=Le(se(se({requiredNamespaces:n,optionalNamespaces:o,relays:h??[{protocol:Of}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Bt()}),v=re("session_connect",y.id),{reject:E,resolve:b,done:O}=ci(d,So),I=({id:U})=>{U===y.id&&(this.client.events.off("proposal_expire",I),this.pendingSessions.delete(y.id),this.events.emit(v,{error:{message:So,code:0}}))};return this.client.events.on("proposal_expire",I),this.events.once(v,({error:U,session:B})=>{this.client.events.off("proposal_expire",I),U?E(U):B&&b(B)}),await this.sendProposeSession({proposal:y,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:y.id}}}),await this.setProposal(y.id,y),{uri:u,approval:O}}),N(this,"pair",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(i)}catch(r){throw this.client.logger.error("pair() failed"),r}}),N(this,"approve",async i=>{var r,s,n;const o=this.client.core.eventClient.createEvent({properties:{topic:(r=i==null?void 0:i.id)==null?void 0:r.toString(),trace:[Gt.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(w){throw o.setError(hr.no_internet_connection),w}try{await this.isValidProposalId(i==null?void 0:i.id)}catch(w){throw this.client.logger.error(`approve() -> proposal.get(${i==null?void 0:i.id}) failed`),o.setError(hr.proposal_not_found),w}try{await this.isValidApprove(i)}catch(w){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(hr.session_approve_namespace_validation_failure),w}const{id:a,relayProtocol:c,namespaces:h,sessionProperties:l,scopedProperties:u,sessionConfig:f}=i,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:d,proposer:g,requiredNamespaces:y,optionalNamespaces:v}=p;let E=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:d});E||(E=(n=this.client.core.eventClient)==null?void 0:n.createEvent({type:Gt.session_approve_started,properties:{topic:d,trace:[Gt.session_approve_started,Gt.session_namespaces_validation_success]}}));const b=await this.client.core.crypto.generateKeyPair(),O=g.publicKey,I=await this.client.core.crypto.generateSharedKey(b,O),U=se(se(se({relay:{protocol:c??"irn"},namespaces:h,controller:{publicKey:b,metadata:this.client.metadata},expiry:we(hi)},l&&{sessionProperties:l}),u&&{scopedProperties:u}),f&&{sessionConfig:f}),B=he.relay;E.addTrace(Gt.subscribing_session_topic);try{await this.client.core.relayer.subscribe(I,{transportType:B,internal:{skipSubscribe:!0}})}catch(w){throw E.setError(hr.subscribe_session_topic_failure),w}E.addTrace(Gt.subscribe_session_topic_success);const P=Le(se({},U),{topic:I,requiredNamespaces:y,optionalNamespaces:v,pairingTopic:d,acknowledged:!1,self:U.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:b,transportType:he.relay});await this.client.session.set(I,P),E.addTrace(Gt.store_session);try{await this.sendApproveSession({sessionTopic:I,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:b},sessionSettleRequest:U,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),E.addTrace(Gt.session_approve_publish_success)}catch(w){throw this.client.logger.error(w),this.client.session.delete(I,le("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(I),w}return this.client.core.eventClient.deleteEvent({eventId:E.eventId}),await this.client.core.pairing.updateMetadata({topic:d,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:d}),await this.setExpiry(I,we(hi)),{topic:I,acknowledged:()=>Promise.resolve(this.client.session.get(I))}}),N(this,"reject",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(i)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:r,reason:s}=i;let n;try{n=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}n&&await this.sendError({id:r,topic:n,error:s,rpcOpts:Ee.wc_sessionPropose.reject}),await this.deleteProposal(r)}),N(this,"update",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(i)}catch(u){throw this.client.logger.error("update() -> isValidUpdate() failed"),u}const{topic:r,namespaces:s}=i,{done:n,resolve:o,reject:a}=ci(),c=Bt(),h=ei().toString(),l=this.client.session.get(r).namespaces;return this.events.once(re("session_update",c),({error:u})=>{u?a(u):o()}),await this.client.session.update(r,{namespaces:s}),await this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:h}).catch(u=>{this.client.logger.error(u),this.client.session.update(r,{namespaces:l}),a(u)}),{acknowledged:n}}),N(this,"extend",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(i)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:r}=i,s=Bt(),{done:n,resolve:o,reject:a}=ci();return this.events.once(re("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(r,we(hi)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:n}}),N(this,"request",async i=>{this.isInitialized();try{await this.isValidRequest(i)}catch(y){throw this.client.logger.error("request() -> isValidRequest() failed"),y}const{chainId:r,request:s,topic:n,expiry:o=Ee.wc_sessionRequest.req.ttl}=i,a=this.client.session.get(n);(a==null?void 0:a.transportType)===he.relay&&await this.confirmOnlineStateOrThrow();const c=Bt(),h=ei().toString(),{done:l,resolve:u,reject:f}=ci(o,"Request expired. Please try again.");this.events.once(re("session_request",c),({error:y,result:v})=>{y?f(y):u(v)});const p="wc_sessionRequest",d=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(d)return await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:p,params:{request:Le(se({},s),{expiryTimestamp:we(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:d}).catch(y=>f(y)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:r,id:c}),await l();const g={request:Le(se({},s),{expiryTimestamp:we(o)}),chainId:r};return await Promise.all([new Promise(async y=>{await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:n,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(v=>f(v)),this.client.events.emit("session_request_sent",{topic:n,request:s,chainId:r,id:c}),y()}),new Promise(async y=>{var v;if(!((v=a.sessionConfig)!=null&&v.disableDeepLink)){const E=await k1(this.client.core.storage,Io);await N1({id:c,topic:n,wcDeepLink:E})}y()}),l()]).then(y=>y[2])}),N(this,"respond",async i=>{this.isInitialized(),await this.isValidRespond(i);const{topic:r,response:s}=i,{id:n}=s,o=this.client.session.get(r);o.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);_t(s)?await this.sendResult({id:n,topic:r,result:s.result,throwOnFailedPublish:!0,appLink:a}):ot(s)&&await this.sendError({id:n,topic:r,error:s.error,appLink:a}),this.cleanupAfterResponse(i)}),N(this,"ping",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(i)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:r}=i;if(this.client.session.keys.includes(r)){const s=Bt(),n=ei().toString(),{done:o,resolve:a,reject:c}=ci();this.events.once(re("session_ping",s),({error:h})=>{h?c(h):a()}),await Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:n}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:r}))}),N(this,"emit",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(i);const{topic:r,event:s,chainId:n}=i,o=ei().toString(),a=Bt();await this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:s,chainId:n},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),N(this,"disconnect",async i=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(i);const{topic:r}=i;if(this.client.session.keys.includes(r))await this.sendRequest({topic:r,method:"wc_sessionDelete",params:le("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))await this.client.core.pairing.disconnect({topic:r});else{const{message:s}=z("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(s)}}),N(this,"find",i=>(this.isInitialized(),this.client.session.getAll().filter(r=>GE(r,i)))),N(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),N(this,"authenticate",async(i,r)=>{var s;this.isInitialized(),this.isValidAuthenticate(i);const n=r&&this.client.core.linkModeSupportedApps.includes(r)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=n?he.link_mode:he.relay;o===he.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:h,domain:l,nonce:u,type:f,exp:p,nbf:d,methods:g=[],expiry:y}=i,v=[...i.resources||[]],{topic:E,uri:b}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:E,uri:b}});const O=await this.client.core.crypto.generateKeyPair(),I=ws(O);if(await Promise.all([this.client.auth.authKeys.set(Sr,{responseTopic:I,publicKey:O}),this.client.auth.pairingTopics.set(I,{topic:I,pairingTopic:E})]),await this.client.core.relayer.subscribe(I,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${E}`),g.length>0){const{namespace:$}=gs(a[0]);let R=Q2($,"request",g);ys(v)&&(R=tv(R,v.pop())),v.push(R)}const U=y&&y>Ee.wc_sessionAuthenticate.req.ttl?y:Ee.wc_sessionAuthenticate.req.ttl,B={authPayload:{type:f??"caip122",chains:a,statement:c,aud:h,domain:l,version:"1",nonce:u,iat:new Date().toISOString(),exp:p,nbf:d,resources:v},requester:{publicKey:O,metadata:this.client.metadata},expiryTimestamp:we(U)},P={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},w={requiredNamespaces:{},optionalNamespaces:P,relays:[{protocol:"irn"}],pairingTopic:E,proposer:{publicKey:O,metadata:this.client.metadata},expiryTimestamp:we(Ee.wc_sessionPropose.req.ttl),id:Bt()},{done:A,resolve:_,reject:D}=ci(U,"Request expired"),C=Bt(),L=re("session_connect",w.id),x=re("session_request",C),m=async({error:$,session:R})=>{this.events.off(x,S),$?D($):R&&_({session:R})},S=async $=>{var R,k,j;if(await this.deletePendingAuthRequest(C,{message:"fulfilled",code:0}),$.error){const Y=le("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return $.error.code===Y.code?void 0:(this.events.off(L,m),D($.error.message))}await this.deleteProposal(w.id),this.events.off(L,m);const{cacaos:F,responder:K}=$.result,V=[],H=[];for(const Y of F){await Mc({cacao:Y,projectId:this.client.core.projectId})||(this.client.logger.error(Y,"Signature verification failed"),D(le("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:ue}=Y,Ie=ys(ue.resources),si=[io(ue.iss)],Hr=Cs(ue.iss);if(Ie){const Di=zc(Ie),sn=qc(Ie);V.push(...Di),si.push(...sn)}for(const Di of si)H.push(`${Di}:${Hr}`)}const ie=await this.client.core.crypto.generateSharedKey(O,K.publicKey);let te;V.length>0&&(te={topic:ie,acknowledged:!0,self:{publicKey:O,metadata:this.client.metadata},peer:K,controller:K.publicKey,expiry:we(hi),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:E,namespaces:uh([...new Set(V)],[...new Set(H)]),transportType:o},await this.client.core.relayer.subscribe(ie,{transportType:o}),await this.client.session.set(ie,te),E&&await this.client.core.pairing.updateMetadata({topic:E,metadata:K.metadata}),te=this.client.session.get(ie)),(R=this.client.metadata.redirect)!=null&&R.linkMode&&(k=K.metadata.redirect)!=null&&k.linkMode&&(j=K.metadata.redirect)!=null&&j.universal&&r&&(this.client.core.addLinkModeSupportedApp(K.metadata.redirect.universal),this.client.session.update(ie,{transportType:he.link_mode})),_({auths:F,session:te})};this.events.once(L,m),this.events.once(x,S);let T;try{if(n){const $=Ct("wc_sessionAuthenticate",B,C);this.client.core.history.set(E,$);const R=await this.client.core.crypto.encode("",$,{type:Fr,encoding:Qt});T=hs(r,E,R)}else await Promise.all([this.sendRequest({topic:E,method:"wc_sessionAuthenticate",params:B,expiry:i.expiry,throwOnFailedPublish:!0,clientRpcId:C}),this.sendRequest({topic:E,method:"wc_sessionPropose",params:w,expiry:Ee.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:w.id})])}catch($){throw this.events.off(L,m),this.events.off(x,S),$}return await this.setProposal(w.id,w),await this.setAuthRequest(C,{request:Le(se({},B),{verifyContext:{}}),pairingTopic:E,transportType:o}),{uri:T??b,response:A}}),N(this,"approveSessionAuthenticate",async i=>{const{id:r,auths:s}=i,n=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[ai.authenticated_session_approve_started]}});try{this.isInitialized()}catch(y){throw n.setError(lr.no_internet_connection),y}const o=this.getPendingAuthRequest(r);if(!o)throw n.setError(lr.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);const a=o.transportType||he.relay;a===he.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),l=ws(c),u={type:Nt,receiverPublicKey:c,senderPublicKey:h},f=[],p=[];for(const y of s){if(!await Mc({cacao:y,projectId:this.client.core.projectId})){n.setError(lr.invalid_cacao);const I=le("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:r,topic:l,error:I,encodeOpts:u}),new Error(I.message)}n.addTrace(ai.cacaos_verified);const{p:v}=y,E=ys(v.resources),b=[io(v.iss)],O=Cs(v.iss);if(E){const I=zc(E),U=qc(E);f.push(...I),b.push(...U)}for(const I of b)p.push(`${I}:${O}`)}const d=await this.client.core.crypto.generateSharedKey(h,c);n.addTrace(ai.create_authenticated_session_topic);let g;if((f==null?void 0:f.length)>0){g={topic:d,acknowledged:!0,self:{publicKey:h,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:we(hi),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:uh([...new Set(f)],[...new Set(p)]),transportType:a},n.addTrace(ai.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(d,{transportType:a})}catch(y){throw n.setError(lr.subscribe_authenticated_session_topic_failure),y}n.addTrace(ai.subscribe_authenticated_session_topic_success),await this.client.session.set(d,g),n.addTrace(ai.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}n.addTrace(ai.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:r,result:{cacaos:s,responder:{publicKey:h,metadata:this.client.metadata}},encodeOpts:u,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(y){throw n.setError(lr.authenticated_session_approve_publish_failure),y}return await this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:n.eventId}),{session:g}}),N(this,"rejectSessionAuthenticate",async i=>{this.isInitialized();const{id:r,reason:s}=i,n=this.getPendingAuthRequest(r);if(!n)throw new Error(`Could not find pending auth request with id ${r}`);n.transportType===he.relay&&await this.confirmOnlineStateOrThrow();const o=n.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=ws(o),h={type:Nt,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:r,topic:c,error:s,encodeOpts:h,rpcOpts:Ee.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(n.requester.metadata,n.transportType)}),await this.client.auth.requests.delete(r,{message:"rejected",code:0}),await this.deleteProposal(r)}),N(this,"formatAuthMessage",i=>{this.isInitialized();const{request:r,iss:s}=i;return Vu(r,s)}),N(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const i=this.relayMessageCache.shift();i&&await this.onRelayMessage(i)}catch(i){this.client.logger.error(i)}},50)}),N(this,"cleanupDuplicatePairings",async i=>{if(i.pairingTopic)try{const r=this.client.core.pairing.pairings.get(i.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(n=>{var o,a;return((o=n.peerMetadata)==null?void 0:o.url)&&((a=n.peerMetadata)==null?void 0:a.url)===i.peer.metadata.url&&n.topic&&n.topic!==r.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(n=>this.client.core.pairing.disconnect({topic:n.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}}),N(this,"deleteSession",async i=>{var r;const{topic:s,expirerHasDeleted:n=!1,emitEvent:o=!0,id:a=0}=i,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,le("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),n||this.client.core.expirer.del(s),this.client.core.storage.removeItem(Io).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===s&&this.deletePendingSessionRequest(h.id,le("USER_DISCONNECTED"))}),s===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=pt.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),N(this,"deleteProposal",async(i,r)=>{if(r)try{const s=this.client.proposal.get(i),n=this.client.core.eventClient.getEvent({topic:s.pairingTopic});n==null||n.setError(hr.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(i,le("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"proposal")}),N(this,"deletePendingSessionRequest",async(i,r,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,r),s?Promise.resolve():this.client.core.expirer.del(i)]),this.addToRecentlyDeleted(i,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(n=>n.id!==i),s&&(this.sessionRequestQueue.state=pt.idle,this.client.events.emit("session_request_expire",{id:i}))}),N(this,"deletePendingAuthRequest",async(i,r,s=!1)=>{await Promise.all([this.client.auth.requests.delete(i,r),s?Promise.resolve():this.client.core.expirer.del(i)])}),N(this,"setExpiry",async(i,r)=>{this.client.session.keys.includes(i)&&(this.client.core.expirer.set(i,r),await this.client.session.update(i,{expiry:r}))}),N(this,"setProposal",async(i,r)=>{this.client.core.expirer.set(i,we(Ee.wc_sessionPropose.req.ttl)),await this.client.proposal.set(i,r)}),N(this,"setAuthRequest",async(i,r)=>{const{request:s,pairingTopic:n,transportType:o=he.relay}=r;this.client.core.expirer.set(i,s.expiryTimestamp),await this.client.auth.requests.set(i,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:i,pairingTopic:n,verifyContext:s.verifyContext,transportType:o})}),N(this,"setPendingSessionRequest",async i=>{const{id:r,topic:s,params:n,verifyContext:o}=i,a=n.request.expiryTimestamp||we(Ee.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),await this.client.pendingRequest.set(r,{id:r,topic:s,params:n,verifyContext:o})}),N(this,"sendRequest",async i=>{const{topic:r,method:s,params:n,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:h,appLink:l,tvf:u,publishOpts:f={}}=i,p=Ct(s,n,c);let d;const g=!!l;try{const E=g?Qt:Ge;d=await this.client.core.crypto.encode(r,p,{encoding:E})}catch(E){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),E}let y;if(Wf.includes(s)){const E=nt(JSON.stringify(p)),b=nt(d);y=await this.client.core.verify.register({id:b,decryptedId:E})}const v=se(se({},Ee[s].req),f);if(v.attestation=y,o&&(v.ttl=o),a&&(v.id=a),this.client.core.history.set(r,p),g){const E=hs(l,r,d);await globalThis.Linking.openURL(E,this.client.name)}else v.tvf=Le(se({},u),{correlationId:p.id}),h?(v.internal=Le(se({},v.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(r,d,v)):this.client.core.relayer.publish(r,d,v).catch(E=>this.client.logger.error(E));return p.id}),N(this,"sendProposeSession",async i=>{const{proposal:r,publishOpts:s}=i,n=Ct("wc_sessionPropose",r,r.id);this.client.core.history.set(r.pairingTopic,n);const o=await this.client.core.crypto.encode(r.pairingTopic,n,{encoding:Ge}),a=nt(JSON.stringify(n)),c=nt(o),h=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:r.pairingTopic,sessionProposal:o},opts:Le(se({},s),{publishMethod:"wc_proposeSession",attestation:h})})}),N(this,"sendApproveSession",async i=>{const{sessionTopic:r,pairingProposalResponse:s,proposal:n,sessionSettleRequest:o,publishOpts:a}=i,c=Es(n.id,s),h=await this.client.core.crypto.encode(n.pairingTopic,c,{encoding:Ge}),l=Ct("wc_sessionSettle",o,a==null?void 0:a.id),u=await this.client.core.crypto.encode(r,l,{encoding:Ge});this.client.core.history.set(r,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:r,pairingTopic:n.pairingTopic,sessionProposalResponse:h,sessionSettlementRequest:u},opts:Le(se({},a),{publishMethod:"wc_approveSession"})})}),N(this,"sendResult",async i=>{const{id:r,topic:s,result:n,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=i,h=Es(r,n);let l;const u=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const d=u?Qt:Ge;l=await this.client.core.crypto.encode(s,h,Le(se({},a||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),d}let f,p;try{f=await this.client.core.history.get(s,r);const d=f.request;try{p=this.getTVFParams(r,d.params,n)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(d){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${r}) failed`),d}if(u){const d=hs(c,s,l);await globalThis.Linking.openURL(d,this.client.name)}else{const d=f.request.method,g=Ee[d].res;g.tvf=Le(se({},p),{correlationId:r}),o?(g.internal=Le(se({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,l,g)):this.client.core.relayer.publish(s,l,g).catch(y=>this.client.logger.error(y))}await this.client.core.history.resolve(h)}),N(this,"sendError",async i=>{const{id:r,topic:s,error:n,encodeOpts:o,rpcOpts:a,appLink:c}=i,h=$o(r,n);let l;const u=c&&typeof(globalThis==null?void 0:globalThis.Linking)<"u";try{const p=u?Qt:Ge;l=await this.client.core.crypto.encode(s,h,Le(se({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),p}let f;try{f=await this.client.core.history.get(s,r)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${s}, ${r}) failed`),p}if(u){const p=hs(c,s,l);await globalThis.Linking.openURL(p,this.client.name)}else{const p=f.request.method,d=a||Ee[p].res;this.client.core.relayer.publish(s,l,d)}await this.client.core.history.resolve(h)}),N(this,"cleanup",async()=>{const i=[],r=[];this.client.session.getAll().forEach(s=>{let n=!1;Yt(s.expiry)&&(n=!0),this.client.core.crypto.keychain.has(s.topic)||(n=!0),n&&i.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{Yt(s.expiryTimestamp)&&r.push(s.id)}),await Promise.all([...i.map(s=>this.deleteSession({topic:s})),...r.map(s=>this.deleteProposal(s))])}),N(this,"onProviderMessageEvent",async i=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(i):await this.onRelayMessage(i)}),N(this,"onRelayEventRequest",async i=>{this.requestQueue.queue.push(i),await this.processRequestsQueue()}),N(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===pt.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=pt.active;const i=this.requestQueue.queue.shift();if(i)try{await this.processRequest(i)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=pt.idle}),N(this,"processRequest",async i=>{const{topic:r,payload:s,attestation:n,transportType:o,encryptedId:a}=i,c=s.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:r,payload:s,attestation:n,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(r,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(r,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(r,s);case"wc_sessionPing":return await this.onSessionPingRequest(r,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(r,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:r,payload:s,attestation:n,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(r,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:r,payload:s,attestation:n,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),N(this,"onRelayEventResponse",async i=>{const{topic:r,payload:s,transportType:n}=i,o=(await this.client.core.history.get(r,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,s,n);case"wc_sessionSettle":return this.onSessionSettleResponse(r,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,s);case"wc_sessionExtend":return this.onSessionExtendResponse(r,s);case"wc_sessionPing":return this.onSessionPingResponse(r,s);case"wc_sessionRequest":return this.onSessionRequestResponse(r,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),N(this,"onRelayEventUnknownPayload",i=>{const{topic:r}=i,{message:s}=z("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),N(this,"shouldIgnorePairingRequest",i=>{const{topic:r,requestMethod:s}=i,n=this.expectedPairingMethodMap.get(r);return!n||n.includes(s)?!1:!!(n.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),N(this,"onSessionProposeRequest",async i=>{const{topic:r,payload:s,attestation:n,encryptedId:o}=i,{params:a,id:c}=s;try{const h=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),h==null||h.setError(Pt.proposal_listener_not_found)),this.isValidConnect(se({},s.params));const l=a.expiryTimestamp||we(Ee.wc_sessionPropose.req.ttl),u=se({id:c,pairingTopic:r,expiryTimestamp:l,attestation:n,encryptedId:o},a);await this.setProposal(c,u);const f=await this.getVerifyContext({attestationId:n,hash:nt(JSON.stringify(s)),encryptedId:o,metadata:u.proposer.metadata});h==null||h.addTrace(Et.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:u,verifyContext:f})}catch(h){await this.sendError({id:c,topic:r,error:h,rpcOpts:Ee.wc_sessionPropose.autoReject}),this.client.logger.error(h)}}),N(this,"onSessionProposeResponse",async(i,r,s)=>{const{id:n}=r;if(_t(r)){const{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const l=await this.client.core.crypto.generateSharedKey(c,h);this.pendingSessions.set(n,{sessionTopic:l,pairingTopic:i,proposalId:n,publicKey:c});const u=await this.client.core.relayer.subscribe(l,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:u}),await this.client.core.pairing.activate({topic:i})}else if(ot(r)){await this.deleteProposal(n);const o=re("session_connect",n);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}}),N(this,"onSessionSettleRequest",async(i,r)=>{const{id:s,params:n}=r;try{this.isValidSessionSettleRequest(n);const{relay:o,controller:a,expiry:c,namespaces:h,sessionProperties:l,scopedProperties:u,sessionConfig:f}=r.params,p=[...this.pendingSessions.values()].find(y=>y.sessionTopic===i);if(!p)return this.client.logger.error(`Pending session not found for topic ${i}`);const d=this.client.proposal.get(p.proposalId),g=Le(se(se(se({topic:i,relay:o,expiry:c,namespaces:h,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:d.requiredNamespaces,optionalNamespaces:d.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),u&&{scopedProperties:u}),f&&{sessionConfig:f}),{transportType:he.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(re("session_connect",p.proposalId),{session:g}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:r.id,topic:i,result:!0})}catch(o){await this.sendError({id:s,topic:i,error:o}),this.client.logger.error(o)}}),N(this,"onSessionSettleResponse",async(i,r)=>{const{id:s}=r;_t(r)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(re("session_approve",s),{})):ot(r)&&(await this.client.session.delete(i,le("USER_DISCONNECTED")),this.events.emit(re("session_approve",s),{error:r.error}))}),N(this,"onSessionUpdateRequest",async(i,r)=>{const{params:s,id:n}=r;try{const o=`${i}_session_update`,a=ar.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.warn(`Discarding out of sync request - ${n}`),this.sendError({id:n,topic:i,error:le("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(se({topic:i},s));try{ar.set(o,n),await this.client.session.update(i,{namespaces:s.namespaces}),await this.sendResult({id:n,topic:i,result:!0})}catch(c){throw ar.delete(o),c}this.client.events.emit("session_update",{id:n,topic:i,params:s})}catch(o){await this.sendError({id:n,topic:i,error:o}),this.client.logger.error(o)}}),N(this,"isRequestOutOfSync",(i,r)=>r.toString().slice(0,-3)<i.toString().slice(0,-3)),N(this,"onSessionUpdateResponse",(i,r)=>{const{id:s}=r,n=re("session_update",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);_t(r)?this.events.emit(re("session_update",s),{}):ot(r)&&this.events.emit(re("session_update",s),{error:r.error})}),N(this,"onSessionExtendRequest",async(i,r)=>{const{id:s}=r;try{this.isValidExtend({topic:i}),await this.setExpiry(i,we(hi)),await this.sendResult({id:s,topic:i,result:!0}),this.client.events.emit("session_extend",{id:s,topic:i})}catch(n){await this.sendError({id:s,topic:i,error:n}),this.client.logger.error(n)}}),N(this,"onSessionExtendResponse",(i,r)=>{const{id:s}=r,n=re("session_extend",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);_t(r)?this.events.emit(re("session_extend",s),{}):ot(r)&&this.events.emit(re("session_extend",s),{error:r.error})}),N(this,"onSessionPingRequest",async(i,r)=>{const{id:s}=r;try{this.isValidPing({topic:i}),await this.sendResult({id:s,topic:i,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:i})}catch(n){await this.sendError({id:s,topic:i,error:n}),this.client.logger.error(n)}}),N(this,"onSessionPingResponse",(i,r)=>{const{id:s}=r,n=re("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners 2176`);_t(r)?this.events.emit(re("session_ping",s),{}):ot(r)&&this.events.emit(re("session_ping",s),{error:r.error})},500)}),N(this,"onSessionDeleteRequest",async(i,r)=>{const{id:s}=r;try{this.isValidDisconnect({topic:i,reason:r.params}),await Promise.all([new Promise(n=>{this.client.core.relayer.once(fe.publish,async()=>{n(await this.deleteSession({topic:i,id:s}))})}),this.sendResult({id:s,topic:i,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:i,error:le("USER_DISCONNECTED")})]).catch(n=>this.client.logger.error(n))}catch(n){this.client.logger.error(n)}}),N(this,"onSessionRequest",async i=>{var r,s,n;const{topic:o,payload:a,attestation:c,encryptedId:h,transportType:l}=i,{id:u,params:f}=a;try{await this.isValidRequest(se({topic:o},f));const p=this.client.session.get(o),d=await this.getVerifyContext({attestationId:c,hash:nt(JSON.stringify(Ct("wc_sessionRequest",f,u))),encryptedId:h,metadata:p.peer.metadata,transportType:l}),g={id:u,topic:o,params:f,verifyContext:d};await this.setPendingSessionRequest(g),l===he.link_mode&&(r=p.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((s=p.peer.metadata.redirect)==null?void 0:s.universal),(n=this.client.signConfig)!=null&&n.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:u,topic:o,error:p}),this.client.logger.error(p)}}),N(this,"onSessionRequestResponse",(i,r)=>{const{id:s}=r,n=re("session_request",s);if(this.events.listenerCount(n)===0)throw new Error(`emitting ${n} without any listeners`);_t(r)?this.events.emit(re("session_request",s),{result:r.result}):ot(r)&&this.events.emit(re("session_request",s),{error:r.error})}),N(this,"onSessionEventRequest",async(i,r)=>{const{id:s,params:n}=r;try{const o=`${i}_session_event_${n.event.name}`,a=ar.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(se({topic:i},n)),this.client.events.emit("session_event",{id:s,topic:i,params:n}),ar.set(o,s)}catch(o){await this.sendError({id:s,topic:i,error:o}),this.client.logger.error(o)}}),N(this,"onSessionAuthenticateResponse",(i,r)=>{const{id:s}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:i,payload:r}),_t(r)?this.events.emit(re("session_request",s),{result:r.result}):ot(r)&&this.events.emit(re("session_request",s),{error:r.error})}),N(this,"onSessionAuthenticateRequest",async i=>{var r;const{topic:s,payload:n,attestation:o,encryptedId:a,transportType:c}=i;try{const{requester:h,authPayload:l,expiryTimestamp:u}=n.params,f=await this.getVerifyContext({attestationId:o,hash:nt(JSON.stringify(n)),encryptedId:a,metadata:h.metadata,transportType:c}),p={requester:h,pairingTopic:s,id:n.id,authPayload:l,verifyContext:f,expiryTimestamp:u};await this.setAuthRequest(n.id,{request:p,pairingTopic:s,transportType:c}),c===he.link_mode&&(r=h.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(h.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:n.params,id:n.id,verifyContext:f})}catch(h){this.client.logger.error(h);const l=n.params.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(n.params.requester.metadata,c),p={type:Nt,receiverPublicKey:l,senderPublicKey:u};await this.sendError({id:n.id,topic:s,error:h,encodeOpts:p,rpcOpts:Ee.wc_sessionAuthenticate.autoReject,appLink:f})}}),N(this,"addSessionRequestToSessionRequestQueue",i=>{this.sessionRequestQueue.queue.push(i)}),N(this,"cleanupAfterResponse",i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=pt.idle,this.processSessionRequestQueue()},M.toMiliseconds(this.requestQueueDelay))}),N(this,"cleanupPendingSentRequestsForTopic",({topic:i,error:r})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(n=>n.topic===i&&n.request.method==="wc_sessionRequest").forEach(n=>{const o=n.request.id,a=re("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(re("session_request",n.request.id),{error:r})})}),N(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===pt.active){this.client.logger.info("session request queue is already active.");return}const i=this.sessionRequestQueue.queue[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(i)}catch(r){this.client.logger.error(r)}}),N(this,"emitSessionRequest",i=>{if(this.emittedSessionRequests.has(i.id)){this.client.logger.warn({id:i.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${i.id}`);return}this.sessionRequestQueue.state=pt.active,this.emittedSessionRequests.add(i.id),this.client.events.emit("session_request",i)}),N(this,"onPairingCreated",i=>{if(i.methods&&this.expectedPairingMethodMap.set(i.topic,i.methods),i.active)return;const r=this.client.proposal.getAll().find(s=>s.pairingTopic===i.topic);r&&this.onSessionProposeRequest({topic:i.topic,payload:Ct("wc_sessionPropose",Le(se({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),N(this,"isValidConnect",async i=>{if(!Ve(i)){const{message:h}=z("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(h)}const{pairingTopic:r,requiredNamespaces:s,optionalNamespaces:n,sessionProperties:o,scopedProperties:a,relays:c}=i;if(_e(r)||await this.isValidPairingTopic(r),!o_(c)){const{message:h}=z("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}if(!_e(s)&&Nr(s)!==0){const h="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(h):this.client.logger.warn(h),this.validateNamespaces(s,"requiredNamespaces")}if(!_e(n)&&Nr(n)!==0&&this.validateNamespaces(n,"optionalNamespaces"),_e(o)||this.validateSessionProps(o,"sessionProperties"),!_e(a)){this.validateSessionProps(a,"scopedProperties");const h=Object.keys(s||{}).concat(Object.keys(n||{}));if(!Object.keys(a).every(l=>h.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(h)}`)}}),N(this,"validateNamespaces",(i,r)=>{const s=n_(i,"connect()",r);if(s)throw new Error(s.message)}),N(this,"isValidApprove",async i=>{if(!Ve(i))throw new Error(z("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:r,namespaces:s,relayProtocol:n,sessionProperties:o,scopedProperties:a}=i;this.checkRecentlyDeleted(r),await this.isValidProposalId(r);const c=this.client.proposal.get(r),h=Un(s,"approve()");if(h)throw new Error(h.message);const l=ph(c.requiredNamespaces,s,"approve()");if(l)throw new Error(l.message);if(!ge(n,!0)){const{message:u}=z("MISSING_OR_INVALID",`approve() relayProtocol: ${n}`);throw new Error(u)}if(_e(o)||this.validateSessionProps(o,"sessionProperties"),!_e(a)){this.validateSessionProps(a,"scopedProperties");const u=new Set(Object.keys(s));if(!Object.keys(a).every(f=>u.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(u).join(", ")}`)}}),N(this,"isValidReject",async i=>{if(!Ve(i)){const{message:n}=z("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(n)}const{id:r,reason:s}=i;if(this.checkRecentlyDeleted(r),await this.isValidProposalId(r),!c_(s)){const{message:n}=z("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(n)}}),N(this,"isValidSessionSettleRequest",i=>{if(!Ve(i)){const{message:h}=z("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(h)}const{relay:r,controller:s,namespaces:n,expiry:o}=i;if(!If(r)){const{message:h}=z("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(h)}const a=QE(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Un(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Yt(o)){const{message:h}=z("EXPIRED","onSessionSettleRequest()");throw new Error(h)}}),N(this,"isValidUpdate",async i=>{if(!Ve(i)){const{message:c}=z("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(c)}const{topic:r,namespaces:s}=i;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const n=this.client.session.get(r),o=Un(s,"update()");if(o)throw new Error(o.message);const a=ph(n.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),N(this,"isValidExtend",async i=>{if(!Ve(i)){const{message:s}=z("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(s)}const{topic:r}=i;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r)}),N(this,"isValidRequest",async i=>{if(!Ve(i)){const{message:c}=z("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(c)}const{topic:r,request:s,chainId:n,expiry:o}=i;this.checkRecentlyDeleted(r),await this.isValidSessionTopic(r);const{namespaces:a}=this.client.session.get(r);if(!dh(a,n)){const{message:c}=z("MISSING_OR_INVALID",`request() chainId: ${n}`);throw new Error(c)}if(!h_(s)){const{message:c}=z("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!f_(a,n,s.method)){const{message:c}=z("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!y_(o,vs)){const{message:c}=z("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${vs.min} and ${vs.max}`);throw new Error(c)}}),N(this,"isValidRespond",async i=>{var r;if(!Ve(i)){const{message:o}=z("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(o)}const{topic:s,response:n}=i;try{await this.isValidSessionTopic(s)}catch(o){throw(r=i==null?void 0:i.response)!=null&&r.id&&this.cleanupAfterResponse(i),o}if(!l_(n)){const{message:o}=z("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}}),N(this,"isValidPing",async i=>{if(!Ve(i)){const{message:s}=z("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:r}=i;await this.isValidSessionOrPairingTopic(r)}),N(this,"isValidEmit",async i=>{if(!Ve(i)){const{message:a}=z("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(a)}const{topic:r,event:s,chainId:n}=i;await this.isValidSessionTopic(r);const{namespaces:o}=this.client.session.get(r);if(!dh(o,n)){const{message:a}=z("MISSING_OR_INVALID",`emit() chainId: ${n}`);throw new Error(a)}if(!u_(s)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!d_(o,n,s.name)){const{message:a}=z("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),N(this,"isValidDisconnect",async i=>{if(!Ve(i)){const{message:s}=z("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:r}=i;await this.isValidSessionOrPairingTopic(r)}),N(this,"isValidAuthenticate",i=>{const{chains:r,uri:s,domain:n,nonce:o}=i;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!ge(s,!1))throw new Error("uri is required parameter");if(!ge(n,!1))throw new Error("domain is required parameter");if(!ge(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>gs(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=gs(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),N(this,"getVerifyContext",async i=>{const{attestationId:r,hash:s,encryptedId:n,metadata:o,transportType:a}=i,c={verified:{verifyUrl:o.verifyUrl||xr,validation:"UNKNOWN",origin:o.url||""}};try{if(a===he.link_mode){const l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}const h=await this.client.core.verify.resolve({attestationId:r,hash:s,encryptedId:n,verifyUrl:o.verifyUrl});h&&(c.verified.origin=h.origin,c.verified.isScam=h.isScam,c.verified.validation=h.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(h){this.client.logger.warn(h)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),N(this,"validateSessionProps",(i,r)=>{Object.values(i).forEach((s,n)=>{if(s==null){const{message:o}=z("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${s} for key ${Object.keys(i)[n]}`);throw new Error(o)}})}),N(this,"getPendingAuthRequest",i=>{const r=this.client.auth.requests.get(i);return typeof r=="object"?r:void 0}),N(this,"addToRecentlyDeleted",(i,r)=>{if(this.recentlyDeletedMap.set(i,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const n=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=n)break;this.recentlyDeletedMap.delete(o)}}}),N(this,"checkRecentlyDeleted",i=>{const r=this.recentlyDeletedMap.get(i);if(r){const{message:s}=z("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${i}`);throw new Error(s)}}),N(this,"isLinkModeEnabled",(i,r)=>{var s,n,o,a,c,h,l,u,f;return!i||r!==he.link_mode?!1:((n=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:n.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((h=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:h.universal)!==""&&((l=i==null?void 0:i.redirect)==null?void 0:l.universal)!==void 0&&((u=i==null?void 0:i.redirect)==null?void 0:u.universal)!==""&&((f=i==null?void 0:i.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(i.redirect.universal)&&typeof(globalThis==null?void 0:globalThis.Linking)<"u"}),N(this,"getAppLinkIfEnabled",(i,r)=>{var s;return this.isLinkModeEnabled(i,r)?(s=i==null?void 0:i.redirect)==null?void 0:s.universal:void 0}),N(this,"handleLinkModeMessage",({url:i})=>{if(!i||!i.includes("wc_ev")||!i.includes("topic"))return;const r=$c(i,"topic")||"",s=decodeURIComponent($c(i,"wc_ev")||""),n=this.client.session.keys.includes(r);n&&this.client.session.update(r,{transportType:he.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:s,sessionExists:n})}),N(this,"registerLinkModeListeners",async()=>{var i;if(Ho()||ri()&&(i=this.client.metadata.redirect)!=null&&i.linkMode){const r=globalThis==null?void 0:globalThis.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await r.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),N(this,"getTVFParams",(i,r,s)=>{var n,o,a;if(!((n=r.request)!=null&&n.method))return{};const c={correlationId:i,rpcMethods:[r.request.method],chainId:r.chainId};try{const h=this.extractTxHashesFromResult(r.request,s);c.txHashes=h,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(h){this.client.logger.warn("Error getting TVF params",h)}return c}),N(this,"isValidContractData",i=>{var r;if(!i)return!1;try{const s=(i==null?void 0:i.data)||((r=i==null?void 0:i[0])==null?void 0:r.data);if(!s.startsWith("0x"))return!1;const n=s.slice(2);return/^[0-9a-fA-F]*$/.test(n)?n.length%2===0:!1}catch{}return!1}),N(this,"extractTxHashesFromResult",(i,r)=>{var s;try{if(!r)return[];const n=i.method,o=Vf[n];if(n==="sui_signTransaction")return[k2(r.transactionBytes)];if(n==="near_signTransaction")return[Rc(r)];if(n==="near_signTransactions")return r.map(c=>Rc(c));if(n==="xrpl_signTransactionFor"||n==="xrpl_signTransaction")return[(s=r.tx_json)==null?void 0:s.hash];if(n==="polkadot_signTransaction")return[P_({transaction:i.params.transactionPayload,signature:r.signature})];if(n==="algo_signTxn")return qi(r)?r.map(c=>Bc(c)):[Bc(r)];if(n==="cosmos_signDirect")return[M2(r)];if(typeof r=="string")return[r];const a=r[o.key];if(qi(a))return n==="solana_signAllTransactions"?a.map(c=>B2(c)):a;if(typeof a=="string")return[a]}catch(n){this.client.logger.warn("Error extracting tx hashes from result",n)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,i=this.client.core.relayer.messages.getWithoutAck(e);for(const[r,s]of Object.entries(i))for(const n of s)try{await this.onProviderMessageEvent({topic:r,message:n,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${n}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=z("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(fe.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:i,message:r,attestation:s,transportType:n}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Sr)?this.client.auth.authKeys.get(Sr):{responseTopic:void 0,publicKey:void 0};try{const a=await this.client.core.crypto.decode(i,r,{receiverPublicKey:o,encoding:n===he.link_mode?Qt:Ge});oa(a)?(this.client.core.history.set(i,a),await this.onRelayEventRequest({topic:i,payload:a,attestation:s,transportType:n,encryptedId:nt(r)})):Qs(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a,transportType:n}),this.client.core.history.delete(i,a.id)):await this.onRelayEventUnknownPayload({topic:i,payload:a,transportType:n}),await this.client.core.relayer.messages.ack(i,r)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(st.expired,async e=>{const{topic:i,id:r}=Tu(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return await this.deletePendingSessionRequest(r,z("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return await this.deletePendingAuthRequest(r,z("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession({topic:i,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:i})):r&&(await this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))})}registerPairingEvents(){this.client.core.pairing.events.on(ui.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(ui.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!ge(e,!1)){const{message:i}=z("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:i}=z("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(i)}if(Yt(this.client.core.pairing.pairings.get(e).expiry)){const{message:i}=z("EXPIRED",`pairing topic: ${e}`);throw new Error(i)}}async isValidSessionTopic(e){if(!ge(e,!1)){const{message:i}=z("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(i)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:i}=z("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(i)}if(Yt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:i}=z("EXPIRED",`session topic: ${e}`);throw new Error(i)}if(!this.client.core.crypto.keychain.has(e)){const{message:i}=z("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(i)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(ge(e,!1)){const{message:i}=z("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(i)}else{const{message:i}=z("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(i)}}async isValidProposalId(e){if(!a_(e)){const{message:i}=z("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(i)}if(!this.client.proposal.keys.includes(e)){const{message:i}=z("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(i)}if(Yt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:i}=z("EXPIRED",`proposal id: ${e}`);throw new Error(i)}}}class LI extends Si{constructor(e,i){super(e,i,jf,tn),this.core=e,this.logger=i}}class MI extends Si{constructor(e,i){super(e,i,Ff,tn),this.core=e,this.logger=i}}class zI extends Si{constructor(e,i){super(e,i,Hf,tn,r=>r.id),this.core=e,this.logger=i}}class qI extends Si{constructor(e,i){super(e,i,Jf,Vr,()=>Sr),this.core=e,this.logger=i}}class jI extends Si{constructor(e,i){super(e,i,Zf,Vr),this.core=e,this.logger=i}}class FI extends Si{constructor(e,i){super(e,i,Xf,Vr,r=>r.id),this.core=e,this.logger=i}}var KI=Object.defineProperty,VI=(t,e,i)=>e in t?KI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Ln=(t,e,i)=>VI(t,typeof e!="symbol"?e+"":e,i);class HI{constructor(e,i){this.core=e,this.logger=i,Ln(this,"authKeys"),Ln(this,"pairingTopics"),Ln(this,"requests"),this.authKeys=new qI(this.core,this.logger),this.pairingTopics=new jI(this.core,this.logger),this.requests=new FI(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var WI=Object.defineProperty,GI=(t,e,i)=>e in t?WI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Z=(t,e,i)=>GI(t,typeof e!="symbol"?e+"":e,i);class rn extends eg{constructor(e){super(e),Z(this,"protocol",ca),Z(this,"version",ha),Z(this,"name",ms.name),Z(this,"metadata"),Z(this,"core"),Z(this,"logger"),Z(this,"events",new wt.EventEmitter),Z(this,"engine"),Z(this,"session"),Z(this,"proposal"),Z(this,"pendingRequest"),Z(this,"auth"),Z(this,"signConfig"),Z(this,"on",(r,s)=>this.events.on(r,s)),Z(this,"once",(r,s)=>this.events.once(r,s)),Z(this,"off",(r,s)=>this.events.off(r,s)),Z(this,"removeListener",(r,s)=>this.events.removeListener(r,s)),Z(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),Z(this,"connect",async r=>{try{return await this.engine.connect(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"pair",async r=>{try{return await this.engine.pair(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"approve",async r=>{try{return await this.engine.approve(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"reject",async r=>{try{return await this.engine.reject(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"update",async r=>{try{return await this.engine.update(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"extend",async r=>{try{return await this.engine.extend(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"request",async r=>{try{return await this.engine.request(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"respond",async r=>{try{return await this.engine.respond(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"ping",async r=>{try{return await this.engine.ping(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"emit",async r=>{try{return await this.engine.emit(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"disconnect",async r=>{try{return await this.engine.disconnect(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"find",r=>{try{return this.engine.find(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),Z(this,"authenticate",async(r,s)=>{try{return await this.engine.authenticate(r,s)}catch(n){throw this.logger.error(n.message),n}}),Z(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"approveSessionAuthenticate",async r=>{try{return await this.engine.approveSessionAuthenticate(r)}catch(s){throw this.logger.error(s.message),s}}),Z(this,"rejectSessionAuthenticate",async r=>{try{return await this.engine.rejectSessionAuthenticate(r)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||ms.name,this.metadata=O1(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const i=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:qs(To({level:(e==null?void 0:e.logger)||ms.logger}));this.core=(e==null?void 0:e.core)||new PI(e),this.logger=qe(i,this.name),this.session=new MI(this.core,this.logger),this.proposal=new LI(this.core,this.logger),this.pendingRequest=new zI(this.core,this.logger),this.engine=new kI(this),this.auth=new HI(this.core,this.logger)}static async init(e){const i=new rn(e);return await i.initialize(),i}get context(){return Ze(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const YI=rn,kS=Object.freeze(Object.defineProperty({__proto__:null,AUTH_CONTEXT:Yf,AUTH_KEYS_CONTEXT:Jf,AUTH_PAIRING_TOPIC_CONTEXT:Zf,AUTH_PROTOCOL:Gf,AUTH_PUBLIC_KEY_NAME:Sr,AUTH_REQUEST_CONTEXT:Xf,AUTH_STORAGE_PREFIX:Vr,ENGINE_CONTEXT:Kf,ENGINE_QUEUE_STATES:pt,ENGINE_RPC_OPTS:Ee,METHODS_TO_VERIFY:Wf,PROPOSAL_CONTEXT:jf,PROPOSAL_EXPIRY_MESSAGE:So,REQUEST_CONTEXT:Hf,SESSION_CONTEXT:Ff,SESSION_EXPIRY:hi,SESSION_REQUEST_EXPIRY_BOUNDARIES:vs,SIGN_CLIENT_CONTEXT:la,SIGN_CLIENT_DEFAULT:ms,SIGN_CLIENT_PROTOCOL:ca,SIGN_CLIENT_STORAGE_PREFIX:tn,SIGN_CLIENT_VERSION:ha,SignClient:YI,TVF_METHODS:Vf,WALLETCONNECT_DEEPLINK_CHOICE:Io,default:rn},Symbol.toStringTag,{value:"Module"}));export{Zw as H,dc as a,Ar as b,DS as c,Vw as d,Wl as e,Xw as f,SS as g,Ds as h,OS as i,AS as j,kS as k,$S as r,Gl as t};
